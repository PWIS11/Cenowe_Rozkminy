---
title: "Analiza cen mieszkań w Polsce"
date: "`r Sys.Date()`"
author: "Piotr Wiśniewski - lider zespołu, Izabela Reszka, Klaudia Woźniak"
output:
  html_document:
    css: style.css
    highlight: tango
    highlight_color: "goldenrod"
    toc: true
    toc_float: true
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
# Instalacja Pakietów
if (!requireNamespace("httr", quietly = TRUE)) install.packages("httr")
if (!requireNamespace("jsonlite", quietly = TRUE)) install.packages("jsonlite")
if (!requireNamespace("tidygeocoder", quietly = TRUE)) install.packages("tidygeocoder")
if (!requireNamespace("dplyr", quietly = TRUE)) install.packages("dplyr")
if (!requireNamespace("sf", quietly = TRUE)) install.packages("sf")
if (!requireNamespace("ggplot2", quietly = TRUE)) install.packages("ggplot2")
if (!requireNamespace("scales", quietly = TRUE)) install.packages("scales")
if (!requireNamespace("tidyverse", quietly = TRUE)) install.packages("tidyverse")
if (!requireNamespace("naniar", quietly = TRUE)) install.packages("naniar")
if (!requireNamespace("VIM", quietly = TRUE)) install.packages("VIM")
if (!requireNamespace("outliers", quietly = TRUE)) install.packages("outliers")
if (!requireNamespace("caret", quietly = TRUE)) install.packages("caret")
if (!requireNamespace("mice", quietly = TRUE)) install.packages("mice")
if (!requireNamespace("gridExtra", quietly = TRUE)) install.packages("gridExtra")
if (!requireNamespace("dlookr", quietly = TRUE)) install.packages("dlookr")
if (!requireNamespace("validate", quietly = TRUE)) install.packages("validate")
if (!requireNamespace("plotly", quietly = TRUE)) install.packages("plotly")
if (!requireNamespace("knitr", quietly = TRUE)) install.packages("knitr")
if (!requireNamespace("nortest", quietly = TRUE)) install.packages("nortest")
if (!requireNamespace("kableExtra", quietly = TRUE)) install.packages("kableExtra")
if (!requireNamespace("tibble", quietly = TRUE)) install.packages("tibble")
if (!requireNamespace("reshape2", quietly = TRUE)) install.packages("reshape2")
if (!requireNamespace("car", quietly = TRUE)) install.packages("car")
```

```{r libraries, include=FALSE}
library(httr)
library(jsonlite)
library(tidygeocoder)
library(dplyr)
library(sf)
library(ggplot2)
library(scales)
library(tidyverse)
library(naniar)
library(VIM)
library(outliers)
library(caret)
library(mice)
library(gridExtra)
library(dlookr)
library(validate)
library(plotly)
library(knitr)
library(nortest)
library(kableExtra)
library(tibble)
library(reshape2)
library(car)
```

# **Cel projektu**



Celem naszego projektu jest analiza cen mieszkań w największych miastach
Polski, uwzględniając różnorodne czynniki, które mogą wpływać na wartość
nieruchomości. Wykorzystamy metody analizy danych, aby odpowiedzieć na
kluczowe pytania, takie jak:



-   *Od czego zależy cena mieszkań?*

-   *Jakie różnice w cenach występują pomiędzy miastami?*

-   *Czy odległość od centrum lub interesujących miejsc (POI) ma
    znaczenie dla wartości nieruchomości?*

-   *Które cechy mieszkań (np. liczba pokoi, stan, udogodnienia) są
    najbardziej cenione?*
    
    

## **Analizy w projekcie**



Planujemy zastosowanie narzędzi analizy danych oraz wizualizacji, aby
lepiej zrozumieć rynek nieruchomości w Polsce. Nasze analizy obejmą:

-   Badanie zależności między cechami mieszkań (takimi jak lokalizacja,
    powierzchnia, liczba pokoi) a ich ceną.

-   Porównanie cen nieruchomości pomiędzy największymi polskimi
    miastami, w celu wykazania kluczowych różnic regionalnych.

-   Modelowanie predykcyjne, które pozwoli oszacować cenę mieszkań na
    podstawie wybranych zmiennych, takich jak odległość od centrum czy
    stan mieszkania.

-   Wykorzystanie interaktywnych wizualizacji, takich jak mapy i
    wykresy, aby przedstawić wyniki w przystępny sposób.
    
    

### **Hipotezy i oczekiwane wyniki**

1.  **Odległość od centrum miasta:** Zakładamy, że im bliżej centrum,
    tym wyższa cena mieszkań, choć siła tego wpływu może różnić się w
    zależności od miasta.

2.  **Cechy nieruchomości:** Udogodnienia takie jak balkon, winda czy
    miejsce parkingowe znacząco podnoszą wartość mieszkań, zwłaszcza w
    dużych miastach.

3.  **Różnice regionalne:** Miasta o wyższym poziomie urbanizacji i
    rozwiniętej infrastrukturze (np. Warszawa, Kraków, Wrocław) mają
    wyższe ceny mieszkań w porównaniu do mniejszych miejscowości.

4.  **Rok budowy:** Starsze mieszkania, wymagające remontu, są z reguły
    tańsze, chyba że znajdują się w prestiżowych lokalizacjach.

Podsumowując, oczekujemy, że nasze analizy wskażą najważniejsze czynniki
wpływające na ceny mieszkań oraz umożliwią stworzenie użytecznych modeli
predykcyjnych, które mogą wspierać decyzje zakupowe lub inwestycyjne.



## **Opis danych**



Zbiór danych pochodzi z ofert sprzedaży i wynajmu mieszkań z 15
największych polskich miast, zgromadzonych w czerwcu 2024 roku. Dane te
obejmują szerokie spektrum cech nieruchomości oraz dodatkowe informacje
z Open Street Map, które pozwalają uwzględnić kontekst sąsiedztwa
mieszkań.



**Miasta w zbiorze danych:** Warszawa, Łódź, Kraków, Wrocław, Poznań,
Gdańsk, Szczecin, Bydgoszcz, Lublin, Katowice, Białystok, Częstochowa.

**Główne pola w zbiorze danych:**

-   ***Lokalizacja i charakterystyka nieruchomości:***

    -   Miasto, typ budynku, wielkość w metrach kwadratowych, liczba
        pokoi, piętro, rok budowy.

-   ***Informacje kontekstowe:***

    -   Odległość od centrum miasta, liczba interesujących punktów w
        promieniu 500 metrów (np. szkoły, apteki, restauracje) oraz
        odległość do najbliższego punktu.

-   ***Cechy nieruchomości:***

    -   Stan mieszkania, rodzaj własności, obecność udogodnień (np.
        winda, balkon, miejsce parkingowe, ochrona).

-   ***Cena ofertowa:***

    -   Cena sprzedaży lub miesięczny czynsz.

## **Dane dodatkowe**



W celu wykonania bardziej szczegółowej analizy zdecydowaliśmy się
wzbogacić nasz zbiór o **granice administracyjne województw** oraz dane
dotyczące **wynagrodzeń**. Dane te zostały pobrane z pliku
`ms_A01_Granice_wojewodztw` oraz `wynagrodzenia_pl_2024` - na podstawie
bazy danych lokalnych GUS, co umożliwiło przypisanie każdego miasta do
odpowiedniego województwa oraz analizę wpływu średniej pensji na ceny
nieruchomości. Dzięki temu możliwe jest badanie, czy wysokość
wynagrodzeń ma związek z cenami nieruchomości w poszczególnych regionach
Polski.



### **Cel dodania danych:**

-   **Przypisanie lokalizacji mieszkań do województw**,\
-   **Przeprowadzenie analiz regionalnych**, aby lepiej zrozumieć
    różnice w cenach i cechach mieszkań w różnych częściach Polski,\
-   **Analiza zależności między średnimi wynagrodzeniami a cenami
    nieruchomości**, aby sprawdzić, czy wyższe wynagrodzenia są
    powiązane z wyższymi cenami mieszkań.



Dzięki temu możliwe jest nie tylko szczegółowe badanie rynku
nieruchomości na poziomie miast, ale także **porównanie wyników w
kontekście regionalnym** oraz uwzględnienie czynników ekonomicznych,
takich jak wynagrodzenia, które mogą wpływać na ceny mieszkań.



## **Znaczenie projektu**



Rynek nieruchomości jest dynamiczny i podlega wpływowi wielu czynników,
takich jak lokalizacja, liczba pokoi, dostępność udogodnień czy bliskość
kluczowych miejsc. Analiza tych danych pozwoli lepiej zrozumieć
mechanizmy kształtowania się cen mieszkań oraz stworzyć narzędzia
wspomagające decyzje zakupowe i inwestycyjne.



# **Brudne dane i ich znaczenie w analizie**

## **Czym są brudne dane?**



Brudne dane to dane, które są niekompletne, nieprawidłowe, niespójne lub
w inny sposób niezgodne z wymaganiami jakościowymi potrzebnymi do ich
analizy. Przykłady brudnych danych obejmują:



-   **Braki danych (NA):** Puste komórki w zestawie danych, które mogą
    być spowodowane błędami w zbieraniu danych lub brakiem odpowiednich
    informacji.
-   **Niepoprawne wartości:** Dane, które są logicznie sprzeczne, np.
    liczba pięter większa niż całkowita liczba kondygnacji.
-   **Niespójne formaty:** Dane zapisane w różnych formatach, np. różne
    sposoby zapisu nazw miast.
-   **Duplikaty:** Powtarzające się rekordy w zbiorze danych.

## **Dlaczego należy walczyć z brudnymi danymi?**



Analiza danych oparta na brudnych danych prowadzi do błędnych wniosków i
modeli. Wysoka jakość danych jest kluczowa, ponieważ:



1.  **Zapewnia wiarygodność wyników:** Poprawne dane umożliwiają
    uzyskanie rzetelnych wniosków.
2.  **Ułatwia analizę:** Dane uporządkowane i spójne są łatwiejsze do
    przetwarzania i modelowania.
3.  **Ogranicza błędy w analizach:** Niespójności w danych mogą
    prowadzić do błędnych wyników statystycznych.

## **Działania naprawcze dla brudnych danych**



W naszym projekcie podjęliśmy działania w celu naprawy brudnych danych,
obejmujące:



1.  **Ujednolicenie nazw miast:** Naprawimy niezgodności w zapisie nazw,
    aby zapewnić spójność.
2.  **Poprawa nazw kolumn:** Nazwy kolumn zostaną zmienione na bardziej
    opisowe, co ułatwi zrozumienie danych. Planowane zmiany to np.:
    -   `squareMeters` → `square_meters`
    -   `floorCount` → `total_floors`
    -   `clinic_distance` → `distance_to_clinic`
3.  **Uzupełnienie brakujących danych:**
    -   **Metodami statystycznymi:** Użyjemy mediany dla wartości
        liczbowych oraz najczęściej występujących wartości dla zmiennych
        kategorycznych.
    -   **Regułami logicznymi:** Uzupełnimy dane na podstawie zależności
        między zmiennymi.
4.  **Eliminacja błędów logicznych:** Skorygujemy przypadki, gdzie np.
    piętro jest większe niż liczba kondygnacji.

## **Planowane działania techniczne**



Przegląd kolumn w poszukiwaniu braków, niezgodności oraz błędów
logicznych. Transformacja danych, aby były zgodne z wymaganiami do
analizy i modelowania. Sprawdzenie zgodności z przyjętymi regułami
walidacyjnymi oraz weryfikacja efektów imputacji i transformacji danych.



**Zmiana nazw kolumn** Poniżej znajduje się tabela z przekształconymi
nazwami kolumn:

```{r wstepna_obrobka_danych, echo=FALSE}
dane <- read.csv("apartments_pl_2024_06.csv", sep = ",", header = TRUE)

# Przygotowanie tabeli do raportu
column_changes <- data.frame(
  Original_Name = c("id", "city", "type", "squareMeters", "rooms", "floor", 
                    "floorCount", "buildYear", "latitude", "longitude", 
                    "centreDistance", "poiCount", "schoolDistance", 
                    "clinicDistance", "postOfficeDistance", "kindergartenDistance", 
                    "restaurantDistance", "collegeDistance", "pharmacyDistance", 
                    "ownership", "buildingMaterial", "condition", "hasParkingSpace", 
                    "hasBalcony", "hasElevator", "hasSecurity", "hasStorageRoom", "price"),
  New_Name = c("id", "city", "building_type", "square_meters", "rooms", "floor", 
               "floor_count", "build_year", "latitude", "longitude", 
               "centre_distance", "poi_count", "school_distance", 
               "clinic_distance", "post_office_distance", "kindergarten_distance", 
               "restaurant_distance", "college_distance", "pharmacy_distance", 
               "ownership", "building_material", "condition", "has_parking", 
               "has_balcony", "has_elevator", "has_security", "has_storage_room", "price")
)

# Wyświetlenie tabeli w raporcie
knitr::kable(column_changes, 
             caption = "Zmiana nazw kolumn: Oryginalne i nowe nazwy", 
             align = "c")

# Zmiana nazw kolumn w zbiorze danych
colnames(dane) <- c("id", "city", "building_type", "square_meters", "rooms", "floor", 
                    "floor_count", "build_year", "latitude", "longitude", 
                    "centre_distance", "poi_count", "school_distance", 
                    "clinic_distance", "post_office_distance", "kindergarten_distance", 
                    "restaurant_distance", "college_distance", "pharmacy_distance", 
                    "ownership", "building_material", "condition", "has_parking", 
                    "has_balcony", "has_elevator", "has_security", "has_storage_room", "price")

# Zmiana id na liczby rosnące, zaczynające się od cyfry 1
dane$id <- 1:nrow(dane)

# Zamiana pustych ciągów na NA
dane[dane == ""] <- NA

```

## **Standaryzacja danych**

W celu ujednolicenia danych i zapewnienia ich spójności, dokonano
następujących zmian:

### Zmiany nazw miast

Standaryzacja nazw miast w kolumnie `city` polegała na poprawie pisowni,
m.in. zamianie nazw pisanych małymi literami na wersje z wielką literą
oraz wprowadzeniu poprawnych form polskich nazw. Dzięki temu dane są
bardziej czytelne i gotowe do dalszych analiz.

| Poprzednia nazwa | Nowa nazwa  |
|------------------|-------------|
| szczecin         | Szczecin    |
| gdynia           | Gdynia      |
| krakow           | Kraków      |
| poznan           | Poznań      |
| bialystok        | Białystok   |
| gdansk           | Gdańsk      |
| wroclaw          | Wrocław     |
| radom            | Radom       |
| rzeszow          | Rzeszów     |
| lodz             | Łódź        |
| katowice         | Katowice    |
| lublin           | Lublin      |
| czestochowa      | Częstochowa |
| warszawa         | Warszawa    |
| bydgoszcz        | Bydgoszcz   |

------------------------------------------------------------------------

### Zmiany nazw w kolumnie `building_type`

Ujednolicono nazewnictwo typów budynków. Różne nazwy odnoszące się do
tego samego typu budynku zostały sprowadzone do jednej wartości, co
upraszcza interpretację i analizę.

| Poprzednia nazwa  | Nowa nazwa     |
|-------------------|----------------|
| blockOfFlats      | block_of_flats |
| apartmentBuilding | block_of_flats |
| tenement          | tenement       |

------------------------------------------------------------------------

### Zmiany nazw w kolumnie `ownership`

Poprawiono i ujednolicono nazwy dotyczące formy własności nieruchomości.
Różne terminy określające tę samą formę własności zostały scalone.

| Poprzednia nazwa | Nowa nazwa  |
|------------------|-------------|
| condominium      | condominium |
| udział           | condominium |
| cooperative      | cooperative |

------------------------------------------------------------------------

### Zmiany nazw w kolumnie `building_material`

Dostosowano nazewnictwo materiałów budowlanych, ujednolicając zapis oraz
wprowadzając format z podkreśleniami (`snake_case`).

| Poprzednia nazwa | Nowa nazwa    |
|------------------|---------------|
| concreteSlab     | concrete_slab |
| brick            | brick         |

------------------------------------------------------------------------

### Cel zmian

1.  **Poprawa jakości danych:** Eliminacja niespójności w nazewnictwie.
2.  **Ułatwienie analizy:** Ujednolicone dane umożliwiają prostsze
    grupowanie i wyciąganie wniosków.
3.  **Czytelność i przejrzystość:** Dzięki standaryzacji dane są
    bardziej intuicyjne i gotowe do prezentacji w raportach.

Zmiany te zapewniają, że wszystkie dane są zgodne ze standardami i
umożliwiają łatwiejsze ich przetwarzanie w kolejnych krokach analizy.

```{r brudne dane, echo=FALSE}

# Zmiana nazw miast
dane$city <- case_when(
  dane$city == "szczecin" ~ "Szczecin",
  dane$city == "gdynia" ~ "Gdynia",
  dane$city == "krakow" ~ "Kraków",
  dane$city == "poznan" ~ "Poznań",
  dane$city == "bialystok" ~ "Białystok",
  dane$city == "gdansk" ~ "Gdańsk",
  dane$city == "wroclaw" ~ "Wrocław",
  dane$city == "radom" ~ "Radom",
  dane$city == "rzeszow" ~ "Rzeszów",
  dane$city == "lodz" ~ "Łódź",
  dane$city == "katowice" ~ "Katowice",
  dane$city == "lublin" ~ "Lublin",
  dane$city == "czestochowa" ~ "Częstochowa",
  dane$city == "warszawa" ~ "Warszawa",
  dane$city == "bydgoszcz" ~ "Bydgoszcz",
  TRUE ~ NA_character_
)

# Zmiana nazw building_type
dane$building_type <- case_when(
  dane$building_type == "blockOfFlats" ~ "block_of_flats",
  dane$building_type == "apartmentBuilding" ~ "block_of_flats",
  dane$building_type == "tenement" ~ "tenement",
  TRUE ~ NA_character_
)

# Zmiana nazw ownership
dane$ownership <- case_when(
  dane$ownership == "condominium" ~ "condominium",
  dane$ownership == "udział" ~ "condominium",
  dane$ownership == "cooperative" ~ "cooperative",
  TRUE ~ NA_character_
)

# Zmiana nazw ownership
dane$building_material <- case_when(
  dane$building_material  == "concreteSlab" ~ "concrete_slab",
  dane$building_material  == "brick" ~ "brick",
  TRUE ~ NA_character_
)

```

# **Walidacja danych**



Walidacja danych to kluczowy etap przygotowania zbioru, który następuje
po wstępnym oczyszczeniu danych. Jej celem jest sprawdzenie **zgodności
danych** z określonymi **regułami logicznymi** i **jakościowymi**, aby
upewnić się, że dane są **kompletne**, **spójne** i gotowe do dalszej
analizy oraz modelowania.



Proces ten polega na weryfikacji, czy dane spełniają określone
**kryteria**, zapewniając ich **poprawność**, **spójność** oraz
**integralność**. Szczególną uwagę zwraca się na **typy danych** i
**analizę unikalnych wartości** w poszczególnych kolumnach. Każda
kolumna powinna mieć odpowiedni **typ danych** (np.**numeryczny**,
**tekstowy**, **całkowity**), a liczba unikalnych wartości powinna być
zgodna z oczekiwaniami.



Dzięki takiej analizie można wykryć potencjalne błędy w **strukturze
danych**, takie jak niewłaściwe przypisanie typu do kolumny czy
nieoczekiwane wartości. Zapewnia to odpowiednie przygotowanie danych do
dalszych etapów analizy i modelowania.



### Typy danych oraz ich charakterystyka

```{r weryfikacja_typów_danych, echo=FALSE, results='asis', eval=TRUE}
# Sprawdzenie struktury danych i sptawdzenie pierwszych kilku wierszy danych
# str(dane)
# head(dane)

# Sprawdzenie i weryfikacja typów danych i liczby unikalnych wartości w każdej kolumnie
data_types <- sapply(dane, class) 
unique_values <- sapply(dane, function(x) length(unique(x)))

data_types <- data.frame(
  Kolumna = names(data_types),
  Typ = as.character(data_types),              
  Liczba_unikalnych = as.character(unique_values)
)

knitr::kable(data_types, caption = "Typy danych oraz ich ilość")
```

```{r weryfikacja_typów_danych2, echo=FALSE, results='asis', eval=TRUE}
# Podsumowanie ile kolumn jest każdego typu
liczba_numeric <- sum(data_types == "numeric")
liczba_character <- sum(data_types == "character")
liczba_factor <- sum(data_types == "factor")
liczba_integer <- sum(data_types == "integer")
liczba_logical <- sum(data_types == "logical")

data_types <- data.frame(
  Typ = c("Numeric", "Character", "Factor", "Integer", "Logical"),
  Liczba_kolumn = c(liczba_numeric, liczba_character, liczba_factor, liczba_integer, liczba_logical)
)

knitr::kable(data_types, caption = "Typy danych")

```



Zbiór danych składa się z **28 kolumn**, które charakteryzują się
następującymi typami: **18 zmiennych numerycznych (typ numeric)**,
**6zmiennych tekstowych (typ character)**, **3 zmiennymi kategorycznymi
(typ factor)**, **2 zmiennymi całkowitymi (typ integer)** oraz **brakiem
zmiennych logicznych.**



-   Zmienne **numeryczne**, takie jak `square_meters`, `price` czy
    `centre_distance`, mają dużą liczbę unikalnych wartości, co
    sugeruje, że są to dane ciągłe, które będą odpowiednie do analizy
    regresyjnej.

-   Zmienne **kategoryczne**, takie jak `building_type`, `ownership` czy
    `building_material`, mogą być traktowane jako zmienne typu factor i
    wykorzystane w analizach klasyfikacyjnych.

-   Kolumny z typem **integer**, jak np. `price` mogą być również
    używane w analizach numerycznych.



Dzięki tej weryfikacji możemy odpowiednio przygotować dane do dalszej
analizy i modelowania. Zmienne numeryczne będą wykorzystywane w
analizach regresyjnych, zmienne typu factor w klasyfikacyjnych, a
zmienne character mogą wymagać kodowania na typ factor, aby mogły być
wykorzystane w dalszej analizie.





Na podstawie tej analizy możemy przejść do przygotowania danych do
modelowania, dobierając odpowiednie metody przetwarzania, takie jak
kodowanie zmiennych kategorycznych, normalizację zmiennych numerycznych
czy tworzenie nowych zmiennych,w zależności od typu danych i celu
analizy.



Kolejnym krokiem w procesie walidacji jest zastosowanie określonych
reguł logicznych, które zapewniają spójność danych. <br> <br>**W
projekcie zastosowano następujące reguły walidacyjne**:

1.  Piętro (`Floor`) nie może być większe niż liczba kondygnacji
    (`FloorCount`).
2.  Rok budowy (`Build Year`) nie może być późniejszy niż bieżący rok
    (2024).
3.  Rok budowy (`Build Year`) musi być późniejszy niż 1600.
4.  Piętro (`Floor`) i liczba kondygnacji (`Floor Count`) muszą być
    większe lub równe 0.
5.  Liczba pokoi (`Rooms`) musi być większa niż 0 i nie może przekraczać
    15. 
6.  Jeżeli liczba kondygnacji (`Floor Count`) wynosi 0, to w takim
    budynku nie powinno być windy (`Has Elevator`).

Dzięki weryfikacji typów danych oraz zastosowaniu reguł walidacyjnych,
upewniamy się, że dane są zgodne z określonymi kryteriami logicznymi i
są gotowe do dalszej analizy.

```{r walidacja_wstępna_danych, echo=FALSE}

# Definiowanie reguł walidacyjnych i przeprowadzenie walidacji 

rules <- validator(
  "Floor > Floor Count" = floor <= floor_count,                                            # Piętro nie większe niż liczba kondygnacji
  "build_year <= 2024" = build_year <= 2024,                                               # Rok budowy nie większy niż rok bieżący
  "build_year > 1600" = build_year > 1600,                                                 # Rok budowy późniejszy niż 1600
  "Floor >= 0" = floor >= 0,                                                               # Piętro nie może być ujemne
  "floor_count >= 0" = floor_count >= 0,                                                   # Liczba kondygnacji nie może być ujemna
  "Rooms > 0" = rooms > 0,                                                                 # Liczba pokoi większa niż 0
  "Rooms <= 15" = rooms <= 15,                                                             # Liczba pokoi nie większa niż 15
  "Elevator in a building with 0 floors" = !(floor_count == 0 & has_elevator == "yes")     # Sprawdzenie, czy budynek z 0 kondygnacjami ma windę

)

out <- confront(dane, rules)


# Sprawdzenie wyników przed obliczeniem
results <- lapply(names(rules), function(x) out$`._value`[[x]])
observations_passing_rule <- sapply(results, function(x) sum(x == 1, na.rm = TRUE))
observations_failing_rule <- sapply(results, function(x) sum(x == 0, na.rm = TRUE))
observations_missing <- sapply(results, function(x) sum(is.na(x)))

# Przygotowanie wyników do wyświetlenia
validation_results <- data.frame(
  rule = names(rules),
  examined_observations = rep(nrow(dane), length(rules)),
  observations_passing_rule = observations_passing_rule,
  observations_failing_rule = observations_failing_rule,
  observations_missing = observations_missing
)

# zle_obserwacje <- dane %>%
#   filter(floor <= floor_count) %>%
#   nrow()
# 
# 21501-17928
```

```{r wykres_dla_wstępnej_walidacji_danych, echo=FALSE}

  validation_results$rule <- c(
  "Floor > Floor Count",                                       
  "Build Year <= 2024",                                           
  "Build Year > 1600",                                             
  "Floor >= 0",                                                              
  "Floor Count >= 0",                                          
  "Rooms > 0",                                                            
  "Rooms <= 15",                                                            
  "Elevator in a building with 0 floors") 

# Wykres liczby brakujących danych (NA) dla każdej reguły walidacji
suppressMessages({
na_plot <- ggplot(validation_results, aes(x = reorder(rule, observations_missing), y = observations_missing)) +
  geom_bar(stat = "identity", fill = "plum2") +
  geom_text(aes(label = observations_missing), hjust = 0.5, size = 4) +
  coord_flip() +
  labs(
    title = "Liczba brakujących danych (NA) dla reguł walidacji",
    x = "Reguły walidacji",
    y = "Liczba brakujących danych"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.1, size = 15),
    axis.text.y = element_text(size = 15),
    axis.text.x = element_text(size = 14),  
    axis.title.x = element_text(size = 15),
    axis.title.y = element_text(size = 15)
  ) +
  scale_x_discrete(labels = function(x) gsub("\\.+", " ", x))
  scale_y_continuous(limits = c(0, max(validation_results$observations_missing) * 1.1))  

  
print(na_plot)
})
```

W wyniku przeprowadzonej walidacji zauważono, że w zbiorze danych
występuje znaczna liczba **wartości brakujących (NA)**, <br> w
niektórych kolumnach.

W dalszej części analizy planuje się ich imputację, przy czym wartości
te zostaną zastąpione:

-   **medianą** dla zmiennych o **charakterze numerycznym**,
-   **modą** dla zmiennych o **charakterze kategorycznym**.

# **Data wrangling**



Proces **data wrangling** umożliwia przekształcenie surowego zbioru
danych w uporządkowaną i spójną strukturę gotową do dalszych badań. W
ramach tego etapu skoncentrowaliśmy się na dwóch głównych aspektach:
analizie wartości brakujących oraz obserwacji odstających.





W tej części projektu podjęliśmy działania mające na celu: - zrozumienie
i klasyfikację braków danych (MCAR, MAR, MNAR), - wybór odpowiednich
strategii imputacji brakujących wartości, - wykrycie i obsługę
obserwacji odstających, które mogą zaburzać statystyczne wnioski.





Dzięki zastosowaniu odpowiednich metod wizualizacji (np. wykresów
pudełkowych i macierzy braków) oraz technik statystycznych (np. Z-score)
możliwe było zarówno dokładne zrozumienie problemów związanych z danymi,
jak i zaplanowanie działań korygujących. Tak przygotowany zbiór danych
stanowi podstawę do przeprowadzenia dalszych analiz i modelowania.





W kolejnych sekcjach przedstawimy szczegółowe kroki przeprowadzone w
ramach tego etapu, w tym wyniki analizy braków danych oraz identyfikacji
wartości odstających, a także opis zastosowanych metod ich obsługi.



## **Obserwacje brakujące**



Do analizy brakujących danych zdecydowaliśmy się wykorzystać zarówno
wizualizacje które pozwolą zrozumieć skalę oraz potencjalne przyczyny
braków w zbiorze danych. Wizualizacje, takie jak **wykresy słupkowe**
prezentujące procent brakujących wartości w poszczególnych zmiennych
oraz graficzne przedstawienie wzorców braków, umożliwiają szybkie
zidentyfikowanie kolumn najbardziej dotkniętych problemem brakujących
danych. Dodatkowo zastosowanie **macierzy braków** pozwala na analizę
współwystępowania braków pomiędzy zmiennymi, co może wskazać na możliwe
zależności w danych.



Na podstawie klasyfikacji braków danych (MCAR, MAR, MNAR) możemy lepiej
zrozumieć przyczyny ich występowania.

-   **MCAR (Missing Completely At Random)**: Braki w kolumnach takich
    jak has_elevator i college_distance są losowe i wynikają z
    technicznych pominięć w zbieraniu danych.

-   **MAR (Missing At Random)**: Braki w kolumnach condition,
    building_material, oraz floor wynikają z powiązań między zmiennymi,
    np. building_type i floor_count.

-   **MNAR (Missing Not At Random)**: Braki w building_type mogą wynikać
    z mechanizmu niechęci podawania wartości (np. dla mieszkań
    luksusowych).

Dzięki tym wstępnym analizom możliwe jest odpowiednie dobranie metod
imputacji (np. medianą, modą lub bardziej zaawansowanymi metodami), a
także ewentualne usunięcie zmiennych, w których braki są zbyt liczne i
niemożliwe do uzupełnienia bez znaczącej utraty jakości danych.

```{r obserwacje_brakujace_wykresy, echo=FALSE, comment=FALSE}
missing_summary <- miss_var_summary(dane)

ggplot(missing_summary, aes(x = reorder(variable, -pct_miss), y = pct_miss)) +
  geom_bar(stat = "identity", fill = "plum2") +
  coord_flip() +
  labs(title = "Procent brakujących wartości w kolumnach",
       x = "Zmienne",
       y = "Procent braków (%)") +
  theme_minimal()
```

```{r obserwacje_brakujace_wykresy_2, echo=FALSE}
suppressMessages({
  vismiss <- vis_miss(dane) +
    scale_fill_manual(values = c("lightyellow", "orchid3"),
                      name = "Status danych",
                      labels = c("Dane obecne", "Braki danych")) +
    labs(
      title = "Braki danych w zbiorze",
      x = "Zmienne",
      y = "Obserwacje"
    ) +
    theme_minimal(base_size = 10) + 
    theme(
      plot.title = element_text(hjust = 0.5),
      axis.text.x = element_text(angle = 45, hjust = 0.2)
    )
  
  print(vismiss)
})
```

```{r Podsumowanie braków w tabeli, echo=FALSE}

missing_summary <- missing_summary %>%
  rename(
    Zmienna = variable,
    "Liczba braków" = n_miss,
    "Procent braków" = pct_miss
  ) %>%
  mutate(
    "Procent braków" = as.numeric(`Procent braków`) / 100,
    "Procent braków" = percent(`Procent braków`, accuracy = 0.1)
  )

# Podzielenie tabeli na dwie części
num_rows <- nrow(missing_summary)
split_index <- ceiling(num_rows / 2)

# Przygotowanie kolumn dla drugiej połowy tabeli
Zmienna_2 <- missing_summary$Zmienna[(split_index + 1):num_rows]
Liczba_brakow_2 <- missing_summary$`Liczba braków`[(split_index + 1):num_rows]
Procent_brakow_2 <- missing_summary$`Procent braków`[(split_index + 1):num_rows]

# Wyrównanie długości i uzupełnienie brakujących wartości pustymi znakami
Zmienna_2 <- c(Zmienna_2, rep("", split_index - length(Zmienna_2)))
Liczba_brakow_2 <- c(Liczba_brakow_2, rep("", split_index - length(Liczba_brakow_2)))
Procent_brakow_2 <- c(Procent_brakow_2, rep("", split_index - length(Procent_brakow_2)))

# Stworzenie kompaktowej tabeli
missing_summary_compact <- tibble(
  Zmienna_1 = missing_summary$Zmienna[1:split_index],
  `Liczba braków 1` = missing_summary$`Liczba braków`[1:split_index],
  `Procent braków 1` = missing_summary$`Procent braków`[1:split_index],
  Zmienna_2 = Zmienna_2,
  `Liczba braków 2` = Liczba_brakow_2,
  `Procent braków 2` = Procent_brakow_2
)

# Wyświetlenie tabeli w nowym formacie
kable(
  missing_summary_compact,
  col.names = c("Zmienna", "Liczba braków", "Procent braków", 
                "Zmienna", "Liczba braków", "Procent braków"),
  caption = "Podsumowanie brakujących danych"
) %>%
  kable_styling(
    full_width = FALSE,
    bootstrap_options = c("striped", "hover", "condensed")
  )

```

Analiza brakujących danych wskazuje, że kolumny w zbiorze można
podzielić na kilka grup pod względem liczby braków:

-   **Bardzo duża liczba braków:** `condition` (74.0%) i `building_material`
    (40.9%). Ze względu na ich wysoką niekompletność zdecydowaliśmy się
    usunąć kolumnę condition, a dla building_material zastosujemy
    imputację najczęstszą wartością.

-   **Umiarkowana liczba braków:** `building_type` (20.5%), `floor` (16.6%),
    `build_year` (15.7%). Uzupełnimy brakujące wartości odpowiednio metodą
    najczęstszej wartości dla zmiennych kategorycznych (`building_type`)
    oraz medianą dla zmiennych liczbowych (`floor`, `build_year`).

-   **Niewielka liczba braków:** Kolumny takie jak `has_elevator` (4.46%)
    czy `college_distance` (2.72%) zostaną uzupełnione odpowiednio modą i
    medianą.

-   **Bardzo mała liczba braków:** Pozostałe kolumny z mniej niż 1%
    braków zostaną imputowane prostymi metodami (medianą lub najczęstszą
    wartością).

-   **Kolumny bez braków:** Pozostałe zmienne, takie jak `price`,
    `square_meters` czy `rooms`, są kompletne i nie wymagają dodatkowych
    działań.

```{r Zastąpienie_braków_medianą_i_najczęstszą_wartością, echo = FALSE}

################################################################################

dane$floor<-imputate_na(dane, floor, method = "median")
dane$build_year<-imputate_na(dane, build_year, method = "median")
dane$college_distance<-imputate_na(dane, college_distance, method = "median")
dane$school_distance<-imputate_na(dane, school_distance, method = "median")
dane$pharmacy_distance<-imputate_na(dane, pharmacy_distance, method = "median")
dane$kindergarten_distance<-imputate_na(dane, kindergarten_distance, method = "median")
dane$clinic_distance<-imputate_na(dane, clinic_distance, method = "median")
dane$post_office_distance<-imputate_na(dane, post_office_distance, method = "median")
dane$restaurant_distance<-imputate_na(dane, restaurant_distance, method = "median")
dane$floor_count<-imputate_na(dane, floor_count, method = "median")
################################################################################

#table(na.omit(dane$building_type)) SPRAWDZENIE CZĘSTOSCI WYSTĘPOWANIA
#table(na.omit(dane$building_material)) SPRAWDZENIE CZĘSTOSCI WYSTĘPOWANIA
#table(na.omit(dane$has_elevator))

dane$building_type[is.na(dane$building_type)] <- "blockOfFlats"
dane$building_material[is.na(dane$building_material)] <- "brick"
dane$has_elevator[is.na(dane$has_elevator)] <- "yes"

dane$building_type <- factor(dane$building_type)
dane$building_material <- factor(dane$building_material)
dane$has_elevator <- factor(dane$has_elevator)

################################################################################
dane$condition <- NA
dane <- subset(dane, select = -condition)
################################################################################
```

```{r Dodanie_dodatkowych_kolumn_cena_za_metr_wiek_mieszkania,echo = FALSE}

# Dodanie kolumny z ceną za metr kwadratowy
dane$price_per_square_meter <- dane$price / dane$square_meters

# Dodanie kolumny z wiekiem mieszkania
currentYear <- format(Sys.Date(), "%Y")
dane$building_age <- ifelse(is.na(dane$build_year), NA, as.numeric(currentYear) - dane$build_year)
```

## **Obserwacje odstające**



Do analizy obserwacji odstających decydowaliśmy się użyć **wykresów
pudełkowych**, ponieważ są one prostym i skutecznym narzędziem
wizualizacyjnym, które pozwala szybko zidentyfikować wartości odstające.
Dzięki nim poznamy wartości minimalne, maksymalne, mediane, kwartyle
oraz ewentualne wartości wykraczające poza tzw. *wąsy*, czyli zakres
między pierwszym a trzecim kwartylem powiększony. Każda z analizowanych
zmiennych została przedstawiona na osobnym wykresie pudełkowym, co
pozwala dokładnie przyjrzeć się rozkładowi poszczególnych cech, takich
jak powierzchnia mieszkania, cena, cena za metr kwadratowy czy
odległości od różnych punktów użyteczności publicznej. Dzięki temu można
szybko zidentyfikować zmienne, które mogą zawierać nietypowe wartości i
potencjalnie wpłynąć na dalsze analizy lub modelowanie danych.





Dodatkowo, aby potwierdzić statystycznie obecność obserwacji odstających
zastosowaliśmy metodę Z-score oraz zbadaliśmy czy rozkład danych jest
zbliżony do rozkładu normalnego.



Metoda **Z-score**, polega na identyfikowaniu obserwacji odstających na
podstawie odchylenia standardowego od średniej. Wyraża się wzorem: $$
         Z = \frac{x - \bar{x}}{\sigma}
         $$ $x$: wartość obserwacji\
$\overline{x}$: średnia dla danej zmiennej\
$\sigma$: odchylenie standardowe.

**Skośność** jest statystyką umożliwiającą porównanie rozkładu
analizowanej zmiennej z hipotetycznym rozkładem normalnym. Wskazuje na
rozbieżności pomiędzy wartością średnią, a centrum danego rozkładu.
Wyraża się wzorem:

$$\tilde{\mu}_3 = \frac{\sum_{i}^{N} (X_i - \bar{X})^3}{(N - 1) \cdot \sigma^3}$$

-   $\tilde{\mu}_3$ = skośność
-   $N$ = liczba zmiennych w rozkładzie
-   $X_i$ = losowa zmienna
-   $\bar{X}$ = średnia rozkładu
-   $\sigma$ = odchylenie standardowe.

Interpretacja jest następująca:

-   Rozkład prawoskośny -- skośność jest dodatnia, prawe ramię rozkładu
    jest wydłużone, wyniki poniżej średniej są przeważające w badanej
    próbce.

-   Rozkład symetryczny -- skośność wynosi 0, ogony rozkładu są
    identyczne w obu kierunkach. Jeśli znormalizowana kurtoza wynosi 0,
    rozkład jest zbliżony do rozkładu normalnego.

-   Rozkład lewoskośny -- skośność jest ujemna, lewe ramię rozkładu jest
    wydłużone, większość obserwacji w próbie ma wartości powyżej
    średniej.

**Rozkład normalny** nazywany również rozkładem Gaussa lub rozkładem
Gaussowskim, jest jednym z najważniejszych i najczęściej stosowanych
rozkładów w statystyce. Jego wykres przyjmuje charakterystyczny kształt
dzwonu, dlatego często określa się go mianem krzywej dzwonowej.

***Właściwości rozkładu normalnego:***

1.  Symetria: Rozkład normalny jest symetryczny względem swojej
    średniej. Oznacza to, że wartości po obu stronach średniej są
    równomiernie rozłożone.

2.  Średnia, mediana i dominanta: W rozkładzie normalnym średnia,
    mediana i dominanta (wartość modalna) są równe i znajdują się w
    centrum rozkładu.

3.  Kształt: Krzywa rozkładu normalnego ma jeden szczyt (jest
    jednoszczytowa), a jej ogony asymptotycznie zbliżają się do osi
    poziomej, co oznacza, że prawdopodobieństwo wartości bardzo
    odległych od średniej nigdy nie wynosi dokładnie 0, ale jest bardzo
    małe.

4.  Funkcja gęstości: Matematyczny wzór funkcji gęstości rozkładu
    normalnego: $$
    f(x) = \frac{1}{\sigma \sqrt{2\pi}} e^{-\frac{(x-\mu)^2}{2\sigma^2}}
    $$ gdzie:

    -   $\mu$ -- średnia,
    -   $\sigma$ -- odchylenie standardowe,
    -   $x$ -- wartość zmiennej losowej.

Rozkład normalny jest fundamentem wielu metod statystycznych, np. testów
hipotez, regresji czy analizy wariancji.

### Wykresy pudełkowe

```{r zamiana_na_numeryczne, echo=FALSE}
dane$building_age <- as.numeric(dane$building_age)
dane$latitude <- as.numeric(dane$latitude)
dane$longitude <- as.numeric(dane$longitude)
dane$centre_distance <- as.numeric(dane$centre_distance)
dane$school_distance <- as.numeric(dane$school_distance)
dane$clinic_distance <- as.numeric(dane$clinic_distance)
dane$post_office_distance <- as.numeric(dane$post_office_distance)
dane$kindergarten_distance <- as.numeric(dane$kindergarten_distance)
dane$college_distance <- as.numeric(dane$college_distance)
dane$restaurant_distance <- as.numeric(dane$restaurant_distance)
dane$pharmacy_distance <- as.numeric(dane$pharmacy_distance)
dane$floor_count <- as.numeric(dane$floor_count)
```

<a id="square_metersBoxPlot"></a> <a id="priceBoxPlot"></a>
<a id="price_per_square_meterBoxPlot"></a> <a id="roomsBoxPlot"></a>
<a id="floorBoxPlot"></a> <a id="floor_countBoxPlot"></a>
<a id="building_ageBoxPlot"></a> <a id="centre_distanceBoxPlot"></a>
<a id="school_distanceBoxPlot"></a>

```{r boxplot_odst, fig.height=10, fig.width=10, echo=FALSE, fig.show='hold'}
# Renderowanie pierwszej strony (9 wykresów)
par(mfrow = c(3, 3))  # Układ 3x3
boxplot(dane$square_meters, main = "Square Meters", col = "skyblue")
boxplot(dane$price, main = "Price", col = "plum")
boxplot(dane$price_per_square_meter, main = "Price Per Square Meter", col = "peachpuff")
boxplot(dane$rooms, main = "Rooms", col = "palegreen2")
boxplot(dane$floor, main = "Floors", col = "powderblue")
boxplot(dane$floor_count, main = "Floor Count", col = "thistle3")
boxplot(dane$building_age, main = "Building Age", col = "salmon")
boxplot(dane$centre_distance, main = "Centre Distance", col = "pink4")
boxplot(dane$school_distance, main = "School Distance", col = "pink")
```

<a id="clinic_distanceBoxPlot"></a>
<a id="post_office_distanceBoxPlot"></a>
<a id="kindergarten_distanceBoxPlot"></a>
<a id="restaurant_distanceBoxPlot"></a>
<a id="college_distanceBoxPlot"></a>
<a id="pharmacy_distanceBoxPlot"></a>

```{r boxplot_odst2, fig.height=7, fig.width=10, echo=FALSE, fig.show='hold'}
# Resetowanie układu
par(mfrow = c(2, 3))  # Układ 2x3 dla 6 miejsc

# Renderowanie drugiej strony (5 wykresów + puste miejsce)
boxplot(dane$clinic_distance, main = "Clinic Distance", col = "orange")
boxplot(dane$post_office_distance, main = "Post Office Distance", col = "coral")
boxplot(dane$kindergarten_distance, main = "Kindergarden Distance", col = "lavender")
boxplot(dane$restaurant_distance, main = "Restaurant Distance", col = "khaki")
boxplot(dane$college_distance, main = "College Distance", col = "indianred")
boxplot(dane$pharmacy_distance, main = "Pharmacy Distance", col = "lavenderblush2")
```

#### **Interpretacja wyników wykresów pudełkowych**

Przeprowadzona analiza wykresów pudełkowych pozwoliła na dokładne
przyjrzenie się rozkładom badanych cech mieszkań, takich jak
powierzchnia, cena, liczba pokoi oraz odległości do punktów użyteczności
publicznej. Wykresy te umożliwiły identyfikację wartości **typowych**
(mediana, kwartyle) oraz **wartości odstających**, które wykraczają poza
zakres wyznaczony przez *wąsy*.\

Wartości odstające są szczególnie istotne, ponieważ mogą wskazywać na
specyficzne obserwacje, takie jak:

-   **Nieruchomości luksusowe** lub o nietypowej wielkości i cenie,\
-   **Mieszkania położone w trudno dostępnych lokalizacjach**,\
-   **Nieruchomości w starszych budynkach** lub obszarach o słabo
    rozwiniętej infrastrukturze.

Poniżej przedstawiono szczegółową interpretację wyników dla każdej z
analizowanych zmiennych.

[**square_meters**](#square_metersBoxPlot) - Mediana powierzchni wynosi
około **50-60 m²**.\
- Większość mieszkań mieści się w zakresie **40-80 m²**.\
- **Wartości odstające** powyżej **100 m²** wskazują na większe
apartamenty lub luksusowe nieruchomości.

[**price**](#priceBoxPlot)\
- Mediana ceny mieszkań wynosi około **750 tys. zł**.\
- Typowe wartości mieszczą się w przedziale **500 tys. -- 1 mln zł**.\
- Liczne **wartości odstające** powyżej **2,5 mln zł** sugerują obecność
luksusowych nieruchomości w analizowanym zbiorze.

[**price_per_square_meter**](#price_per_square_meterBoxPlot) - Mediana
wynosi około **15 000 zł/m²**, a większość wartości mieści się w
zakresie **10 000 -- 20 000 zł/m²**.\
- **Wartości odstające** przekraczające **30 000 zł/m²** mogą wynikać z
mieszkań położonych w bardzo prestiżowych lokalizacjach.

[**rooms**](#roomsBoxPlot)\
- Typowe mieszkania mają **2-3 pokoje**, co potwierdza mediana.\
- **Wartości odstające** (4-6 pokoi) mogą wskazywać na większe
mieszkania lub apartamenty rodzinne.

[**floor**](#floorBoxPlot)\
- Mediana piętra to około **2**.\
- Większość mieszkań znajduje się na **1-5 piętrze**.\
- **Wartości odstające** powyżej **15 piętra** sugerują obecność
mieszkań w wieżowcach.

[**floor_count**](#floor_countBoxPlot)\
- Typowe budynki mają **4-6 pięter**.\
- **Wartości odstające** powyżej **15 pięter** wskazują na obecność
wysokich budynków mieszkalnych.

[**building_age**](#building_ageBoxPlot)\
- Mediana wieku budynków wynosi około **50 lat**.\
- Budynki mające więcej niż **100 lat** to **wartości odstające**, co
sugeruje obecność starszych, często zabytkowych nieruchomości.

[**centre_distance**](#centre_distanceBoxPlot) - Typowa odległość to
**2-8 km**.\
- **Wartości odstające** powyżej **15 km** wskazują na nieruchomości
położone na przedmieściach lub w odległych lokalizacjach.

[**school_distance**](#school_distanceBoxPlot) - Większość szkół
znajduje się w odległości **do 1 km**.\
- **Wartości odstające** powyżej **4 km** mogą świadczyć o gorszej
dostępności edukacji w analizowanych lokalizacjach.

[**clinic_distance**](#clinic_distanceBoxPlot)\
- Kliniki są najczęściej położone **do 1 km** od mieszkań.\
- **Wartości odstające** powyżej **3 km** wskazują na obszary o niższym
dostępie do opieki zdrowotnej.

[**post_office_distance**](#post_office_distanceBoxPlot)\
- Typowa odległość wynosi **0-1 km**.\
- **Wartości odstające** powyżej **4 km** mogą wynikać z mniej
zurbanizowanych obszarów.

[**kindergarten_distance**](#kindergarten_distanceBoxPlot) - Przedszkola
znajdują się głównie **do 1 km** od mieszkań.\
- **Wartości odstające** powyżej **3 km** sugerują problemy z dostępem
do usług dla rodzin z dziećmi.

[**restaurant_distance**](#restaurant_distanceBoxPlot)\
- Restauracje znajdują się typowo **do 1 km** od mieszkań.\
- **Wartości odstające** powyżej **5 km** wskazują na peryferyjne
lokalizacje z ograniczoną ofertą gastronomiczną.

[**college_distance**](#college_distanceBoxPlot) - Typowa odległość
wynosi **1-2 km**.\
- **Wartości odstające** do **5 km** sugerują lokalizacje mniej
centralne pod względem infrastruktury edukacyjnej.

[**pharmacy_distance**](#pharmacy_distanceBoxPlot) - Apteki znajdują się
zazwyczaj **do 1 km** od mieszkań.\
- **Wartości odstające** powyżej **4 km** wskazują na obszary o
ograniczonym dostępie do usług farmaceutycznych.

Analiza wykresów pudełkowych potwierdziła występowanie wartości
odstających w każdej z badanych zmiennych. Są one szczególnie istotne,
ponieważ mogą wskazywać na specyficzne segmenty rynku nieruchomości --
luksusowe mieszkania, nieruchomości historyczne lub obszary z
ograniczoną infrastrukturą.

Zidentyfikowane wartości odstające będą miały istotne znaczenie w
dalszym modelowaniu oraz analizach statystycznych. Warto w kolejnych
krokach rozważyć, czy te obserwacje powinny zostać zachowane jako
istotne dla analizy, czy też przekształcone lub usunięte w zależności od
kontekstu biznesowego i analitycznego.

### Skośność

<a id="centre_distancePlot"></a> <a id="poi_countPlot"></a>
<a id="school_distancePlot"></a> <a id="clinic_distancePlot"></a>
<a id="post_office_distancePlot"></a>
<a id="kindergarten_distancePlot"></a>
<a id="restaurant_distancePlot"></a> <a id="college_distancePlot"></a>
<a id="pharmacy_distancePlot"></a>

```{r skosnosc, echo = FALSE, eval = TRUE, fig.height=6, fig.width=8}
par(mfrow = c(3, 3))  # Układ 3x3
hist(na.omit(dane$centre_distance), 
     probability = TRUE, 
     col = "plum1", 
     main = "Histogram - centre_distance", 
     xlab = "centre_distance")
curve(dnorm(x, mean = mean(na.omit(dane$centre_distance)), 
            sd = sd(na.omit(dane$centre_distance))), 
      col = "plum4", 
      lwd = 2, 
      add = TRUE)

# poi_count
hist(na.omit(dane$poi_count), 
     probability = TRUE, 
     col = "lightblue", 
     main = "Histogram - poi_count", 
     xlab = "poi_count")
curve(dnorm(x, mean = mean(na.omit(dane$poi_count)), 
            sd = sd(na.omit(dane$poi_count))), 
      col = "darkblue", 
      lwd = 2, 
      add = TRUE)

# school_distance
hist(na.omit(dane$school_distance), 
     probability = TRUE, 
     col = "lightgreen", 
     main = "Histogram - school_distance", 
     xlab = "school_distance")
curve(dnorm(x, mean = mean(na.omit(dane$school_distance)), 
            sd = sd(na.omit(dane$school_distance))), 
      col = "green4", 
      lwd = 2, 
      add = TRUE)

# clinic_distance
hist(na.omit(dane$clinic_distance), 
     probability = TRUE, 
     col = "lightpink", 
     main = "Histogram - clinic_distance", 
     xlab = "floor_count")
curve(dnorm(x, mean = mean(na.omit(dane$clinic_distance)), 
            sd = sd(na.omit(dane$clinic_distance))), 
      col = "violet", 
      lwd = 2, 
      add = TRUE)

# post_office_distance
hist(na.omit(dane$post_office_distance), 
     probability = TRUE, 
     col = "peachpuff", 
     main = "Histogram - post_office_distance", 
     xlab = "post_office_distance")
curve(dnorm(x, mean = mean(na.omit(dane$post_office_distance)), 
            sd = sd(na.omit(dane$post_office_distance))), 
      col = "orange1", 
      lwd = 2, 
      add = TRUE)

# kindergarten_distance
hist(na.omit(dane$kindergarten_distance), 
     probability = TRUE, 
     col = "lightyellow", 
     main = "Histogram - kindergarten_distance", 
     xlab = "kindergarten_distance")
curve(dnorm(x, mean = mean(na.omit(dane$kindergarten_distance)), 
            sd = sd(na.omit(dane$kindergarten_distance))), 
      col = "yellow2", 
      lwd = 2, 
      add = TRUE)
# restaurant_distance
hist(na.omit(dane$restaurant_distance), 
     probability = TRUE, 
     col = "grey", 
     main = "Histogram - restaurant_distance", 
     xlab = "restaurant_distance")
curve(dnorm(x, mean = mean(na.omit(dane$restaurant_distance)), 
            sd = sd(na.omit(dane$restaurant_distance))), 
      col = "grey1", 
      lwd = 2, 
      add = TRUE)
# college_distance
hist(na.omit(dane$college_distance), 
     probability = TRUE, 
     col = "red4", 
     main = "Histogram - college_distance", 
     xlab = "college_distance")
curve(dnorm(x, mean = mean(na.omit(dane$college_distance)), 
            sd = sd(na.omit(dane$college_distance))), 
      col = "tomato1", 
      lwd = 2, 
      add = TRUE)
# pharmacy_distance
hist(na.omit(dane$pharmacy_distance), 
     probability = TRUE, 
     col = "skyblue1", 
     main = "Histogram - pharmacy_distance", 
     xlab = "pharmacy_distance")
curve(dnorm(x, mean = mean(na.omit(dane$pharmacy_distance)), 
            sd = sd(na.omit(dane$pharmacy_distance))), 
      col = "dodgerblue3", 
      lwd = 2, 
      add = TRUE)
```

<a id="building_agePlot"></a> <a id="square_metersPlot"></a>
<a id="pricePlot"></a> <a id="floorPlot"></a>
<a id="floor_countPlot"></a> <a id="build_yearPlot"></a>

```{r skosnosc_hist2, echo = FALSE, eval = TRUE, fig.height=4, fig.width=8}
par(mfrow = c(2, 3))  # Układ 3x3
# post_office_distance
hist(na.omit(dane$building_age), 
     probability = TRUE, 
     col = "palegoldenrod", 
     main = "Histogram - building_age", 
     xlab = "building_age")
curve(dnorm(x, mean = mean(na.omit(dane$building_age)), 
            sd = sd(na.omit(dane$building_age))), 
      col = "palegreen3", 
      lwd = 2, 
      add = TRUE)

# square_meters
hist(na.omit(dane$square_meters), 
     probability = TRUE, 
     col = "deeppink", 
     main = "Histogram - square_meters", 
     xlab = "square_meters")
curve(dnorm(x, mean = mean(na.omit(dane$square_meters)), 
            sd = sd(na.omit(dane$square_meters))), 
      col = "deeppink4", 
      lwd = 2, 
      add = TRUE)

# price
hist(na.omit(dane$price), 
     probability = TRUE, 
     col = "antiquewhite", 
     main = "Histogram - price", 
     xlab = "price")
curve(dnorm(x, mean = mean(na.omit(dane$price)), 
            sd = sd(na.omit(dane$price))), 
      col = "indianred2", 
      lwd = 2, 
      add = TRUE)

# floor
hist(na.omit(dane$floor), 
     probability = TRUE, 
     col = "slategray2", 
     main = "Histogram - floor", 
     xlab = "floor")
curve(dnorm(x, mean = mean(na.omit(dane$floor)), 
            sd = sd(na.omit(dane$floor))), 
      col = "orchid", 
      lwd = 2, 
      add = TRUE)

# floor_count
hist(na.omit(dane$floor_count), 
     probability = TRUE, 
     col = "burlywood", 
     main = "Histogram - floor_count", 
     xlab = "floor_count")
curve(dnorm(x, mean = mean(na.omit(dane$floor_count)), 
            sd = sd(na.omit(dane$floor_count))), 
      col = "burlywood4", 
      lwd = 2, 
      add = TRUE)

# build_year
hist(na.omit(dane$build_year), 
     probability = TRUE, 
     col = "lightblue", 
     main = "Histogram - build_year", 
     xlab = "build_year")
curve(dnorm(x, mean = mean(na.omit(dane$build_year)), 
            sd = sd(na.omit(dane$build_year))), 
      col = "darkblue", 
      lwd = 2, 
      add = TRUE)
```

#### **Interpretacja wyników histogramów**



Przeprowadzona analiza histogramów pozwoliła na dokładne przyjrzenie się
rozkładom badanych cech mieszkań, takich jak powierzchnia, cena, liczba
pięter oraz odległości do punktów użyteczności publicznej. Wykresy te
umożliwiły identyfikację wartości **typowych** (dominanty, gęstość
wartości) oraz **wartości odstających**, które znajdują się na krańcach
rozkładów.



Linie rozkładu normalnego, nałożone na histogramy, stanowią dodatkowy
punkt odniesienia do oceny kształtu rozkładów. Pozwalają one
zidentyfikować:

-   **Odstępstwa od normalności**, takie jak skośność czy
    wielomodalność,\
-   **Stopień zgodności rozkładów empirycznych z teoretycznym rozkładem
    normalnym**,\
-   **Przesunięcia względem środka rozkładu** sugerujące koncentrację
    danych.

------------------------------------------------------------------------

[**centre_distance**](#centre_distancePlot)**:** - Rozkład jest
**prawoskośny** z koncentracją wartości w zakresie **2-8 km**.\
- Linia rozkładu normalnego pokazuje, że rozkład empiryczny jest
odchylony w prawo.\
- Wartości powyżej **10 km** stanowią odstępstwa, które wskazują na
nieruchomości w peryferyjnych lokalizacjach, co jest nietypowe dla
większości analizowanych danych.

[**poi_count**](#poi_countPlot) - Histogram pokazuje **wysoce
prawoskośny** rozkład, gdzie większość obserwacji znajduje się poniżej
**50**.\
- Linia rozkładu normalnego podkreśla duże odchylenie od symetrii, co
sugeruje, że większość lokalizacji ma ograniczoną liczbę punktów
użyteczności publicznej, natomiast pojedyncze przypadki z bardzo dużymi
wartościami (powyżej **100**) są wyjątkami.

[**school_distance**](#school_distancePlot)\
- Rozkład odległości jest **prawoskośny**, z dominacją wartości **0-1
km**.\
- Linia normalna nie pasuje do rozkładu, co wskazuje na silną
koncentrację danych blisko **0 km**.\
- Wartości odstające powyżej **3 km** sugerują lokalizacje z
ograniczonym dostępem do szkół.

[**clinic_distance**](#clinic_distancePlot)\
- Histogram pokazuje **prawoskośny rozkład**, z większością wartości w
przedziale **do 1 km**.\
- Linia rozkładu normalnego wyraźnie nie oddaje koncentracji danych w
niższych wartościach.\
- Wartości powyżej **3 km** sugerują trudniejszy dostęp do opieki
zdrowotnej w mniej zurbanizowanych obszarach.

[**post_office_distance**](#post_office_distancePlot)\
- Rozkład jest **prawoskośny**, z typowymi wartościami **0,5--1 km**.\
- Linia rozkładu normalnego wskazuje na istotne odchylenie od
normalności, co podkreśla silne skupienie danych w niższych
przedziałach.

[**restaurant_distance**](#restaurant_distancePlot)\
- Histogram ujawnia koncentrację wartości w zakresie **do 1 km** z
pojedynczymi przypadkami powyżej **3 km**.\
- Przesunięcie względem linii normalnej podkreśla ograniczoną liczbę
nieruchomości o znacznej odległości od restauracji.

[**college_distance**](#college_distancePlot)\
- Wartości typowe mieszczą się w przedziale **1--2 km**, natomiast
histogram jest **lekko prawoskośny**.\
- Linia rozkładu normalnego dobrze przybliża dane w środkowej części,
jednak widać odchylenia w wyższych wartościach (powyżej **4 km**).

[**pharmacy_distance**](#pharmacy_distancePlot) - Histogram jest
**silnie prawoskośny**, z wartościami typowymi **do 1 km**.\
- Linia normalna nie jest dopasowana, co sugeruje, że rozkład empiryczny
jest skupiony na jednym krańcu.

------------------------------------------------------------------------

[**square_meters**](#square_metersPlot) - Rozkład powierzchni mieszkań
jest **prawoskośny**, z wartościami dominującymi w przedziale **40--80
m²**.\
- Linia rozkładu normalnego sugeruje większą symetrię niż istnieje w
danych.\
- **Wartości odstające** powyżej **100 m²** wskazują na duże
apartamenty, które są nietypowe.

[**price**](#pricePlot) - Histogram jest **wysoce prawoskośny**, z
typowymi cenami **500 tys. -- 1 mln zł**.\
- Rozkład empiryczny jest znacznie przesunięty względem linii normalnej,
co podkreśla nierównomierną strukturę cen na rynku.

[**floor**](#floorPlot) - Większość mieszkań znajduje się na **1-5
piętrze**.\
- Linia rozkładu normalnego odbiega od rzeczywistego kształtu, który
jest **skośny**, z kilkoma wartościami odstającymi powyżej **15
piętra**.

[**floor_count**](#floor_countPlot) - Rozkład pokazuje, że typowe
budynki mają **4-6 pięter**.\
- Linia normalna nie oddaje koncentracji w niskich wartościach oraz
odstępstw w wysokich budynkach.

[**building_age**](#building_agePlot) - Histogram wskazuje, że większość
budynków ma mniej niż **50 lat**.\
- Rozkład jest prawoskośny, a linia normalna sugeruje większą symetrię
niż rzeczywiście istnieje.

[**build_year**](#build_yearPlot) - Rozkład pokazuje koncentrację
budynków wybudowanych po **1950 roku**.\
- Linia normalna dobrze dopasowuje się do danych, jednak rozkład jest
lekko przesunięty ku nowszym budynkom.

------------------------------------------------------------------------

Analiza histogramów, w połączeniu z linią rozkładu normalnego,
dostarczyła następujących wniosków:

-   **Większość rozkładów jest prawoskośna**, co sugeruje koncentrację
    wartości w niższych przedziałach oraz obecność kilku wartości
    odstających.\
-   Linie normalne pozwoliły zidentyfikować rozbieżności między
    rozkładami empirycznymi a teoretycznym rozkładem normalnym.\
-   **Wartości odstające** są widoczne w wielu zmiennych, zwłaszcza w
    powierzchni mieszkań, cenach oraz odległościach do punktów
    użyteczności publicznej.

Wyniki te potwierdzają specyfikę rynku nieruchomości, gdzie typowe
wartości są skoncentrowane w określonych zakresach, a odstępstwa
wskazują na szczególne przypadki, które mogą być analizowane osobno.

### Test Andersona-Darlinga

Test Andersona-Darlinga jest statystycznym testem zgodności, który
ocenia, jak dobrze dane pasują do określonego rozkładu teoretycznego.
Zwykle stosuje się go do sprawdzenia zgodności z rozkładem normalnym.
Jest modyfikacją testu Craméra-von Misesa dokonaną w celu poprawy jego
czułości w „ogonach" testowanego rozkładu.

#### **Hipotezy**

Test Andersona-Darlinga przeprowadza się w celu sprawdzenia hipotez:

-   **Hipoteza zerowa (**$H_0$): Dane pochodzą z określonego rozkładu
    (np. normalnego, wykładniczego).

-   **Hipoteza alternatywna (**$H_1$): Dane nie pochodzą z tego
    rozkładu.

#### **Funkcja testowa**

Test Andersona-Darlinga oblicza statystykę testową $A^2$, która jest
zdefiniowana jako:

$$
A^2 = -n - \sum_{i=1}^n \frac{2i - 1}{n} \left[ \ln(F(X_i)) + \ln(1 - F(X_{n+1-i})) \right]
$$

gdzie: - $n$ -- liczba obserwacji w próbie, - $F(x)$ - dystrybuanta
rozkładu wzorcowego, - $X_{(i)}$ - i-ta zaobserwowana wartość w próbie
uporządkowanej rosnąco

Test Anderson-Darling przyjmuje zasadę, że jeżeli wartość p jest bardzo
niska, niższa niż 0,05, wtedy przyjmuje się, że rozkład danych nie jest
zgodny z rozkładem normalnym. Przyjmuje się takie założenie, jeżeli
został przyjęty poziom istotności 0,05.

```{r, echo=FALSE}
normalnosc_price <- ad.test(dane$price)
normalnosc_square_meters <- ad.test(dane$square_meters)
normalnosc_centre_distance <- ad.test(dane$centre_distance)
normalnosc_floor <- ad.test(dane$floor)
normalnosc_floor_count <- ad.test(dane$floor_count)
normalnosc_poi <- ad.test(dane$poi_count)
normalnosc_school <- ad.test(dane$school_distance)
normalnosc_kinder <- ad.test(dane$kindergarten_distance)
normalnosc_clinic <- ad.test(dane$clinic_distance)
normalnosc_post <- ad.test(dane$post_office_distance)
normalnosc_restaurant <- ad.test(dane$restaurant_distance)
normalnosc_college <- ad.test(dane$college_distance)
normalnosc_pharmacy <- ad.test(dane$pharmacy_distance)
normalnosc_age <- ad.test(dane$building_age)
```

```{r, echo=FALSE, results='asis', eval=TRUE}
wyniki_normalnosci <- data.frame(
  Zmienne = c("price", "square_meters", "centre_distance", "floor", "floor_count", "poi_count", "school_distance", 
              "kindergarten_distance", "clinic_distance", "post_office_distance", "restaurant_distance", 
              "college_distance", "pharmacy_distance", "building_age"),
  Wartości_p_value = c(
    format(normalnosc_price$p.value, scientific = TRUE, digits = 4),
    format(normalnosc_square_meters$p.value, scientific = TRUE, digits = 4),
    format(normalnosc_centre_distance$p.value, scientific = TRUE, digits = 4),
    format(normalnosc_floor$p.value, scientific = TRUE, digits = 4),
    format(normalnosc_floor_count$p.value, scientific = TRUE, digits = 4),
    format(normalnosc_poi$p.value, scientific = TRUE, digits = 4),
    format(normalnosc_school$p.value, scientific = TRUE, digits = 4),
    format(normalnosc_kinder$p.value, scientific = TRUE, digits = 4),
    format(normalnosc_clinic$p.value, scientific = TRUE, digits = 4),
    format(normalnosc_post$p.value, scientific = TRUE, digits = 4),
    format(normalnosc_restaurant$p.value, scientific = TRUE, digits = 4),
    format(normalnosc_college$p.value, scientific = TRUE, digits = 4),
    format(normalnosc_pharmacy$p.value, scientific = TRUE, digits = 4),
    format(normalnosc_age$p.value, scientific = TRUE, digits = 4)
  )
)

knitr::kable(wyniki_normalnosci, caption = "Wyniki testu Andersona-Darlinga")
```

<a id="Anderson_Darling"></a>

Wyniki testu Andersona-Darlinga wskazują na ekstremalnie małe wartości
$p$-value ($3.7 \times 10^{-24}$) dla wszystkich analizowanych
zmiennych, co oznacza, że należy odrzucić hipotezę zerową zakładającą
normalność rozkładu. Dane dla zmiennych takich jak
`price, square_meters, centre_distance` i pozostałych znacząco odbiegają
od rozkładu normalnego, co jest również widoczne na powyższych
histogamach.

### Z-score

```{r z-score, echo = FALSE}
# mean((dane$build_year-mean(dane$build_year))/sd(dane$build_year))
# mean((dane$price-mean(dane$price))/sd(dane$price))
# mean((dane$square_meters-mean(dane$square_meters))/sd(dane$square_meters))
# mean((dane$price_per_square_meter-mean(dane$price_per_square_meter))/sd(dane$price_per_square_meter))
# mean((dane$rooms-mean(dane$rooms))/sd(dane$rooms))
# mean((dane$floor-mean(dane$floor))/sd(dane$floor))
# mean((dane$floor_count-mean(dane$floor_count))/sd(dane$floor_count))
# mean((dane$centre_distance-mean(dane$centre_distance))/sd(dane$centre_distance))
# mean((dane$building_age-mean(dane$building_age))/sd(dane$building_age))
# mean((dane$school_distance-mean(dane$school_distance))/sd(dane$school_distance))
# mean((dane$clinic_distance-mean(dane$clinic_distance))/sd(dane$clinic_distance))
# mean((dane$post_office_distance-mean(dane$post_office_distance))/sd(dane$post_office_distance))
# mean((dane$kindergarten_distance-mean(dane$kindergarten_distance))/sd(dane$kindergarten_distance))
# mean((dane$restaurant_distance-mean(dane$restaurant_distance))/sd(dane$restaurant_distance))
# mean((dane$college_distance-mean(dane$college_distance))/sd(dane$college_distance))
# mean((dane$pharmacy_distance-mean(dane$pharmacy_distance))/sd(dane$pharmacy_distance))
# mean((dane$poi_count-mean(dane$poi_count))/sd(dane$poi_count))
```

```{r tab_zscore, results='asis', eval=TRUE, echo=FALSE}

wyniki <- data.frame(
  Zmienna = c("build_year", "price", "square_meters", "price_per_square_meter", "rooms",
              "floor", "floor_count", "centre_distance", "building_age", "school_distance",
              "clinic_distance", "post_office_distance", "kindergarten_distance", 
              "restaurant_distance", "college_distance", "pharmacy_distance", "poi_count"),
  Wartość = c("1.321569e-15", "9.155718e-17", "3.0552e-17", "-5.888089e-17", "-1.961117e-16",
              "-3.274304e-17", "-9.234339e-17", "-1.348539e-16", "8.221441e-17", "1.247826e-17",
             " 2.77439e-17", "9.446714e-17", "-4.220434e-17", "5.62074e-17", "-2.656712e-17",
              "-1.519166e-17", "-2.97876e-17")
)
knitr::kable(wyniki, caption = "Wyniki Z-Score")
```



Standaryzacja przy użyciu z-score umożliwia identyfikację wartości
odstających. Wartości, które są znacznie większe lub mniejsze niż 3
odchylenia standardowe, mogą być traktowane jako odstające. Zastosowanie
z-score zapewniło, że wszystkie analizowane zmienne są zbalansowane
wokół średniej, co stanowi podstawę do dalszych, bardziej szczegółowych
analiz. Większość wartości w danych jest symetrycznie rozłożona wokół
średniej i nie dominuje żaden zbiór ekstremalnych wartości.



### Transformacje

```{r transformacja_price, echo = FALSE, fig.height=4, fig.width=8}
par(mfrow = c(1,2))
# price
# wykres przed transformacją
hist(na.omit(dane$price), 
     probability = TRUE, 
     col = "antiquewhite", 
     main = "Original: Histogram - price", 
     xlab = "price")
curve(dnorm(x, mean = mean(na.omit(dane$price)), 
            sd = sd(na.omit(dane$price))), 
      col = "indianred2", 
      lwd = 2, 
      add = TRUE)

# po transformacji
dane$price <- log(dane$price)
hist(na.omit(dane$price), 
     probability = TRUE, 
     col = "antiquewhite", 
     main = "Histogram - log(price)", 
     xlab = "price")
curve(dnorm(x, mean = mean(na.omit(dane$price)), 
            sd = sd(na.omit(dane$price))), 
      col = "indianred2", 
      lwd = 2, 
      add = TRUE)
```

```{r transformacja_price_per_square_meter, echo = FALSE, fig.height=4, fig.width=8}
par(mfrow = c(1,2))
# poi_count
# wykres przed transformacją
hist(na.omit(dane$poi_count), 
     probability = TRUE, 
     col = "goldenrod1", 
     main = "Original: Histogram - poi_count", 
     xlab = "poi_count")
curve(dnorm(x, mean = mean(na.omit(dane$poi_count)), 
            sd = sd(na.omit(dane$poi_count))), 
      col = "darkblue", 
      lwd = 2, 
      add = TRUE)

# po transformacji
dane$poi_count <- log(dane$poi_count + 1)
hist(na.omit(dane$poi_count), 
     probability = TRUE, 
     col = "goldenrod1", 
     main = "Histogram - log(poi_count+1)", 
     xlab = "poi_count")
curve(dnorm(x, mean = mean(dane$poi_count), 
            sd = sd(na.omit(dane$poi_count))), 
      col = "darkblue", 
      lwd = 2, 
      add = TRUE)

```

#### Transformacja zmiennej price oraz poi_count

##### Powody przeprowadzenia transformacji logarytmicznej:

1.  **Zmniejszenie wpływu wartości odstających**:
    -   W zmiennych takich jak `price` i `poi_count` występują duże
        wartości odstające. Dla ceny może to być kilka luksusowych
        apartamentów o bardzo wysokiej cenie, a dla liczby punktów
        zainteresowania miejsca z wyjątkowo dużą liczbą udogodnień w
        okolicy. Transformacja logarytmiczna zmniejsza wpływ tych
        skrajnych wartości na analizy.
2.  **Poprawa rozkładu zmiennych**:
    -   Cena mieszkań oraz liczba punktów zainteresowania często mają
        rozkład prawoskośny, co oznacza, że większość wartości jest
        skupiona przy niższych wartościach, ale pojawiają się też
        wyższe, rzadkie wartości. Logarytm zmniejsza tę asymetrię,
        zbliżając dane do rozkładu normalnego, co ułatwia interpretację
        i modelowanie statystyczne.

##### Interpretacja:

Po transformacji: - **Rozkład zmiennej price** jest bardziej
symetryczny, co ułatwi modelowanie zależności między ceną a innymi
zmiennymi. - **Rozkład zmiennej poi_count** jest mniej skośny, co
pozwoli lepiej zrozumieć wpływ liczby punktów zainteresowania na
analizowane wyniki.

#### Uzasadnienie braku transformacji dla poszczególnych kolumn

1.  `square_meters`
    -   **Uzasadnienie**: Duże wartości tej zmiennej (np. powyżej 200
        m²) mogą odnosić się do apartamentów luksusowych lub
        przestronnych domów, co jest zrozumiałe w kontekście rynku
        nieruchomości. Asymetria rozkładu wynika z faktu, że małe
        mieszkania są bardziej powszechne, ale większe jednostki wciąż
        mają naturalne uzasadnienie.
2.  `rooms`
    -   **Uzasadnienie**: Liczba pokoi w mieszkaniach czy domach jest
        zwykle niewielka i wynika z ich przeznaczenia. Duże liczby (np.
        7--10 pokoi) mogą odnosić się do dużych domów jednorodzinnych
        lub luksusowych apartamentów. Każda wartość zmiennej ma swoje
        logiczne wyjaśnienie.
3.  `floor` oraz `floor_count`
    -   **Uzasadnienie**: Wysokie wartości (np. powyżej 10. piętra)
        zazwyczaj odnoszą się do mieszkań w wieżowcach, co jest typowe w
        dużych miastach. Rozkład zmiennej jest zgodny z różnorodnością
        rynku.
4.  `build_year`
    -   **Uzasadnienie**: Starsze budynki (np. przedwojenne) mają swoje
        unikalne cechy (np. kamienice), a nowe budynki charakteryzują
        nowoczesne technologie i standardy. Każda wartość zmiennej
        niesie ze sobą istotny kontekst historyczny i architektoniczny.
5.  `centre_distance`
    -   **Uzasadnienie**: Duże odległości (np. \>20 km) zwykle oznaczają
        mieszkania na przedmieściach lub w miejscowościach satelickich,
        co jest naturalne w kontekście urbanistycznym. Mniejsze wartości
        wskazują na nieruchomości w centrum miasta, co również ma sens.
6.  `school_distance`
    -   **Uzasadnienie**: Krótsze odległości są typowe dla osiedli
        mieszkaniowych, gdzie szkoły są blisko mieszkańców. Większe
        odległości mogą dotyczyć obszarów wiejskich lub mniej
        zurbanizowanych.
7.  `clinic_distance`
    -   **Uzasadnienie**: Podobnie jak w przypadku szkół, krótsze
        odległości charakteryzują gęsto zabudowane obszary, a większe --
        mniej rozwinięte okolice. Rozkład zmiennej jest zgodny z
        rzeczywistością.
8.  `post_office_distance`
    -   **Uzasadnienie**: Odległości te odzwierciedlają rzeczywisty
        dostęp do infrastruktury. Krótsze odległości oznaczają bardziej
        zurbanizowane tereny, a dłuższe -- obszary mniej zaludnione.
9.  `kindergarten_distance`
    -   **Uzasadnienie**: Podobnie jak w przypadku szkół, odległości
        mają naturalne wyjaśnienie w charakterystyce lokalizacji.
10. `restaurant_distance`
    -   **Uzasadnienie**: Krótsze odległości są typowe dla centrów
        miast, a większe -- dla terenów podmiejskich i wiejskich.
        Zmienna w swojej formie jest wystarczająco zrozumiała.
11. `college_distance`
    -   **Uzasadnienie**: Podobnie jak inne odległości, wartości tej
        zmiennej mają naturalne uzasadnienie w zależności od lokalizacji
        nieruchomości względem centrów edukacyjnych.
12. `pharmacy_distance`
    -   **Uzasadnienie**: Odległości te są intuicyjne i w pełni
        odpowiadają rzeczywistości. Apteki są zlokalizowane bliżej
        mieszkańców w gęsto zaludnionych obszarach, co tłumaczy krótsze
        wartości.
13. `building_age`
    -   **Uzasadnienie**: Starsze budynki (np. \>50 lat) są często
        kamienicami lub historycznymi budynkami, a nowe (np. \<10 lat)
        to inwestycje deweloperskie. Wiek budynku jest intuicyjny i
        łatwy do zrozumienia bez transformacji.

**Podsumowanie**: Brak transformacji dla większości zmiennych wynika z
ich naturalnego znaczenia w kontekście rynku nieruchomości.
Transformacje stosujemy wyłącznie w sytuacjach, gdy poprawiają one
analizę, bez utraty interpretowalności. W przypadku tych zmiennych,
zachowanie ich w pierwotnej formie pozwala na lepsze oddanie
rzeczywistości i kontekstu analizy.

# **Ponowna walidacja danych**



Po przeprowadzeniu **pierwszej, wstępnej walidacji**, która ujawniła
**znaczną liczbę brakujących danych (NA)** w zbiorze, zdecydowano się na
przeprowadzenie **kolejnej, bardziej szczegółowej analizy**, aby upewnić
się, że dokonana **imputacja** została prawidłowo wykonana, a dane są
spójne i gotowe do dalszej obróbki. **Celem ponownej walidacji** jest
weryfikacja skuteczności uzupełniania brakujących wartości oraz
sprawdzenie, czy po tej operacji dane są spójne z przyjętymi regułami.





W ramach tej walidacji sprawdzono czy wartości imputowane dla zmiennych
numerycznych i kategorycznych **(mediana i moda)** zostały odpowiednio
dobrane, a także czy nie wprowadziły nowych niezgodności w danych.
Ponadto zweryfikowano, czy po przeprowadzonej imputacji i innych
korektach, dane są logicznie spójne, a reguły dotyczące relacji między
zmiennymi, takie jak zgodność zmiennych `floor` i `floor_count`, zostały
właściwie zastosowane.





**Druga walidacja** ma na celu zapewnienie, że dane są w pełni spójne i
zgodne z wymaganiami, eliminując ryzyko wystąpienia problemów, które
mogłyby wpływać na jakość dalszej analizy. Dzięki tym czynnościom dane
będą gotowe do kolejnych etapów analizy i przetwarzania.



```{r walidacja_kontrolna_danych, echo=FALSE}

# Walidacja wcześniej zdefiniowanych reguł 

rules2 <- validator(
  "Floor > Floor Count" = floor <= floor_count,                                              # Piętro nie większe niż liczba kondygnacji
  "Build Year <= 2024" = build_year <= 2024,                                                 # Rok budowy nie większy niż rok bieżący
  "Build Year > 1600" = build_year > 1600,                                                   # Rok budowy późniejszy niż 1600
  "Floor >= 0" = floor >= 0,                                                                 # Piętro nie może być ujemne
  "Floor Count >= 0" = floor_count >= 0,                                                     # Liczba kondygnacji nie może być ujemna
  "Rooms > 0" = rooms > 0,                                                                   # Liczba pokoi większa niż 0
  "Rooms <= 15" = rooms <= 15,                                                               # Liczba pokoi nie większa niż 15
  "Elevator in a building with 0 floors" = !(floor_count == 0 & has_elevator == "yes")       # Sprawdzenie, czy budynek z 0 kondygnacjami ma windę
)

out2 <- confront(dane, rules)
addwwfw <- as.data.frame(summary(out2))
addwwfw$expression <- c("Floor > Floor Count", "Build Year <= 2024","Build Year > 1600","Floor >= 0", "Floor Count >= 0", "Rooms > 0", "Rooms <= 15", "Elevator in a building with 0 floors")


ggplot(addwwfw, aes(x = expression, y = fails, fill = fails > 0)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  ggtitle("Wyniki walidacji danych") +
  xlab("Reguły walidacji") +
  ylab("Liczba naruszeń") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  ) +
  scale_fill_manual(values = c("lightgreen", "tomato"))

```



W procesie walidacji danych większość reguł została spełniona, jednak w
przypadku jednej reguły, dotyczącej zgodności zmiennych `floor` i
`floor_count`, wykryto **545 nieprawidłowych obserwacji**, które
wymagają dalszej analizy i korekty. Zgodnie z regułą, wartości `floor`
nie powinny przekraczać wartości `floor_count`, co jest kluczowe dla
spójności danych. Pozostałe reguły zostały prawidłowo zastosowane i
**nie wykryto żadnych innych istotnych problemów** w analizowanych
danych.





Przed rozpoczęciem walidacji **brakujące wartości (NA)** zostały
uzupełnione, co pozwoliło na przeprowadzenie pełnej analizy zgodności z
regułami. **Imputacja brakujących danych** była kluczowym krokiem,
umożliwiającym dalsze etapy weryfikacji danych.





Błędy w danych `floor` i `floor_count` mogą wynikać z błędnie
uzupełnionych wartości lub **nieaktualnych danych** (budynki mogły
zmienić liczbę kondygnacji po modernizacji). Aby poprawić te błędy,
przyjęto zasadę, że w takich sytuacjach wartość liczby kondygnacji
(`floor_count`) zostanie ustawiona na wartość piętra (`floor`). Jeśli
wartość liczby kondygnacji była równa lub większa od wartości piętra,
dane pozostały niezmienione. Taka korekta zapewnia **spójność danych** i
eliminuje przypadki, w których piętro przewyższa liczbę kondygnacji w
budynku.**Nie znaleziono duplikatów wierszy w danych**.



```{r walidacja_i_korekta_wartości;floor_floor_count,flitracja_duplikatów, echo=FALSE}

# Błędne obserwacje - filtracja 
invalid_observations <- dane %>% filter(floor > floor_count)

# Korekta błędnych wartości
dane <- dane %>% mutate(floor_count = ifelse(floor_count < floor, floor, floor_count))

# Sprawdzanie duplikatów
duplicates <- dane[duplicated(dane), ]

```

# **Analiza średnich cen mieszkań według województw**

```{r dodanie_nowych_danych, echo=FALSE, message=FALSE, warning=FALSE}
# Wczytanie granic administracyjnych województw
gml_file <- "ms_A01_Granice_wojewodztw.gml"

# Ukrycie komunikatów st_read
invisible(capture.output({
  voivodeship <- st_read(gml_file)
}))

# Tworzenie punktów z danych (longitude i latitude)
punkty <- st_as_sf(dane, coords = c("longitude", "latitude"), crs = 4326)

# Dopasowanie układu współrzędnych punktów do układu pliku GML
punkty <- st_transform(punkty, st_crs(voivodeship))

# Dopasowanie punktów do granic województw
dane_with_region <- st_join(punkty, voivodeship)

# Dodanie kolumny 'voivodeship' na podstawie JPT_NAZWA_
dane$voivodeship <- dane_with_region$JPT_NAZWA_

# Obliczenie średniej ceny za metr kwadratowy na województwo
srednie_ceny_m2 <- dane %>%
  group_by(voivodeship) %>%
  summarise(srednia_cena_m2 = mean(price_per_square_meter, na.rm = TRUE))

# Połączenie danych o cenach z granicami województw
voivodeship <- voivodeship %>%
  left_join(srednie_ceny_m2, by = c("JPT_NAZWA_" = "voivodeship"))

# Obliczenie centroidów województw dla etykiet
voivodeship_centroids <- suppressWarnings({
  voivodeship %>%
    st_centroid() %>%
    mutate(label = JPT_NAZWA_)
})
```



Celem analizy regionalnej cen mieszkań jest zrozumienie zróżnicowania
poziomu cen nieruchomości w Polsce. Wykorzystanie mapy województw
pozwala zobrazować różnice w średnich cenach za metr kwadratowy w
poszczególnych regionach kraju. Tego rodzaju wizualizacja umożliwia
identyfikację obszarów o najwyższych oraz najniższych cenach, co może
stanowić punkt wyjścia do dalszej analizy rynku nieruchomości,
uwzględniającej czynniki wpływające na cenę, takie jak urbanizacja,
poziom dochodów czy lokalna infrastruktura.



```{r wykres_choropleth srednia cena mieszk na wojew, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = voivodeship) +
  geom_sf(aes(fill = srednia_cena_m2), color = "black", size = 0.2) +
  scale_fill_gradientn(
    name = "Śr. cena za m² (PLN)", 
    colors = c("lightyellow", "orchid3"), # Gradacja z lightyellow do orchid3
    na.value = "gray",
    labels = label_number(big.mark = " ", decimal.mark = ",")
  ) +
  geom_sf_text(data = voivodeship_centroids, aes(label = label), size = 3, color = "black") +
  theme_minimal() +
  labs(title = "Średnia cena za m² w Polsce według województw",
       caption = "Źródło: https://www.geoportal.gov.pl/") +
  theme(
    legend.position = "right",
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    panel.grid = element_blank(),
    plot.title = element_text(
      hjust = 0.5,
      size = rel(1.2)
    )
  )
```

```{r, results='asis', eval=TRUE, echo=FALSE, comment=FALSE, warning=FALSE}

get_mode <- function(v) {
  uniqv <- unique(v)
  uniqv[which.max(tabulate(match(v, uniqv)))]
}

statystyki <- dane %>%
  group_by(Miasto = city) %>%
  summarise(
    "Średnia powierzchnia mieszkania" = round(mean(square_meters, na.rm = TRUE), 2),
    "Średnia cena za $m^2$" = round(mean(price_per_square_meter, na.rm = TRUE), 2),
    "Najczęstsza liczba pokoi" = get_mode(rooms)
  ) %>%
  arrange(desc(`Średnia cena za $m^2$`)) 

knitr::kable(statystyki, caption = "Poszczególne statystyki dla miast")
```

#### **Interpretacja wyników**

1.  **Województwo mazowieckie jako lider cenowy**

    

    Z wykresu wynika, że województwo mazowieckie, w szczególności
    Warszawa, dominuje pod względem średnich cen za metr kwadratowy,
    osiągając wartości powyżej **18 000 PLN/m²**. Jest to
    odzwierciedleniem centralnej roli stolicy w gospodarce, jej
    rozwiniętego rynku pracy oraz wysokiego popytu na mieszkania.

    

2.  **Regiony o najniższych cenach**

    

    Województwa takie jak podkarpackie, lubelskie i podlaskie
    charakteryzują się znacznie niższymi cenami, oscylującymi wokół **10
    000 PLN/m²**. Są to regiony o mniejszym stopniu urbanizacji oraz
    niższym popycie na nieruchomości w porównaniu do dużych miast.

    

3.  **Regiony o średnich cenach**

    

    Województwa dolnośląskie, pomorskie i wielkopolskie znajdują się w
    średnim przedziale cenowym, wynoszącym od **12 000 PLN/m² do 16 000
    PLN/m²**. Obejmują one dynamicznie rozwijające się miasta, takie jak
    Wrocław, Gdańsk czy Poznań, które są istotnymi ośrodkami
    akademickimi i biznesowymi.

    

4.  **Różnice między regionami**

    

    Mapa podkreśla wyraźne różnice w rozwoju regionalnym. Województwa
    takie jak opolskie czy świętokrzyskie należą do najtańszych, co może
    być związane z niższym stopniem urbanizacji, mniejszym popytem oraz
    ograniczoną dostępnością pracy w tych regionach.

    

#### **Wnioski**



Wykres średnich cen mieszkań za metr kwadratowy w podziale na
województwa jasno pokazuje istotne różnice regionalne. Najwyższe ceny
dominują w centralnej i północno-zachodniej części Polski, szczególnie w
miastach takich jak Warszawa, Wrocław, Gdańsk i Kraków. Natomiast
regiony wschodnie oraz mniej zurbanizowane województwa charakteryzują
się niższymi cenami, co wskazuje na ich mniejszy potencjał rynkowy.
Wyniki te sugerują, że dalsze badania powinny uwzględnić czynniki
demograficzne, ekonomiczne i infrastrukturalne, które kształtują rynek
nieruchomości w Polsce.



### Wybór miast do dalszej analizy

W ramach dalszej analizy postanowiliśmy skupić się na szczegółowym
porównaniu miast w naszym zbiorze danych pod kątem cen mieszkań za metr
kwadratowy. W tym celu wybraliśmy po dwa miasta z trzech grup cenowych:

1.  **Miasta z najwyższymi cenami za** $m^2$ -- są to lokalizacje
    charakteryzujące się wyjątkowo wysokim poziomem cen, które mogą być
    związane z prestiżem, dostępem do wyjątkowych udogodnień, czy
    lokalizacją w centralnych dzielnicach dużych miast. Analiza tych
    miast jakimi są Warszawa oraz Kraków pozwoli zrozumieć, jakie
    czynniki najbardziej wpływają na tak wysokie ceny.

2.  **Miasta o średnich cenach za** $m^2$ -- wybraliśmy dwa miasta
    znajdujące się w średniej półce cenowej tj Rzeszów i Białystok.
    Analiza tej grupy pozwoli na identyfikację, jak różnią się te
    lokalizacje od najdroższych i najtańszych pod względem dostępności
    mieszkań, udogodnień oraz charakterystyki demograficznej.

3.  **Miasta z najniższymi cenami za** $m^2$ -- dwa miasta o najniższych
    cenach za metr kwadratowy (Radom, Częstochowa) zostały wybrane w
    celu zbadania, czy niższe ceny wynikają z lokalizacji, ograniczonej
    liczby udogodnień, czy może innych czynników, takich jak mniejsze
    zainteresowanie rynkiem nieruchomości.

#### Uzasadnienie wyboru

Decyzja o podziale miast na trzy grupy wynika z chęci uchwycenia
zróżnicowania na polskim rynku nieruchomości. Taki podział pozwala:

-   **Lepiej zrozumieć czynniki wpływające na ceny mieszkań** w skrajnie
    różnych lokalizacjach.
-   **Zidentyfikować potencjalne różnice w charakterystyce mieszkań**
    (np. powierzchnia, liczba pokoi, stan techniczny) pomiędzy miastami.
-   **Opracować bardziej uniwersalne wnioski**, które mogą być przydatne
    zarówno dla inwestorów, jak i osób zainteresowanych zakupem
    mieszkań.

Dzięki temu podziałowi możemy porównać, jakie cechy i trendy są unikalne
dla różnych segmentów cenowych, oraz czy istnieją wspólne wzorce, które
łączą te grupy.



# **Analiza udogodnień w nieruchomościach**

Wykonamy analizę, aby sprawdzić, w jaki sposób różne udogodnienia, takie jak balkon, winda, parking, ochrona czy komórka lokatorska, wpływają na ceny mieszkań w wybranych miastach. Za pomocą wykresów pudełkowych ocenimy, czy obecność tych udogodnień ma znaczący wpływ na wartość nieruchomości oraz jak różnice te kształtują się w zależności od lokalizacji.

## Wykresy pudełkowe udogodnień

```{r zaleznosciboxplot1, echo=FALSE, fig.height=8,fig.width=12}
wybrane_miasta <- c("Warszawa", "Kraków", "Częstochowa", "Radom", "Białystok", "Rzeszów")
dane_filtr <- dane %>% filter(city %in% wybrane_miasta)

p1 <- ggplot(dane_filtr, aes(x = has_balcony, y = price)) +
  geom_boxplot(aes(fill = city)) +
  labs(title = "Balkon",
       x = "Czy mieszkanie ma balkon?",
       y = "Cena (PLN)") +
  theme_minimal() +
  facet_wrap(~city) +
  theme(
    text = element_text(size = 12),
    title = element_text(size = 14, face = "bold"),   # Czcionka tytułu
    axis.title = element_text(size = 12, face = "bold"), # Czcionka tytułów osi
    axis.text = element_text(size = 10),legend.position = "none"  # Czcionka etykiet osi
  )

p2 <- ggplot(dane_filtr, aes(x = has_elevator, y = price)) +
  geom_boxplot(aes(fill = city)) +
  labs(title = "Winda",
       x = "Czy mieszkanie ma windę?",
       y = "Cena (PLN)") +
  theme_minimal() +
  facet_wrap(~city) +
  theme(
    text = element_text(size = 12), 
    title = element_text(size = 14, face = "bold"),   # Czcionka tytułu
    axis.title = element_text(size = 12, face = "bold"), # Czcionka tytułów osi
    axis.text = element_text(size = 10), legend.position = "none"  # Czcionka etykiet osi
  )
grid.arrange(p1, p2, nrow = 1)
```

```{r zaleznoscibozplot2, echo=FALSE, fig.height=15,fig.width=15}
p3 <- ggplot(dane_filtr, aes(x = has_parking, y = price)) +
  geom_boxplot(aes(fill = city)) +
  labs(title = "Parking",
       x = "Czy mieszkanie ma parking?",
       y = "Cena (PLN)") +
  theme_minimal() +
  facet_wrap(~city) +
  theme(
    text = element_text(size = 12), 
    title = element_text(size = 14, face = "bold"),   # Czcionka tytułu
    axis.title = element_text(size = 12, face = "bold"), # Czcionka tytułów osi
    axis.text = element_text(size = 10), legend.position = "none"  # Czcionka etykiet osi
  )

p4 <- ggplot(dane_filtr, aes(x = has_security, y = price)) +
  geom_boxplot(aes(fill = city)) +
  labs(title = "Ochrona",
       x = "Czy mieszkanie ma ochronę?",
       y = "Cena (PLN)") +
  theme_minimal() +
  facet_wrap(~city) +
  theme(
    text = element_text(size = 12), 
    title = element_text(size = 14, face = "bold"),   # Czcionka tytułu
    axis.title = element_text(size = 12, face = "bold"), # Czcionka tytułów osi
    axis.text = element_text(size = 10),legend.position = "none"  # Czcionka etykiet osi
  )

p5 <- ggplot(dane_filtr, aes(x = has_storage_room, y = price)) +
  geom_boxplot(aes(fill = city)) +
  labs(title = "Komórka lokatorska",
       x = "Czy mieszkanie ma komórkę lokatorską?",
       y = "Cena (PLN)") +
  theme_minimal() +
  facet_wrap(~city) +
  theme(
    text = element_text(size = 12),  
    title = element_text(size = 14, face = "bold"),   # Czcionka tytułu
    axis.title = element_text(size = 12, face = "bold"), # Czcionka tytułów osi
    axis.text = element_text(size = 10),legend.position = "none"  # Czcionka etykiet osi
  )

grid.arrange(p3, p4, p5, nrow = 2)
```

#### Wpływ balkonu na cenę mieszkań

Balkon jest jednym z kluczowych elementów wpływających na wartość
mieszkania, zwłaszcza w dużych miastach.

-   W **Warszawie** i **Krakowie**, mieszkania z balkonem mają wyraźnie
    wyższe mediany cen w porównaniu do mieszkań bez tego udogodnienia.
    Może to wynikać z zapotrzebowania na przestrzeń zewnętrzną w dużych
    aglomeracjach, gdzie dostęp do terenów zielonych bywa ograniczony.
-   W miastach takich jak **Radom**, **Rzeszów** i **Częstochowa**,
    różnice w medianach cen są mniej wyraźne, co wskazuje, że balkon w
    tych lokalizacjach jest czynnikiem mniej istotnym.
-   Warto zauważyć, że rozrzut cen w grupie mieszkań z balkonem jest
    mniejszy, co może świadczyć o większej standaryzacji tej grupy
    mieszkań pod względem ceny.

#### Wpływ windy na cenę mieszkań

Obecność windy ma istotne znaczenie dla wartości mieszkań, szczególnie w
nowoczesnych budynkach i wyższych kondygnacjach.

-   **Warszawa**, **Kraków** i **Rzeszów** charakteryzują się znaczącą
    różnicą w medianach cen mieszkań z i bez windy, co wskazuje na
    preferencje kupujących związane z wygodą użytkowania. Winda może być
    szczególnie istotna w budynkach wielopiętrowych.
-   W mniejszych miastach, takich jak **Radom** i **Częstochowa**,
    różnice w medianach są mniej zauważalne, co może sugerować, że winda
    nie jest tam równie cenionym udogodnieniem.
-   Rozrzut cen mieszkań bez windy jest większy, co może świadczyć o
    różnorodności oferty mieszkań w tej grupie.

#### Wpływ parkingu na cenę mieszkań

Analiza wskazuje, że obecność parkingu jest istotnym czynnikiem
wpływającym na medianę cen mieszkań, szczególnie w większych
aglomeracjach.

-   **Warszawa** wykazuje najwyższą medianę cen dla mieszkań z
    parkingiem, co może sugerować, że dostępność parkingu w stolicy jest
    szczególnie pożądana przez nabywców.
-   W miastach takich jak **Kraków** i **Rzeszów**, różnica między
    cenami mieszkań z parkingiem i bez jest również wyraźna, choć nie
    tak wysoka jak w Warszawie. Może to wynikać z urbanistycznych
    potrzeb mieszkańców.
-   **Częstochowa** i **Radom** charakteryzują się stosunkowo niewielką
    różnicą w medianach cen, co wskazuje na mniejsze znaczenie parkingu
    jako czynnika wpływającego na decyzje zakupowe.
-   Rozrzut cen (odchylenie) w grupie mieszkań bez parkingu jest
    większy, co może wskazywać na większą różnorodność mieszkań w tej
    grupie pod względem lokalizacji, standardu i powierzchni.

#### Wpływ ochrony na cenę mieszkań

Obecność ochrony na terenie nieruchomości jest silnym czynnikiem
zwiększającym wartość mieszkań w dużych i dynamicznie rozwijających się
miastach.

-   W takich lokalizacjach jak **Warszawa** i **Kraków**, mieszkania z
    ochroną osiągają zauważalnie wyższe ceny, co świadczy o znaczeniu
    bezpieczeństwa w decyzjach zakupowych.
-   **Radom** i **Częstochowa** wykazują niewielkie różnice w medianach
    cen mieszkań z i bez ochrony, co sugeruje, że w mniejszych miastach
    czynniki takie jak lokalizacja i stan techniczny nieruchomości mogą
    być ważniejsze niż bezpieczeństwo.
-   Analiza rozrzutu cen pokazuje, że mieszkania z ochroną
    charakteryzują się mniejszym odchyleniem standardowym, co oznacza
    większą stabilność cenową w tej grupie.

#### Wpływ komórki lokatorskiej na cenę mieszkań

Komórka lokatorska stanowi ważny element funkcjonalności nieruchomości,
szczególnie w bardziej zatłoczonych miastach, gdzie przestrzeń dodatkowa
ma istotne znaczenie.

-   **Warszawa**, **Kraków** i **Rzeszów** wykazują wyraźne różnice w
    medianach cen mieszkań z i bez komórki lokatorskiej. W tych miastach
    komórka lokatorska może być postrzegana jako istotne udogodnienie,
    które podnosi wartość użytkową mieszkania.
-   W miastach takich jak **Radom** i **Częstochowa**, różnice w
    medianach są mniej wyraźne, co sugeruje, że lokalne preferencje
    zakupowe mogą nie uwzględniać tego udogodnienia jako kluczowego.
-   Rozrzut cen mieszkań bez komórki lokatorskiej jest większy, co może
    sugerować większą różnorodność w tej grupie pod względem lokalizacji
    i standardu nieruchomości.

#### Podsumowanie

1.**Balkon:** Istotny czynnik w Warszawie i Krakowie, gdzie dostęp do
przestrzeni zewnętrznej jest ograniczony.<br> 2.**Winda:** Znaczący
wpływ na wartość mieszkań, szczególnie w dużych miastach z nowoczesną
zabudową.<br> 3.**Parking:** Kluczowy czynnik w dużych miastach,
zwłaszcza w Warszawie, gdzie dostępność miejsc parkingowych jest
ograniczona.<br> 4.**Ochrona:** Wysoko cenione w dużych aglomeracjach,
szczególnie tam, gdzie bezpieczeństwo jest priorytetem.<br> 5.**Komórka
lokatorska:** Ważna w miastach o wysokim zagęszczeniu, gdzie przestrzeń
przechowywania ma istotne znaczenie.<br>

## Test Chi-kwadrat

### Wstęp do analizy testem Chi-kwadrat

W ramach analizy projektu zdecydowaliśmy się zbadać zależności pomiędzy
zmiennymi kategorycznymi opisującymi cechy mieszkań. W tym celu
zastosowaliśmy **test Chi-kwadrat**, który jest jedną z
najpopularniejszych metod analizy zależności pomiędzy dwiema zmiennymi
jakościowymi (kategorycznymi).

#### Opis metody

Test Chi-kwadrat służy do sprawdzania, czy istnieje statystycznie
istotna zależność pomiędzy dwiema zmiennymi kategorycznymi. Wykorzystuje
tablicę kontyngencji (czyli tabelę krzyżową) do porównania rzeczywistych
obserwacji w danych z wartościami oczekiwanymi, które wystąpiłyby w
przypadku braku zależności.

Test ten opiera się na statystyce Chi-kwadrat: $$
\chi^2 = \sum \frac{(O_i - E_i)^2}{E_i}
$$ gdzie: - $O_i$ to zaobserwowane wartości, - $E_i$ to oczekiwane
wartości przy założeniu niezależności.

#### Hipotezy testu

-   **Hipoteza zerowa (**$H_0$): Nie ma zależności między badanymi
    zmiennymi.
-   **Hipoteza alternatywna (**$H_1$): Istnieje zależność między
    badanymi zmiennymi.

#### Założenia testu

1.  Dane są w postaci nominalnej (kategorycznej).
2.  Wartości oczekiwane w każdej komórce tabeli kontyngencji powinny
    wynosić co najmniej 5 (dla mniejszych próbek można użyć dokładnego
    testu Fishera).

### Analiza zależności dla wielu zmiennych kategorycznych

```{r chi-square-multiple-tests, echo=FALSE, message=FALSE, results='hide'}

# Chi tabele
chi_tabela1 <- table(dane_filtr$has_parking, dane_filtr$has_balcony)
chisq.test(chi_tabela1)

chi_tabela2 <- table(dane_filtr$has_parking, dane_filtr$has_elevator)
chisq.test(chi_tabela2)

chi_tabela3 <- table(dane_filtr$has_parking, dane_filtr$has_security)
chisq.test(chi_tabela3)

chi_tabela4 <- table(dane_filtr$has_parking, dane_filtr$has_storage_room)
chisq.test(chi_tabela4)

chi_tabela5 <- table(dane_filtr$has_balcony, dane_filtr$has_elevator)
chisq.test(chi_tabela5)

chi_tabela6 <- table(dane_filtr$has_balcony, dane_filtr$has_security)
chisq.test(chi_tabela6)

chi_tabela7 <- table(dane_filtr$has_balcony, dane_filtr$has_storage_room)
chisq.test(chi_tabela7)

chi_tabela8 <- table(dane_filtr$has_elevator, dane_filtr$has_security)
chisq.test(chi_tabela8)

chi_tabela9 <- table(dane_filtr$has_elevator, dane_filtr$has_storage_room)
chisq.test(chi_tabela9)

chi_tabela10 <- table(dane_filtr$has_security, dane_filtr$has_storage_room)
chisq.test(chi_tabela10)
```

```{r chi results, echo=FALSE}

chi_results <- data.frame(
  Zmienne = c(
    "has_parking vs has_balcony",
    "has_parking vs has_elevator",
    "has_parking vs has_security",
    "has_parking vs has_storage_room",
    "has_balcony vs has_elevator",
    "has_balcony vs has_security",
    "has_balcony vs has_storage_room",
    "has_elevator vs has_security",
    "has_elevator vs has_storage_room",
    "has_security vs has_storage_room"
  ),
  p_value = formatC(c(
    chisq.test(chi_tabela1)$p.value,
    chisq.test(chi_tabela2)$p.value,
    chisq.test(chi_tabela3)$p.value,
    chisq.test(chi_tabela4)$p.value,
    chisq.test(chi_tabela5)$p.value,
    chisq.test(chi_tabela6)$p.value,
    chisq.test(chi_tabela7)$p.value,
    chisq.test(chi_tabela8)$p.value,
    chisq.test(chi_tabela9)$p.value,
    chisq.test(chi_tabela10)$p.value
  ), format = "e", digits = 3)
)

kable(chi_results, format = "markdown", caption = "Wyniki testów Chi-kwadrat")
```

### Interpretacja wyników analizy Chi-kwadrat

W analizie zbadano zależności pomiędzy wybranymi zmiennymi
kategorycznymi opisującymi cechy mieszkań: `has_balcony`, `has_parking`,
`has_elevator`, `has_security`, `has_storage_room`. Wyniki testów
Chi-kwadrat zostały przedstawione poniżej.

#### Wyniki analizy:

`has_parking` vs `has_balcony`

Tablica kontyngencji pokazuje, że mieszkania z parkingiem są silnie
skorelowane z posiadaniem balkonu.

**Statystyka Chi-kwadrat**: 116.27\
**Wartość p**: $4.15 \times 10^{-27}$ (bardzo niskie)

**Wnioski**: Istnieje silna zależność między posiadaniem parkingu a
balkonu.

`has_parking` vs `has_elevator`

Tablica kontyngencji sugeruje, że mieszkania z parkingiem są silnie
skorelowane z posiadaniem windy.

**Statystyka Chi-kwadrat**: 221.61\
**Wartość p**: $4.03 \times 10^{-50}$ (bardzo niskie)

**Wnioski**: Istnieje bardzo silna zależność między posiadaniem parkingu
a windy.

`has_parking` vs `has_security`

Tablica kontyngencji wskazuje, że mieszkania z parkingiem są
umiarkowanie skorelowane z posiadaniem ochrony.

**Statystyka Chi-kwadrat**: 49.00\
**Wartość p**: $2.56 \times 10^{-12}$ (bardzo niskie)

**Wnioski**: Istnieje umiarkowana zależność między posiadaniem parkingu
a ochrony.

`has_parking` vs `has_storage_room`

Tablica kontyngencji pokazuje silną korelację między posiadaniem
parkingu a pomieszczenia gospodarczego.

**Statystyka Chi-kwadrat**: 135.25\
**Wartość p**: $2.91 \times 10^{-31}$ (bardzo niskie)

**Wnioski**: Istnieje silna zależność między posiadaniem parkingu a
pomieszczeniem gospodarczym.

`has_balcony` vs `has_elevator`

Tablica kontyngencji nie wskazuje istotnej korelacji między posiadaniem
balkonu a windy.

**Statystyka Chi-kwadrat**: 2.29\
**Wartość p**: $1.31 \times 10^{-1}$ (brak istotności)

**Wnioski**: Nie ma istotnej zależności między posiadaniem balkonu a
windy.

`has_balcony` vs `has_security`

Tablica kontyngencji pokazuje, że mieszkania z balkonem są umiarkowanie
skorelowane z posiadaniem ochrony.

**Statystyka Chi-kwadrat**: 24.02\
**Wartość p**: $9.52 \times 10^{-7}$ (bardzo niskie)

**Wnioski**: Istnieje umiarkowana zależność między posiadaniem balkonu a
ochrony.

`has_balcony` vs `has_storage_room`

Tablica kontyngencji wskazuje silną korelację między posiadaniem balkonu
a pomieszczenia gospodarczego.

**Statystyka Chi-kwadrat**: 120.41\
**Wartość p**: $5.16 \times 10^{-28}$ (bardzo niskie)

**Wnioski**: Istnieje silna zależność między posiadaniem balkonu a
pomieszczeniem gospodarczym.

`has_elevator` vs `has_security`

Tablica kontyngencji pokazuje silną korelację między posiadaniem windy a
ochrony.

**Statystyka Chi-kwadrat**: 171.13\
**Wartość p**: $4.19 \times 10^{-39}$ (bardzo niskie)

**Wnioski**: Istnieje bardzo silna zależność między posiadaniem windy a
ochrony.

`has_elevator` vs `has_storage_room`

Tablica kontyngencji wskazuje wyjątkowo silną korelację między
posiadaniem windy a pomieszczenia gospodarczego.

**Statystyka Chi-kwadrat**: 837.82\
**Wartość p**: $3.23 \times 10^{-184}$ (bardzo niskie)

**Wnioski**: Istnieje wyjątkowo silna zależność między posiadaniem windy
a pomieszczeniem gospodarczym.

`has_security` vs `has_storage_room`

Tablica kontyngencji pokazuje bardzo silną korelację między posiadaniem
ochrony a pomieszczenia gospodarczego.

**Statystyka Chi-kwadrat**: 167.67\
**Wartość p**: $2.39 \times 10^{-38}$ (bardzo niskie)

**Wnioski**: Istnieje bardzo silna zależność między posiadaniem ochrony
a pomieszczeniem gospodarczym.

#### Ogólne wnioski:

Na podstawie przeprowadzonych testów Chi-kwadrat możemy sformułować
następujące wnioski:

1.  **Silne powiązania**:
    -   Najsilniejsze zależności występują między zmiennymi związanymi z
        **windą** i **pomieszczeniem gospodarczym**. To sugeruje, że
        obecność windy jest ściśle związana z dostępem do pomieszczenia
        gospodarczego, co może wynikać z układu budynków lub preferencji
        klientów.
    -   Również zmienne **parking** i **pomieszczenie gospodarcze** oraz
        **parking** i **winda** wykazują silną zależność.
2.  **Umiarkowane zależności**:
    -   Istnieje umiarkowana zależność między zmiennymi związanymi z
        **balkonem** i **ochroną**, co może wskazywać na określone
        standardy bezpieczeństwa w mieszkaniach z balkonem.
3.  **Brak istotnych zależności**:
    -   Nie stwierdzono istotnej zależności między posiadaniem
        **balkonu** a **windą**, co oznacza, że te cechy nie są
        powiązane w badanej próbie.
4.  **Wpływ niskich wartości p**:
    -   Bardzo niskie wartości p dla większości porównań sugerują, że
        wykryte zależności nie są przypadkowe i wynikają z faktycznych
        powiązań między cechami mieszkań.

**Podsumowanie**: W analizie ujawniono liczne istotne korelacje między
cechami mieszkań. Najsilniejsze zależności dotyczą cech związanych z
infrastrukturą budynku (winda, pomieszczenie gospodarcze) oraz
dostępnością (parking). Wyniki te mogą być wykorzystane do przewidywania
preferencji klientów lub optymalizacji oferty deweloperów.

## Testowanie normalności i jednorodności wariancji

Postanowiliśmy zbadać, czy wariancje wyników w różnych grupach
badawczych są jednorodne. Jednorodność wariancji, czyli
homoskedastyczność, jest kluczowym założeniem w wielu testach
statystycznych, takich jak analiza wariancji (ANOVA) czy test
t-Studenta. Jeśli wariancje nie są równe, wyniki tych analiz mogą być
niewiarygodne, co może prowadzić do błędnych wniosków.

Aby zweryfikować jednorodność wariancji w badanych grupach, zastosujemy
**test Levene'a**. Jest to popularna i odporna metoda, która pozwala
porównać wariancje w dwóch lub więcej grupach, nawet gdy dane nie
spełniają założeń normalności rozkładu. Test ten będzie kluczowym
krokiem w naszej analizie statystycznej, ponieważ od jego wyniku zależy,
czy możemy zastosować klasyczne metody parametryczne, czy też konieczne
będzie użycie metod alternatywnych.

W dalszej części przedstawimy sposób przeprowadzenia testu Levene'a oraz
omówimy uzyskane wyniki.

### Test Levene'a

Test Levene'a jest statystycznym testem służącym do sprawdzenia
jednorodności wariancji (homoskedastyczności) w dwóch lub więcej
grupach. Jest szczególnie użyteczny w analizach, które wymagają równości
wariancji jako jednego z założeń, np. analiza wariancji (ANOVA) czy test
t-Studenta.

#### Hipotezy testu:

-   **Hipoteza zerowa (H₀)**: Wariancje w każdej grupie są równe.
-   **Hipoteza alternatywna (H₁)**: Istnieją różnice w wariancjach
    pomiędzy grupami.

#### Mechanizm działania:

Test Levene'a porównuje odchylenia wartości w każdej grupie od mediany
lub średniej. W wersji klasycznej test bazuje na średniej, natomiast
modyfikacja Browna-Forsythe'a stosuje medianę, co czyni test bardziej
odpornym na wartości odstające.

```{r Levene Test, echo=FALSE, warning=FALSE}

dane$has_parking <- as.factor(dane$has_parking)
dane$has_balcony <- as.factor(dane$has_balcony)
dane$has_elevator <- as.factor(dane$has_elevator)
dane$has_security <- as.factor(dane$has_security)
dane$has_storage_room <- as.factor(dane$has_storage_room)

levene_test_has_parking <- leveneTest(price ~ has_parking, data = dane)
levene_test_has_balcony <- leveneTest(price ~ has_balcony, data = dane)
levene_test_has_elevator <- leveneTest(price ~ has_elevator, data = dane)
levene_test_has_security <- leveneTest(price ~ has_security, data = dane)
levene_test_has_storage_room <- leveneTest(price ~ has_storage_room, data = dane)

```

```{r Levene Table, echo=FALSE, warning=FALSE}

levene_results <- data.frame(
  Zmienna = c("has_parking", "has_balcony", "has_elevator", "has_security", "has_storage_room"),
  F_Statistic = c(
    levene_test_has_parking[1, "F value"],
    levene_test_has_balcony[1, "F value"],
    levene_test_has_elevator[1, "F value"],
    levene_test_has_security[1, "F value"],
    levene_test_has_storage_room[1, "F value"]
  ),
  p_value = c(
    levene_test_has_parking[1, "Pr(>F)"],
    levene_test_has_balcony[1, "Pr(>F)"],
    levene_test_has_elevator[1, "Pr(>F)"],
    levene_test_has_security[1, "Pr(>F)"],
    levene_test_has_storage_room[1, "Pr(>F)"]
  )
)

levene_results <- levene_results %>%
  mutate(
    Interpretacja = ifelse(p_value < 0.05, "Wariancje różnią się istotnie", "Wariancje są jednorodne")
  )

kable(levene_results, caption = "Podsumowanie wyników testów Levene’a dla zmiennej price.")

```

### Interpretacja

-   `has_parking` (p = 0.8754) -- nie ma podstaw do odrzucenia
    hipotezy zerowej o jednorodności wariancji, dlatego **wariancje są
    jednorodne**.

-   `has_balcony` (p \< 0.0001) -- występują istotne statystycznie
    różnice w wariancjach grup,\
    czyli **wariancje różnią się istotnie**.

-   `has_elevator` (p = 0.0069) -- p \< 0.05, co również wskazuje na
    istotną różnicę wariancji,\
    a zatem **wariancje różnią się istotnie**.

-   `has_security` (p = 0.3173) -- brak podstaw do odrzucenia hipotezy
    zerowej, **wariancje są jednorodne**.

-   `has_storage_room` (p \< 0.0001) -- wariancje w poszczególnych
    grupach różnią się istotnie, czyli **wariancje różnią się
    istotnie**.

Na podstawie tych wyników widać, że jednorodność wariancji została
zachowana wyłącznie w przypadku zmiennych `has_parking` i
`has_security`, natomiast dla `has_balcony`, `has_elevator` oraz
`has_storage_room` stwierdzamy istotne różnice w wariancjach między
grupami.

#### Wprowadzenie

Na podstawie wyników testu [**Andersona-Darlinga**](#Anderson_Darling)
(brak rozkładu normalnego) i testu Levene'a (różnice w wariancjach dla
niektórych zmiennych), testy parametryczne, takie jak analiza wariancji
(ANOVA) czy test t-Studenta, nie są odpowiednie. Zamiast tego
zastosujemy test **Manna-Whitneya** (dla dwóch grup).

## Test Mann-Whitneya (Wilcoxona)

#### Cel testu Mann-Whitneya

Test Manna-Whitneya, znany również jako test U Manna-Whitneya, jest
nieparametrycznym testem statystycznym stosowanym do porównania median
dwóch niezależnych grup. Jest użyteczny, gdy dane nie spełniają założeń
testów parametrycznych, takich jak normalność rozkładu czy jednorodności
wariancji.

#### Założenia testu:

1.  Obie grupy są niezależne.
2.  Dane są mierzalne w skali porządkowej, interwałowej lub ilorazowej.
3.  Rozkłady w obu grupach mogą być różne, ale test jest najbardziej
    efektywny, gdy kształty rozkładów są podobne.

#### Hipotezy:

-   **Hipoteza zerowa (H₀)**: Rozkłady obu grup są identyczne, a ich
    mediany są równe.
-   **Hipoteza alternatywna (H₁)**: Rozkłady obu grup różnią się, co
    może wskazywać na różnicę median.

#### Wynik testu:

-   **Statystyka U**: Miara różnicy rang w obu grupach.
-   **Wartość p**: Ocenia, czy różnica między grupami jest statystycznie
    istotna. Jeśli wartość p jest mniejsza od przyjętego poziomu
    istotności (np. 0.05), odrzucamy H₀.

```{r Mann-Whitney, echo=FALSE, message=FALSE}
#Kraków
krakow <- dane[dane$city == "Kraków", ]

#MW Kraków
winda_krakow <- wilcox.test(krakow$price ~ krakow$has_elevator, alternative = "less")
parking_krakow <- wilcox.test(krakow$price ~ krakow$has_parking, alternative = "less")
balkon_krakow <- wilcox.test(krakow$price ~ krakow$has_balcony, alternative = "less")
ochrona_krakow <- wilcox.test(krakow$price ~ krakow$has_security, alternative = "less")
pom_gosp_krakow <- wilcox.test(krakow$price ~ krakow$has_storage_room, alternative = "less")

#Warszawa
warszawa <- dane[dane$city == "Warszawa", ]

#MW Warszawa
winda_warszawa <- wilcox.test(warszawa$price ~ warszawa$has_elevator, alternative = "less")
parking_warszawa <- wilcox.test(warszawa$price ~ warszawa$has_parking, alternative = "less")
balkon_warszawa <- wilcox.test(warszawa$price ~ warszawa$has_balcony, alternative = "less")
ochrona_warszawa <- wilcox.test(warszawa$price ~ warszawa$has_security, alternative = "less")
pom_gosp_warszawa <- wilcox.test(warszawa$price ~ warszawa$has_storage_room, alternative = "less")

#Radom
radom <- dane[dane$city == "Radom", ]

#MW Radom
winda_radom <- wilcox.test(radom$price ~ radom$has_elevator, alternative = "less")
parking_radom <- wilcox.test(radom$price ~ radom$has_parking, alternative = "less")
balkon_radom <- wilcox.test(radom$price ~ radom$has_balcony, alternative = "less")
ochrona_radom <- wilcox.test(radom$price ~ radom$has_security, alternative = "less")
pom_gosp_radom <- wilcox.test(radom$price ~ radom$has_storage_room, alternative = "less")

#Częstochowa
czestochowa <- dane[dane$city == "Częstochowa", ]

#MW Częstochowa
winda_czestochowa <- wilcox.test(czestochowa$price ~ czestochowa$has_elevator, alternative = "less")
parking_czestochowa <- wilcox.test(czestochowa$price ~ czestochowa$has_parking, alternative = "less")
balkon_czestochowa <- wilcox.test(czestochowa$price ~ czestochowa$has_balcony, alternative = "less")
ochrona_czestochowa <- wilcox.test(czestochowa$price ~ czestochowa$has_security, alternative = "less")
pom_gosp_czestochowa <- wilcox.test(czestochowa$price ~ czestochowa$has_storage_room, alternative = "less")

#Rzeszów
rzeszow <- dane[dane$city == "Rzeszów", ]

#MW Rzeszów
winda_rzeszow <- wilcox.test(rzeszow$price ~ rzeszow$has_elevator, alternative = "less")
parking_rzeszow <- wilcox.test(rzeszow$price ~ rzeszow$has_parking, alternative = "less")
balkon_rzeszow <- wilcox.test(rzeszow$price ~ rzeszow$has_balcony, alternative = "less")
ochrona_rzeszow <- wilcox.test(rzeszow$price ~ rzeszow$has_security, alternative = "less")
pom_gosp_rzeszow <- wilcox.test(rzeszow$price ~ rzeszow$has_storage_room, alternative = "less")

#Białystok
bialystok <- dane[dane$city == "Białystok", ]

#MW Białystok
winda_bialystok <- wilcox.test(bialystok$price ~ bialystok$has_elevator, alternative = "less")
parking_bialystok <- wilcox.test(bialystok$price ~ bialystok$has_parking, alternative = "less")
balkon_bialystok <- wilcox.test(bialystok$price ~ bialystok$has_balcony, alternative = "less")
ochrona_bialystok <- wilcox.test(bialystok$price ~ bialystok$has_security, alternative = "less")
pom_gosp_bialystok <- wilcox.test(bialystok$price ~ bialystok$has_storage_room, alternative = "less")


```

```{r MW tabela, echo=FALSE}

# Funkcja do formatowania wartości p
format_p <- function(p_value) {
  if (!is.na(p_value)) {
    formatC(p_value, format = "e", digits = 2)
  } else {
    NA
  }
}

# Tworzenie pustej tabeli wyników
summary_table <- data.frame(
  City = character(),
  Variable = character(),
  W_Statistic = numeric(),
  p_value = character(),  # Zmienione na character, aby przechowywać sformatowane p-value
  Interpretation = character()
)

# Funkcja do dodania wyników do tabeli
add_to_table <- function(city, variable, test_result) {
  if (!is.na(test_result$p.value)) {
    interpretation <- ifelse(test_result$p.value < 0.05, "Istotna różnica", "Brak istotnej różnicy")
  } else {
    interpretation <- "Błąd lub brak danych"
  }
  
  return(data.frame(
    Miasto = city,
    Zmienna = variable,
    W_Statistic = if (!is.na(test_result$statistic)) test_result$statistic else NA,
    p_value = if (!is.na(test_result$p.value)) format_p(test_result$p.value) else NA,
    Interpretacja = interpretation
  ))
}

summary_table <- rbind(
  summary_table, add_to_table("Kraków", "has_elevator", winda_krakow),
  summary_table, add_to_table("Kraków", "has_parking", parking_krakow),
  summary_table, add_to_table("Kraków", "has_balcony", balkon_krakow),
  summary_table, add_to_table("Kraków", "has_security", ochrona_krakow),
  summary_table, add_to_table("Kraków", "has_storage_room", pom_gosp_krakow),
  
  summary_table, add_to_table("Warszawa", "has_elevator", winda_warszawa),
  summary_table, add_to_table("Warszawa", "has_parking", parking_warszawa),
  summary_table, add_to_table("Warszawa", "has_balcony", balkon_warszawa),
  summary_table, add_to_table("Warszawa", "has_security", ochrona_warszawa),
  summary_table, add_to_table("Warszawa", "has_storage_room", pom_gosp_warszawa),
  
  summary_table, add_to_table("Radom", "has_elevator", winda_radom),
  summary_table, add_to_table("Radom", "has_parking", parking_radom),
  summary_table, add_to_table("Radom", "has_balcony", balkon_radom),
  summary_table, add_to_table("Radom", "has_security", ochrona_radom),
  summary_table, add_to_table("Radom", "has_storage_room", pom_gosp_radom),
  
  summary_table, add_to_table("Częstochowa", "has_elevator", winda_czestochowa),
  summary_table, add_to_table("Częstochowa", "has_parking", parking_czestochowa),
  summary_table, add_to_table("Częstochowa", "has_balcony", balkon_czestochowa),
  summary_table, add_to_table("Częstochowa", "has_security", ochrona_czestochowa),
  summary_table, add_to_table("Częstochowa", "has_storage_room", pom_gosp_czestochowa),
  
  summary_table, add_to_table("Rzeszów", "has_elevator", winda_rzeszow),
  summary_table, add_to_table("Rzeszów", "has_parking", parking_rzeszow),
  summary_table, add_to_table("Rzeszów", "has_balcony", balkon_rzeszow),
  summary_table, add_to_table("Rzeszów", "has_security", ochrona_rzeszow),
  summary_table, add_to_table("Rzeszów", "has_storage_room", pom_gosp_rzeszow),
  
  summary_table, add_to_table("Białystok", "has_elevator", winda_bialystok),
  summary_table, add_to_table("Białystok", "has_parking", parking_bialystok),
  summary_table, add_to_table("Białystok", "has_balcony", balkon_bialystok),
  summary_table, add_to_table("Białystok", "has_security", ochrona_bialystok),
  summary_table, add_to_table("Białystok", "has_storage_room", pom_gosp_bialystok)
)

kable(summary_table, caption = "Podsumowanie wyników testów Manna-Whitneya dla miast i zmiennych kategorycznych.")
```

#### Interpretacja wyników testu Mann-Whitneya

W przeprowadzonych testach Manna--Whitneya (z alternatywą `less`)
sprawdzano istotność statystyczną różnic w medianach ceny mieszkań
(zmienna `price`) w zależności od pięciu cech (zmiennych
kategorycznych):

-   `has_elevator` (czy mieszkanie ma windę),

-   `has_parking` (czy mieszkanie ma parking),

-   `has_balcony` (czy mieszkanie ma balkon),

-   `has_security` (czy w budynku jest ochrona),

-   `has_storage_room` (czy mieszkanie/dyspozycji jest pomieszczenie
    gospodarcze).

Test przeprowadzono osobno dla każdej z wybranych miejscowości. W
poniższej interpretacji „istotna różnica" oznacza odrzucenie hipotezy
zerowej (p \< 0.05), natomiast „brak istotnej różnicy" -- brak podstaw
do jej odrzucenia (p ≥ 0.05).

### Kraków

-   `has_elevator`, `has_parking`, `has_balcony`: stwierdzono
    istotne różnice w rozkładach cen (p \< 0.05).

-   `has_security`, `has_storage_room`: brak istotnych różnic (p ≥
    0.05).

W Krakowie cechy takie jak winda, parking czy balkon mogą więc wiązać
się z innym poziomem mediany ceny niż w przypadku mieszkań bez tych
udogodnień. Natomiast ochrona i pomieszczenie gospodarcze nie wykazały
statystycznie istotnego wpływu na rozkład cen.

### Warszawa

-   `has_elevator`, `has_parking`, `has_balcony`,
    `has_security`: istotna różnica (p \< 0.05).

-   `has_storage_room`: brak istotnej różnicy (p ≥ 0.05).

W stolicy niemal wszystkie uwzględniane udogodnienia (poza
pomieszczeniem gospodarczym) istotnie różnicują medianę ceny.

### Radom

-   `has_parking`: istotna różnica (p \< 0.05).

-   `has_elevator`, `has_balcony`, `has_security`,
    `has_storage_room`: brak istotnej różnicy (p ≥ 0.05).

Dla mieszkań w Radomiu tylko parking istotnie wpływa na ceny w ujęciu
statystycznym.

### Częstochowa

-   `has_parking`, `has_balcony`: istotna różnica (p \< 0.05).

-   `has_elevator`, `has_security`, `has_storage_room`: brak
    istotnej różnicy (p ≥ 0.05).

Tutaj ważnymi czynnikami wpływającymi na ceny (w sensie statystycznym)
okazały się posiadanie parkingu oraz balkonu.

### Rzeszów

-   Dla wszystkich pięciu analizowanych cech (winda, parking, balkon,
    ochrona, pom. gospodarcze) **brak istotnej różnicy** (p ≥ 0.05).

W Rzeszowie nie stwierdzono wpływu żadnej z badanych zmiennych
kategorycznych na rozkład cen w testach Manna--Whitneya.

### Białystok

-   `has_elevator`, `has_parking`, `has_balcony`: istotna różnica
    (p \< 0.05).

-   `has_security`, `has_storage_room`: brak istotnej różnicy (p ≥
    0.05).

W Białymstoku posiadanie windy, parkingu oraz balkonu różnicowało
medianę cen, natomiast ochrona i pomieszczenie gospodarcze nie miały
takiego istotnego efektu.

**Podsumowując**, w większości miast zaobserwowano istotne statystycznie
różnice w medianach cen przy uwzględnieniu co najmniej jednej z
wybranych cech. Szczególnie często wyłaniającymi się zmiennymi okazały
się:

-   `has_parking` (istotne m.in. w Krakowie, Warszawie, Radomiu,
    Częstochowie, Białymstoku),

-   `has_balcony` (istotne m.in. w Krakowie, Warszawie, Częstochowie,
    Białymstoku).

Dane te sugerują, że w większości analizowanych lokalizacji obecność
parkingu czy balkonu może wpływać na kształtowanie się cen mieszkań,
podczas gdy ochrona i pomieszczenie gospodarcze rzadziej dawały
statystycznie istotne różnice -- wyjątkiem był Radom, gdzie jedynie
parking się wyróżnił. W Rzeszowie z kolei żaden z badanych czynników nie
wpłynął istotnie na medianę cen.



## Test ANOVA

### Cel
Zdecydowaliśmy się na przeprowadzenie testu Anova na podstawie zmiennych:
`has_balcony`, `has_elevator`, `has_parking`, `has_security` oraz 
`has_storage_room` ze względu na to, że w naszych poprzednich analizach okazały 
się one być najbardziej kluczowe w kształtowaniu się cen nieruchomości. 
Celem testu Anova będzie weryfikacja i ewentualne potwierdzenie czy rzeczywiście
mają one tak ważne znaczenie w modelowaniu się cen mieszkań w wybranych miastach. 

### Definicja Testu ANOVA
Test ANOVA to statystyczna metoda służąca do analizy różnic między średnimi 
wartościami w różnych grupach. W szczególności:  <br>
- **Hipoteza zerowa (H₀):** Średnie we wszystkich grupach są równe.<br>
- **Hipoteza alternatywna (H₁):** Przynajmniej jedna para średnich grup jest różna.

Statystyka testu **F** wyrażana jest wzorem:

\[
F = \frac{\text{MS}_{\text{between}}}{\text{MS}_{\text{within}}}
\]

gdzie: <br>
- \(\text{MS}_{\text{between}} = \frac{\text{SS}_{\text{between}}}{df_{\text
{between}}}\) – średni kwadrat między grupami,<br>
- \(\text{MS}_{\text{within}} = \frac{\text{SS}_{\text{within}}}{df_{\text
{within}}}\) – średni kwadrat wewnątrz grup,<br>
- \(\text{SS}_{\text{between}}\) – suma kwadratów odchyleń między grupami, <br>
- \(\text{SS}_{\text{within}}\) – suma kwadratów odchyleń wewnątrz grup,<br>
- \(df_{\text{between}}\) i \(df_{\text{within}}\) – liczby stopni swobody
odpowiednio dla efektu między grupami i resztowego.


### Wymagania Testu ANOVA
1. Zmienne w grupach są niezależne.
2. Rozkład wyników w każdej grupie jest normalny.
3. Wariancje w grupach są homogeniczne (jednakowe).

```{r test_ANOVA, echo=FALSE}

#Zmienne do przeprowadzenia testu ANOVA
zmienne_do_testu_Anova <- data.frame(
  city = c("Białystok", "Częstochowa", "Radom", "Kraków", "Warszawa", "Rzeszów"),
  has_balcony = c(TRUE, TRUE, FALSE, TRUE, TRUE, FALSE),
  has_elevator = c(TRUE, FALSE, FALSE, TRUE, TRUE, TRUE),
  has_parking = c(TRUE, TRUE, TRUE, TRUE, TRUE, FALSE),
  has_security = c(FALSE, FALSE, FALSE, TRUE, TRUE, FALSE),
  has_storage_room = c(FALSE, FALSE, FALSE, TRUE, TRUE, TRUE)
)

# Test Anovy dla Białegostoku: 
aov_bialystok <- aov(bialystok$price~bialystok$has_balcony + bialystok$has_elevator + bialystok$has_parking)
#summary(aov_bialystok)

# Test Anovy dla Częstochowy: 
aov_czestochowa <- aov(czestochowa$price~czestochowa$has_balcony + czestochowa$has_parking)
#summary(aov_czestochowa)

# Test Anovy dla Radomia: 
aov_radom <- aov(radom$price~radom$has_parking)
#summary(aov_radom)

# Test Anovy dla Krakowa: 
aov_krakow <- aov(krakow$price~krakow$has_balcony + krakow$has_elevator + krakow$has_parking + krakow$has_security + krakow$has_storage_room)
#summary(aov_krakow) 

# Test Anovy dla Warszawy: 
aov_warszawa <- aov(warszawa$price~warszawa$has_balcony + warszawa$has_elevator + warszawa$has_parking + warszawa$has_security + warszawa$has_storage_room)
#summary(aov_warszawa)

# Test Anovy dla Rzeszowa: 
aov_rzeszow <- aov(rzeszow$price~rzeszow$has_elevator + rzeszow$has_storage_room)
#summary(aov_rzeszow)

```

### Wyniki testu
```{r wizualizacja_wyników_ANOVY, echo=FALSE}
# Funkcja do dodania wyników do tabeli
add_to_table <- function(city, variable, f_value, p_value) {
# Interpretacja na podstawie wartości p
interpretation <- ifelse(p_value < 0.05, "Istotna różnica", "Brak istotnej różnicy")
  
  return(data.frame(
    Miasto = city,
    Zmienna = variable,
    F_value = f_value,
    p_value = format(p_value, scientific = FALSE),
    Interpretacja = interpretation
  ))
}

# Utworzenie pustej tabeli do przechowywania wyników
summary_table <- data.frame(Miasto = character(), Zmienna = character(), 
                            F_value = numeric(), p_value = character(), Interpretacja = character(), stringsAsFactors = FALSE)

# Dodanie wyników testów ANOVA do tabeli
summary_table <- rbind(
  summary_table, add_to_table("Białystok", "has_balcony", 4.985, 0.02654),
  summary_table, add_to_table("Białystok", "has_elevator", 9.919, 0.00186),
  summary_table, add_to_table("Białystok", "has_parking", 1.046, 0.30757),
  
  summary_table, add_to_table("Częstochowa", "has_balcony", 13.82, 0.000231),
  summary_table, add_to_table("Częstochowa", "has_parking", 23.75, 1.61e-06),
  
  summary_table, add_to_table("Radom", "has_parking", 45.71, 1.58e-10),
  
  summary_table, add_to_table("Kraków", "has_balcony", 50.170, 1.72e-12),
  summary_table, add_to_table("Kraków", "has_elevator", 4.470, 0.0346),
  summary_table, add_to_table("Kraków", "has_parking", 19.975, 8.12e-06),
  summary_table, add_to_table("Kraków", "has_security", 0.019, 0.8918),
  summary_table, add_to_table("Kraków", "has_storage_room", 43.431, 5.11e-11),
  
  summary_table, add_to_table("Warszawa", "has_balcony", 55.88, 8.64e-14),
  summary_table, add_to_table("Warszawa", "has_elevator", 43.80, 3.90e-11),
  summary_table, add_to_table("Warszawa", "has_parking", 210.07, 2e-16),
  summary_table, add_to_table("Warszawa", "has_security", 45.52, 1.63e-11),
  summary_table, add_to_table("Warszawa", "has_storage_room", 62.48, 3.11e-15),
  
  summary_table, add_to_table("Rzeszów", "has_elevator", 0.240, 0.6252),
  summary_table, add_to_table("Rzeszów", "has_storage_room", 4.676, 0.0321)
)

library(kableExtra)
kable(summary_table, caption = "Podsumowanie wyników testów ANOVA dla miast i zmiennych kategorycznych.") %>%
  kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover", "condensed"))

```
### Interpretacja wyników testu ANOVA

### 1. **Białystok**:
- `has_balcony` (F = 4.985, p = 0.02654): F-value wskazuje, że różnice w cenie między nieruchomościami z balkonem a tymi bez niego są stosunkowo duże. Istotność statystyczna (p < 0.05) potwierdza, że obecność balkonu wpływa na cenę nieruchomości.
- `has_elevator` (F = 9.919, p = 0.00186): F-value wskazuje, że różnice w cenach nieruchomości z windą są jeszcze bardziej wyraźne. Ponownie, p-value < 0.05, więc wpływ windy na cenę jest istotny.
- `has_parking` (F = 1.046, p = 0.30757): F-value sugeruje, że różnice w cenach nieruchomości z parkingiem nie są duże w Białymstoku, a p-value > 0.05, więc nie ma istotnych różnic między grupami.

### 2. **Częstochowa**:
- `has_balcony` (F = 13.820, p = 0.000231): Bardzo duża wartość F wskazuje na dużą różnicę w cenach nieruchomości z balkonem i tych bez niego. Bardzo małe p-value (< 0.05) potwierdza istotność tego czynnika.
- `has_parking` (F = 23.750, p = 0.00000161): F-value jest wyjątkowo wysokie, co sugeruje, że parking ma ogromny wpływ na cenę nieruchomości w Częstochowie. p-value < 0.05 wskazuje na bardzo istotny wpływ parkingu na cenę.

### 3. **Radom**:
- `has_parking` (F = 45.710, p = 0.000000000158): F-value jest bardzo wysokie, co oznacza, że różnice w cenach między nieruchomościami z parkingiem i tymi bez parkingu w Radomiu są bardzo duże. p-value bliskie zeru (< 0.05) potwierdza, że obecność parkingu znacząco wpływa na cenę.


### 4. **Kraków**:
- `has_balcony` (F = 50.170, p = 0.00000000000172): Bardzo wysoka wartość F wskazuje na bardzo dużą różnicę w cenach nieruchomości z balkonem w Krakowie. p-value < 0.05 potwierdza istotność tego czynnika.
- `has_elevator` (F = 4.470, p = 0.0346): Chociaż F-value jest mniejsze, to nadal wskazuje na istotną różnicę w cenach nieruchomości z windą. p-value < 0.05 potwierdza istotność tej cechy.
- `has_parking` (F = 19.975, p = 0.00000812): Wysokie F-value oznacza, że parking ma istotny wpływ na cenę nieruchomości w Krakowie. p-value < 0.05 potwierdza istotność parkingu.
- `has_security` (F = 0.019, p = 0.8918): Niska wartość F i p-value > 0.05 sugerują, że obecność zabezpieczeń nie wpływa istotnie na cenę nieruchomości w Krakowie.
- `has_storage_room` (F = 43.431, p = 0.0000000000511): Bardzo wysoka wartość F sugeruje, że pokój do przechowywania ma bardzo duży wpływ na cenę nieruchomości w Krakowie. p-value < 0.05 potwierdza istotność tej cechy.

### 5. **Warszawa**:
- `has_balcony` (F = 55.880, p = 0.0000000000000864): Bardzo wysoka wartość F wskazuje na bardzo istotny wpływ balkonu na cenę nieruchomości w Warszawie. p-value < 0.05 potwierdza istotność tego czynnika.
- `has_elevator` (F = 43.800, p = 0.000000000039): Wysokie F-value sugeruje, że winda ma istotny wpływ na cenę nieruchomości. p-value < 0.05 potwierdza istotność windy.
- `has_parking` (F = 210.070, p = 0.0000000000000002): Bardzo wysokie F-value wskazuje na ogromny wpływ parkingu na cenę nieruchomości w Warszawie. p-value < 0.05 potwierdza istotność parkingu.
- `has_security` (F = 45.520, p = 0.0000000000163): Bardzo wysoka wartość F sugeruje, że obecność zabezpieczeń ma bardzo silny wpływ na cenę nieruchomości w Warszawie. p-value < 0.05 wskazuje na istotność tej cechy.
- `has_storage_room` (F = 62.480, p = 0.00000000000000311): Najwyższe F-value z wszystkich zmiennych w Warszawie, co sugeruje, że pokój do przechowywania ma bardzo silny wpływ na cenę nieruchomości. p-value < 0.05 potwierdza istotność tej cechy.

### 6. **Rzeszów**:
- `has_elevator` (F = 0.240, p = 0.6252): Bardzo niska wartość F i p-value > 0.05 wskazują, że winda nie ma istotnego wpływu na cenę nieruchomości w Rzeszowie.
- `has_storage_room` (F = 4.676, p = 0.0321): F-value wskazuje na istotną różnicę w cenach nieruchomości z pokojem do przechowywania. p-value < 0.05 wskazuje, że obecność pokoju do przechowywania ma wpływ na cenę nieruchomości w Rzeszowie.


### **Dodatkowe wnioski:**

- Wpływ cech na cenę nieruchomości:
  - `Balkon` i `Parking` mają bardzo silny wpływ na cenę nieruchomości, zwłaszcza w **większych miastach** jak **Warszawa** i **Kraków** (wysokie F-value i niskie p-value).
  - `Winda` wpływa na cenę, ale w **mniejszych miastach** (np. w **Rzeszowie**) wpływ jest mniejszy.
  - `Pokój do przechowywania` również wykazuje istotny wpływ na cenę, szczególnie w **Krakowie** i **Warszawie**.
  - `Zabezpieczenia` w większości miast (z wyjątkiem **Warszawy**) nie mają znaczącego wpływu na cenę nieruchomości.

### **Podsumowanie**:
- **Spełnione założenia**: Zmienność wyników w grupach jest niezależna, a wyniki mogą w dużej mierze spełniać założenia o normalności i homogeniczności wariancji.
- **Wnioski dotyczące wpływu cech na ceny**: Obecność balkonu, parkingu, windy oraz pokoju do przechowywania mają istotny wpływ na cenę nieruchomości, szczególnie w większych miastach, takich jak Warszawa czy Kraków.


# **Analiza czynników geograficznych wpływających na ceny mieszkań**

## Odległość od centrum

```{r, echo=FALSE, comment=FALSE, warning=FALSE, message=FALSE}

ggplot(dane_filtr, aes(x = centre_distance, y = price)) +
  geom_point(alpha = 0.5, color = "plum") +
  geom_smooth(method = "lm", color = "orange", se = FALSE) +
  facet_wrap(~ city) + 
  labs(
    title = "Wpływ odległości od centrum miasta na ceny mieszkań",
    x = "Odległość od centrum (km)",
    y = "Cena mieszkania (PLN)"
  ) +
  theme_minimal()

```

#### Ogólne wnioski:

1.  **Warszawa i Kraków**:
    -   W obu miastach widać wyraźny spadek cen mieszkań wraz z rosnącą
        odległością od centrum (linia regresji jest nachylona w dół). To
        może świadczyć o tym, że w tych dużych miastach lokalizacja
        bliżej centrum jest kluczowym czynnikiem wpływającym na cenę.
2.  **Częstochowa, Radom**:
    -   W tych miastach linie regresji są prawie płaskie lub lekko
        nachylone w górę, co sugeruje brak wyraźnej zależności między
        odległością od centrum a ceną. Może to wskazywać, że w
        mniejszych miastach czynniki takie jak standard mieszkania lub
        lokalne preferencje mogą odgrywać większą rolę niż sama
        odległość od centrum.
3.  **Białystok, Rzeszów**:
    -   W przypadku Rzeszowa widzimy, że linia jest nachylona w górę,
        oznacza to, że wraz ze wzrostem odległości od centrum miasta,
        ceny mieszkań rosną. Białystok również cechuje się linią
        nachyloną w górę jednak w mniejszym stopniu w przeciwieństwie do
        Rzeszowa.
4.  **Rozrzut danych**:
    -   W miastach takich jak Warszawa czy Kraków widać większy rozrzut
        cen (punkty są bardziej rozproszone), co oznacza, że mieszkania
        w tych miastach mają znacznie większe zróżnicowanie cen.

#### Interpretacja:

W miastach takich jak Warszawa i Kraków bliskość centrum jest istotnym
czynnikiem wpływającym na ceny mieszkań -- im bliżej centrum, tym ceny
są wyższe. W mniejszych miastach, takich jak Radom czy Białystok,
odległość od centrum nie ma tak dużego wpływu na ceny mieszkań, a inne
czynniki mogą dominować w kształtowaniu wartości nieruchomości.

------------------------------------------------------------------------

```{r, echo=FALSE, results='asis', eval=TRUE}
korelacje_cena_odl <- dane_filtr %>%
  group_by(city) %>% 
  summarise(
    korelacja = cor(centre_distance, price, method = "pearson") 
  )
knitr::kable(korelacje_cena_odl, col.names = c("Miasto", "Wynik korelacji"), caption = "Współczynniki korelacji między odległością od centrum miasta a ceną mieszkań")
```

Tabela przedstawia współczynniki korelacji między odległością od centrum
miasta a ceną mieszkań dla sześciu miast. Współczynnik korelacji
przyjmuje wartości od -1 (pełna korelacja ujemna) do 1 (pełna korelacja
dodatnia), gdzie wartość 0 oznacza brak korelacji.

1.  **Białystok**:
    -   Występuje niewielka dodatnia korelacja. Oznacza to, że wraz ze
        wzrostem odległości od centrum ceny mieszkań delikatnie rosną,
        choć zależność nie jest silna.
2.  **Rzeszów**:
    -   Średnia dodatnia korelacja. W Rzeszowie obserwujemy wyraźniejszą
        tendencję wzrostu cen mieszkań w miarę oddalania się od centrum,
        choć zależność nie jest bardzo silna.
3.  **Częstochowa**:
    -   Podobnie jak w Białymstoku, korelacja jest dodatnia, ale bardzo
        słaba. Oznacza to, że odległość od centrum ma niewielki wpływ na
        ceny mieszkań, z tendencją do ich wzrostu na obrzeżach miasta.
4.  **Kraków**:
    -   Silna ujemna korelacja wskazuje, że w Krakowie im dalej od
        centrum, tym ceny mieszkań wyraźnie maleją. Centrum miasta
        wydaje się być znacznie bardziej atrakcyjne cenowo niż obrzeża.
5.  **Warszawa**:
    -   Słaba ujemna korelacja wskazuje, że w Warszawie ceny mieszkań
        nieznacznie spadają wraz z oddalaniem się od centrum, ale
        zależność nie jest silna.
6.  **Radom**:
    -   Praktycznie brak korelacji. Oznacza to, że w Radomiu odległość
        od centrum nie ma znaczącego wpływu na ceny mieszkań.

------------------------------------------------------------------------

## Odległość od szkoły

```{r, echo=FALSE, comment=FALSE, warning=FALSE, message=FALSE}
ggplot(dane_filtr, aes(x = school_distance, y = price)) +
  geom_point(alpha = 0.5, color = "navyblue") +
  geom_smooth(method = "lm", color = "peachpuff", se = FALSE) +
  facet_wrap(~ city) + 
  labs(
    title = "Wpływ odległości od szkół na ceny mieszkań",
    x = "Odległość od szkół (km)",
    y = "Cena mieszkania (PLN)"
  ) +
  theme_minimal()
```

#### Ogólne wnioski:

1.  **Warszawa i Kraków**:
    -   W Krakowie możemy zauważyć, że linia jest lekko nachylona w dół
        co sugeruje nam, że lokalizacja bliżej szkół jest kluczowym
        czynnikiem wpływającym na cenę. W przypadku Warszawy linia jest
        nachylona w górę co może świadczyć że wraz ze wzrostem
        odległości od szkół, ceny mieszkań rosną.
2.  **Częstochowa, Radom, Białystok, Rzeszów**:
    -   W mniejszych miastach, takich jak Radom, Rzeszów czy
        Częstochowa, linie regresji są nachylone w górę, co sugeruje
        zależność -- ceny mieszkań mogą nieco rosnąć wraz z odległością
        od szkół. To może wynikać z preferencji mieszkańców, którzy wolą
        spokojniejsze rejony z dala od szkół.
3.  **Rozrzut danych**:
    -   Warszawa i Kraków charakteryzują się większym rozproszeniem cen
        mieszkań w stosunku do odległości od szkół, co może wskazywać na
        różnorodność lokalnych czynników wpływających na ceny. W
        mniejszych miastach rozrzut jest mniejszy, a ceny są bardziej
        przewidywalne.

#### Interpretacja:

Bliskość szkół wydaje się wpływać na wyższe ceny mieszkań w Warszawie i
Krakowie, co sugeruje, że dla mieszkańców tych miast istotna jest
łatwość dostępu do placówek edukacyjnych, zwłaszcza dla rodzin z
dziećmi. W mniejszych miastach, takich jak Radom, Rzeszów czy Białystok,
wpływ odległości od szkół na ceny mieszkań jest mniej wyraźny lub
odwrotny. W tych lokalizacjach mieszkańcy mogą preferować spokojniejsze
rejony z dala od szkół, co może sugerować lekkie wzrosty cen wraz z
oddaleniem od placówek edukacyjnych.

------------------------------------------------------------------------

```{r, echo=FALSE, results='asis', eval=TRUE}
korelacje_cena_odl_school <- dane_filtr %>%
  group_by(city) %>% 
  summarise(
    korelacja = cor(school_distance, price) 
  )
knitr::kable(korelacje_cena_odl_school, col.names = c("Miasto", "Wynik korelacji"), caption = "Współczynniki korelacji między odległością od szkół a ceną mieszkań")
```

Tabela przedstawia współczynniki korelacji między odległością od szkół a
ceną mieszkań dla sześciu miast. Współczynnik korelacji przyjmuje
wartości od -1 (pełna korelacja ujemna) do 1 (pełna korelacja dodatnia),
gdzie wartość 0 oznacza brak korelacji.

1.  **Białystok**
    -   Słaba, ale pozytywna korelacja oznacza, że wraz ze wzrostem
        odległości od uczelni ceny mieszkań **nieznacznie rosną**.
        Preferencja dla spokojniejszych lokalizacji oddalonych od
        uczelni, choć efekt jest minimalny.
2.  **Częstochowa**
    -   Umiarkowanie pozytywna korelacja wskazuje, że mieszkania dalej
        od uczelni są wyraźnie droższe. Cichsze lokalizacje są bardziej
        pożądane niż te blisko uczelni.
3.  **Kraków**
    -   Korelacja jest **negatywna i bliska zeru**, co oznacza, że
        mieszkania bliżej uczelni są **nieco droższe**. W mieście
        akademickim, jak Kraków, bliskość uczelni jest ważnym atutem.
4.  **Radom**
    -   Słaba pozytywna korelacja wskazuje, że ceny mieszkań **lekko
        rosną z odległością od uczelni**. Bliskość uczelni nie jest
        kluczowym czynnikiem wpływającym na ceny.
5.  **Rzeszów**
    -   Słaba pozytywna korelacja oznacza, że ceny mieszkań **lekko
        rosną z odległością od uczelni**. Preferencje mogą skłaniać się
        ku lokalizacjom oddalonym od uczelni, choć różnice są
        niewielkie.
6.  **Warszawa**
    -   Korelacja jest **bliska zeru**, co oznacza, że odległość od
        uczelni praktycznie **nie wpływa na ceny mieszkań**. W dużym
        rynku warszawskim ważniejsze są inne czynniki, np. lokalizacja
        dzielnicy czy standard mieszkania.

------------------------------------------------------------------------

## Odległość od kliniki

```{r, echo=FALSE, comment=FALSE, warning=FALSE, message=FALSE}
ggplot(dane_filtr, aes(x = clinic_distance, y = price)) +
  geom_point(alpha = 0.5, color = "tomato") +
  geom_smooth(method = "lm", color = "lightgreen", se = FALSE) +
  facet_wrap(~ city) + 
  labs(
    title = "Wpływ odległości od klinik na ceny mieszkań",
    x = "Odległość od klinik (km)",
    y = "Cena mieszkania (PLN)"
  ) +
  theme_minimal()
```

#### Ogólne wnioski:

1.  **Warszawa i Kraków**:
    -   W tych dużych miastach widoczny jest wyraźny spadek cen mieszkań
        wraz ze wzrostem odległości od klinik (nachylenie linii regresji
        jest ujemne). Może to sugerować, że w Warszawie i Krakowie
        bliskość do placówek medycznych jest ważnym czynnikiem
        podnoszącym wartość mieszkań.
2.  **Częstochowa, Radom, Białystok i Rzeszów**:
    -   W mniejszych miastach (np. Radom, Rzeszów, Częstochowa) linie
        regresji są lekko nachylone w górę, co oznacza, że w tych
        lokalizacjach ceny mieszkań mogą wzrastać wraz z odległością od
        klinik. Warto jednak zauważyć, że wpływ ten jest minimalny, co
        może wskazywać na brak wyraźnej zależności.
3.  **Rozrzut danych**:
    -   W większych miastach (np. Warszawa, Kraków) dane są bardziej
        rozproszone, co świadczy o większej różnorodności cen mieszkań w
        zależności od odległości. W mniejszych miastach punkty są
        bardziej skupione, co oznacza mniej zróżnicowane ceny mieszkań.

#### Interpretacja:

W dużych miastach, takich jak Warszawa i Kraków, odległość od klinik ma
wyraźny wpływ na ceny mieszkań -- im bliżej klinik, tym wyższe ceny.
Wskazuje to na duże znaczenie bliskości do placówek medycznych w
kształtowaniu wartości nieruchomości w tych aglomeracjach. W mniejszych
miastach, takich jak Radom, Częstochowa czy Białystok, ta zależność jest
mniej widoczna lub wręcz odwrotna. Ceny mieszkań mogą tam wzrastać wraz
z odległością od klinik, choć wpływ ten jest słaby. Może to wynikać z
mniejszego nacisku na dostępność medyczną w tych lokalizacjach.

------------------------------------------------------------------------

```{r, echo=FALSE, results='asis', eval=TRUE}
korelacje_cena_clinic <- dane_filtr %>%
  group_by(city) %>% 
  summarise(
    korelacja = cor(clinic_distance, price) 
  )
knitr::kable(korelacje_cena_clinic, col.names = c("Miasto", "Wynik korelacji"), caption = "Współczynniki korelacji między odległością od klinik a ceną mieszkań")
```

Tabela przedstawia współczynniki korelacji między odległością od klinik
a ceną mieszkań dla sześciu miast. Współczynnik korelacji przyjmuje
wartości od -1 (pełna korelacja ujemna) do 1 (pełna korelacja dodatnia),
gdzie wartość 0 oznacza brak korelacji.

1.  **Białystok**
    -   Bardzo słaba pozytywna korelacja. Odległość od klinik
        praktycznie **nie wpływa na ceny mieszkań**. Może to wynikać z
        równej dostępności usług medycznych w całym mieście.
2.  **Częstochowa**
    -   Umiarkowana pozytywna korelacja. Mieszkania w większej
        odległości od klinik są droższe, co może sugerować, że
        mieszkańcy preferują lokalizacje w cichszych i spokojniejszych
        rejonach miasta, z dala od klinik.
3.  **Kraków**
    -   Słaba negatywna korelacja. Wraz ze wzrostem odległości od klinik
        ceny mieszkań **spadają**, co może wskazywać, że bliskość do
        placówek medycznych jest ceniona przez mieszkańców Krakowa.
4.  **Radom**
    -   Słaba pozytywna korelacja.Mieszkania w większej odległości od
        klinik są nieco droższe. Podobnie jak w przypadku Częstochowy,
        może to wynikać z preferencji dla spokojniejszych rejonów.
5.  **Rzeszów**
    -   Umiarkowana pozytywna korelacja. Ceny mieszkań **rosną wraz z
        odległością od klinik**, co sugeruje, że bliskość do klinik nie
        jest kluczowym czynnikiem wpływającym na wartość mieszkań w
        Rzeszowie.
6.  **Warszawa**
    -   Bardzo słaba negatywna korelacja. Mieszkania bliżej klinik są
        nieco droższe, co może wskazywać na większą wartość lokalizacji
        z łatwym dostępem do opieki medycznej, ale efekt ten jest
        minimalny.

------------------------------------------------------------------------

## Odległość od poczty

```{r, echo=FALSE, comment=FALSE, warning=FALSE, message=FALSE}
ggplot(dane_filtr, aes(x = post_office_distance, y = price)) +
  geom_point(alpha = 0.5, color = "darkolivegreen3") +
  geom_smooth(method = "lm", color = "dodgerblue1", se = FALSE) +
  facet_wrap(~ city) + 
  labs(
    title = "Wpływ odległości od poczty na ceny mieszkań",
    x = "Odległość od poczty (km)",
    y = "Cena mieszkania (PLN)"
  ) +
  theme_minimal()
```

#### Ogólne wnioski:

1.  **Warszawa i Kraków**:
    -   W tych dużych miastach linie regresji są prawie poziome, co
        wskazuje na brak istotnego wpływu odległości od poczty na ceny
        mieszkań. Wynik ten sugeruje, że bliskość placówek pocztowych
        nie jest istotnym czynnikiem w kształtowaniu wartości
        nieruchomości w dużych miastach.
2.  **Częstochowa, Radom, Białystok i Rzeszów**:
    -   W mniejszych miastach (np. Radom, Rzeszów, Częstochowa) linie
        regresji są lekko nachylone w górę, co oznacza, że w tych
        lokalizacjach ceny mieszkań mogą wzrastać wraz z odległością od
        klinik. Warto jednak zauważyć, że wpływ ten jest minimalny, co
        może wskazywać na brak wyraźnej zależności.
3.  **Rozrzut danych**:
    -   W większych miastach (np. Warszawa, Kraków) dane są bardziej
        rozproszone, co świadczy o większej różnorodności cen mieszkań w
        zależności od odległości. W mniejszych miastach punkty są
        bardziej skupione, co oznacza mniej zróżnicowane ceny mieszkań.

#### **Interpretacja:**

W dużych miastach, takich jak Warszawa i Kraków, odległość od placówek
pocztowych nie ma wyraźnego wpływu na ceny mieszkań. Linie regresji są
niemal poziome, co wskazuje na brak istotnej zależności. W tych
aglomeracjach bliskość do poczty nie jest czynnikiem wpływającym na
wartość nieruchomości, co może wynikać z szerokiej dostępności placówek
pocztowych oraz dominacji innych czynników, takich jak prestiż
lokalizacji czy dostępność usług miejskich. Rozrzut danych w tych
miastach jest znaczący, co odzwierciedla duże zróżnicowanie cen
nieruchomości.

W mniejszych miastach, takich jak Częstochowa, Radom, Białystok i
Rzeszów, zauważalny jest lekki wzrost cen mieszkań wraz z odległością od
placówek pocztowych. Linie regresji są delikatnie nachylone w górę, co
sugeruje, że mieszkania w większej odległości od poczty mogą być
bardziej cenione. Może to wynikać z preferencji mieszkańców dla
spokojniejszych lokalizacji lub mniejszego znaczenia bliskości do usług
pocztowych w codziennym życiu. Niemniej jednak, wpływ ten jest minimalny
i nie wskazuje na silną zależność.

Rozrzut danych w mniejszych miastach jest znacznie mniejszy niż w dużych
aglomeracjach. Punkty na wykresach są bardziej skupione, co oznacza
mniejsze zróżnicowanie cen mieszkań w tych lokalizacjach. Sugeruje to
bardziej jednorodny rynek nieruchomości, gdzie ceny są mniej podatne na
czynniki takie jak odległość od placówek pocztowych.

```{r, echo=FALSE, results='asis', eval=TRUE}
korelacje_cena_post <- dane_filtr %>%
  group_by(city) %>% 
  summarise(
    korelacja = cor(post_office_distance, price) 
  )
knitr::kable(korelacje_cena_post, col.names = c("Miasto", "Wynik korelacji"), caption = "Współczynniki korelacji między odległością od poczty a ceną mieszkań")
```

Tabela przedstawia współczynniki korelacji między odległością od poczty
a ceną mieszkań dla sześciu miast. Współczynnik korelacji przyjmuje
wartości od -1 (pełna korelacja ujemna) do 1 (pełna korelacja dodatnia),
gdzie wartość 0 oznacza brak korelacji.

1.  **Białystok**
    -   Słaba pozytywna korelacja.Mieszkania w większej odległości od
        poczty są nieco droższe. Może to wynikać z faktu, że poczty
        znajdują się głównie w centralnych, tańszych rejonach miasta.
2.  **Częstochowa**
    -   Słaba, ale wyraźniejsza pozytywna korelacja. Ceny mieszkań
        wzrastają wraz z odległością od poczty. Może to oznaczać, że
        bardziej prestiżowe lokalizacje znajdują się poza obszarami
        intensywnie zabudowanymi, gdzie zlokalizowane są poczty.
3.  **Kraków**
    -   Bardzo słaba pozytywna korelacja. Odległość od poczty ma
        praktycznie **żaden wpływ na ceny mieszkań**. Dostępność tej
        infrastruktury jest prawdopodobnie wyrównana w całym mieście.
4.  **Radom**
    -   Słaba pozytywna korelacja. Mieszkania w dalszej odległości od
        poczty są nieznacznie droższe, ale wpływ odległości na cenę
        mieszkań jest bardzo niewielki.
5.  **Rzeszów**
    -   Umiarkowana pozytywna korelacja. Ceny mieszkań rosną wraz z
        odległością od poczty. Może to świadczyć o większej
        atrakcyjności osiedli oddalonych od gęsto zabudowanych obszarów
        z infrastrukturą miejską.
6.  **Warszawa**
    -   Bardzo słaba negatywna korelacja. Odległość od poczty
        **praktycznie nie wpływa** na ceny mieszkań, choć mieszkania
        bliżej poczty mogą być nieznacznie droższe. W dużym mieście, jak
        Warszawa, bliskość poczty jest mało istotnym czynnikiem.

------------------------------------------------------------------------

## Odległość od przedszkoli

```{r, echo=FALSE, comment=FALSE, warning=FALSE, message=FALSE}
ggplot(dane_filtr, aes(x = kindergarten_distance, y = price)) +
  geom_point(alpha = 0.5, color = "thistle") +
  geom_smooth(method = "lm", color = "violetred4", se = FALSE) +
  facet_wrap(~ city) + 
  labs(
    title = "Wpływ odległości od przedszkoli na ceny mieszkań",
    x = "Odległość od przedszkoli (km)",
    y = "Cena mieszkania (PLN)"
  ) +
  theme_minimal()
```

#### Ogólne wnioski:

1.  **Warszawa i Kraków**:
    -   W obu miastach widać, że linia regresji jest nachylona w górę,
        jednak w przypadku Krakowa nachylenie to jest zdecydowanie
        większę niż w Warszawie. Sugeruje to, że wraz ze wzrostem
        odległości od przedszkoli ceny mieszkań delikatnie rosną, choć
        zależność nie jest silna.
2.  **Częstochowa, Radom**:
    -   W tych miastach linie regresji są prawie płaskie lub lekko
        nachylone w górę, co sugeruje brak wyraźnej zależności między
        odległością od centrum a ceną. Może to wskazywać, że w
        mniejszych miastach czynniki takie jak standard mieszkania lub
        lokalne preferencje mogą odgrywać większą rolę niż sama
        odległość od centrum.
3.  **Białystok, Rzeszów**:
    -   W przypadku Rzeszowa widzimy, że linia jest nachylona w górę,
        oznacza to, że wraz ze wzrostem odległości od przedszkoli, ceny
        mieszkań rosną. Białystok również cechuje się linią praktycznie
        poziomą co oznacza, że nie jest to kluczowy czynnik wpływający
        na cenę mieszkań.
4.  **Rozrzut danych**:
    -   Dane są gęsto skupione blisko początku osi X (odległość do
        0,5--2 km). To sugeruje, że większość mieszkań znajduje się
        blisko przedszkoli. W miastach takich jak Kraków i Warszawa dane
        są bardziej rozproszone w porównaniu z mniejszymi miastami.

#### **Interpretacja:**

W dużych miastach, takich jak Warszawa i Kraków, odległość od
przedszkoli wykazuje delikatny wpływ na ceny mieszkań. W Krakowie linia
regresji jest bardziej nachylona w górę niż w Warszawie, co sugeruje, że
w tym mieście mieszkania w większej odległości od przedszkoli mogą być
nieco droższe. Możliwe, że w Krakowie, jako mieście z licznymi starymi
dzielnicami, bliskość przedszkoli nie jest kluczowym czynnikiem
wpływającym na wartość nieruchomości. W Warszawie zależność ta jest
słabsza, a różnorodność innych czynników, takich jak dostępność
komunikacji czy prestiż lokalizacji, zdaje się odgrywać większą rolę.

W mniejszych miastach, takich jak Częstochowa i Radom, linie regresji są
niemal płaskie lub lekko nachylone w górę. Oznacza to, że odległość od
przedszkoli nie ma wyraźnego wpływu na ceny mieszkań. W tych miastach
inne czynniki, takie jak standard mieszkań, dostępność infrastruktury
lub lokalne preferencje, mogą mieć większe znaczenie niż bliskość do
przedszkoli.

W Rzeszowie widoczny jest wzrost cen mieszkań wraz ze wzrostem
odległości od przedszkoli, co wskazuje na możliwą preferencję dla
spokojniejszych lokalizacji, oddalonych od intensywnie uczęszczanych
miejsc. Z kolei w Białymstoku linia regresji jest praktycznie płaska, co
oznacza, że bliskość przedszkoli nie jest czynnikiem determinującym
wartość mieszkań.

Rozrzut danych pokazuje, że większość mieszkań znajduje się w odległości
od 0,5 do 2 km od przedszkoli, co sugeruje wysoką dostępność tych
placówek w analizowanych miastach. W większych miastach, takich jak
Kraków i Warszawa, rozrzut cen mieszkań jest większy, co świadczy o
większej różnorodności rynku nieruchomości. W mniejszych miastach,
takich jak Radom czy Białystok, punkty są bardziej skupione, co
odzwierciedla bardziej jednorodny rynek mieszkań.

------------------------------------------------------------------------

```{r, echo=FALSE, results='asis', eval=TRUE}
korelacje_cena_przed <- dane_filtr %>%
  group_by(city) %>% 
  summarise(
    korelacja = cor(kindergarten_distance, price) 
  )
knitr::kable(korelacje_cena_przed, col.names = c("Miasto", "Wynik korelacji"), caption = "Współczynniki korelacji między odległością od przedszkoli a ceną mieszkań")
```

Tabela przedstawia współczynniki korelacji między odległością od
przedszkoli a ceną mieszkań dla sześciu miast. Współczynnik korelacji
przyjmuje wartości od -1 (pełna korelacja ujemna) do 1 (pełna korelacja
dodatnia), gdzie wartość 0 oznacza brak korelacji.

1.  **Białystok**
    -   Bardzo słaba pozytywna korelacja. Odległość od przedszkoli
        **praktycznie nie wpływa** na ceny mieszkań. Dostępność
        przedszkoli wydaje się być równomierna w różnych rejonach
        miasta.
2.  **Częstochowa**
    -   Bardzo słaba pozytywna korelacja. Odległość od przedszkoli **ma
        minimalny wpływ** na ceny mieszkań. Bliskość przedszkoli nie
        jest istotnym czynnikiem w tym mieście.
3.  **Kraków**
    -   Słaba pozytywna korelacja. Mieszkania w większej odległości od
        przedszkoli są nieco droższe, ale wpływ ten jest niewielki. Może
        to wynikać z tego, że bardziej prestiżowe lokalizacje są dalej
        od typowych osiedli z przedszkolami.
4.  **Radom**
    -   Słaba pozytywna korelacja. Ceny mieszkań rosną wraz z
        odległością od przedszkoli, choć wpływ jest niewielki. Może to
        oznaczać, że mieszkańcy cenią spokój i wolą lokalizacje oddalone
        od instytucji dla dzieci.
5.  **Rzeszów**
    -   Słaba, ale wyraźniejsza pozytywna korelacja. Mieszkania w
        większej odległości od przedszkoli są droższe. Może to
        sugerować, że droższe dzielnice są mniej gęsto zabudowane i
        znajdują się dalej od takich instytucji.
6.  **Warszawa**
    -   Bardzo słaba pozytywna korelacja. Odległość od przedszkoli ma
        **praktycznie żaden wpływ** na ceny mieszkań. W Warszawie
        bliskość przedszkoli nie jest kluczowym czynnikiem dla wartości
        nieruchomości.

------------------------------------------------------------------------

## Odległość od restauracji

```{r, echo=FALSE, comment=FALSE, warning=FALSE, message=FALSE}
ggplot(dane_filtr, aes(x = restaurant_distance, y = price)) +
  geom_point(alpha = 0.5, color = "cornflowerblue") +
  geom_smooth(method = "lm", color = "yellow", se = FALSE) +
  facet_wrap(~ city) + 
  labs(
    title = "Wpływ odległości od restauracji na ceny mieszkań",
    x = "Odległość od restauracji (km)",
    y = "Cena mieszkania (PLN)"
  ) +
  theme_minimal()

```

#### Ogólne wnioski:

1.  **Warszawa i Kraków**
    -   W **Warszawie** i **Krakowie** zauważalne jest, że odległość od
        restauracji ma delikatnie **ujemny wpływ na ceny mieszkań** --
        im dalej restauracji, tym ceny mieszkań są niższe To może
        sugerować, że bliskość restauracji jest postrzegana jako atut
        przez mieszkańców i inwestorów. W obu miastach skupisko punktów
        w bliskiej odległości od restauracji sugeruje dużą gęstość ofert
        mieszkań w pobliżu gastronomii.
2.  **Rzeszów i Białystok**
    -   W obu miastach wpływ odległości od restauracji na ceny mieszkań
        jest **praktycznie neutralny** (linia trendu jest lekko
        nachylona). To sugeruje, że bliskość gastronomii nie jest
        istotnym czynnikiem wpływającym na ceny. Widać skupisko punktów
        w okolicach niewielkich odległości od restauracji, co może
        wynikać z niewielkich odległości w tych miastach.
3.  **Częstochowa i Radom**
    -   Radom cechuje się linią nachyloną ku górze co świadczy o tym, że
        wraz ze wzrostem odległości od restauracji. W Częstochowie linia
        jet niemalże pozioma. To sugeruje, że bliskość gastronomii nie
        jest istotnym czynnikiem wpływającym na ceny.
4.  **Rozrzut danych**:
    -   W miastach takich jak Warszawa, Rzeszów, Częstochowa, Kraków
        widać większy rozrzut cen (punkty są bardziej rozproszone), co
        oznacza, że mieszkania w tych miastach mają znacznie większe
        zróżnicowanie cen.

#### **Interpretacja:**

W dużych miastach, takich jak Warszawa i Kraków, odległość od
restauracji ma delikatny ujemny wpływ na ceny mieszkań -- bliżej
restauracji mieszkania są droższe. W Krakowie efekt ten jest bardziej
zauważalny niż w Warszawie, co może wynikać z większego znaczenia
gastronomii w mieście turystycznym. W Warszawie bliskość restauracji ma
mniejsze znaczenie, a inne czynniki, jak prestiż lokalizacji, odgrywają
większą rolę.

W mniejszych miastach, takich jak Częstochowa i Radom, wpływ odległości
od restauracji na ceny mieszkań jest znikomy. W Radomiu widoczny jest
lekki wzrost cen mieszkań wraz z odległością, co może wynikać z
preferencji dla spokojniejszych lokalizacji. W Częstochowie brak
wyraźnej zależności.

W Rzeszowie i Białymstoku odległość od restauracji nie ma istotnego
wpływu na ceny mieszkań -- linie regresji są niemal poziome. Może to
wynikać z dobrej dostępności restauracji i niewielkich odległości w tych
miastach.

Rozrzut danych w dużych miastach, takich jak Warszawa i Kraków, jest
większy, co odzwierciedla większe zróżnicowanie cen. W mniejszych
miastach, takich jak Radom i Białystok, dane są bardziej skupione,
wskazując na bardziej jednorodny rynek.

------------------------------------------------------------------------

```{r, echo=FALSE, results='asis', eval=TRUE}
korelacje_cena_restau <- dane_filtr %>%
  group_by(city) %>% 
  summarise(
    korelacja = cor(restaurant_distance, price) 
  )
knitr::kable(korelacje_cena_restau, col.names = c("Miasto", "Wynik korelacji"), caption = "Współczynniki korelacji między odległością od restauracji a ceną mieszkań")
```

Tabela przedstawia współczynniki korelacji między odległością od
restauracji a ceną mieszkań dla sześciu miast. Współczynnik korelacji
przyjmuje wartości od -1 (pełna korelacja ujemna) do 1 (pełna korelacja
dodatnia), gdzie wartość 0 oznacza brak korelacji.

1.  **Białystok**
    -   Bardzo słaba pozytywna korelacja. Odległość od restauracji ma
        **minimalny wpływ** na ceny mieszkań, sugerując, że dostępność
        restauracji nie jest istotnym czynnikiem przy wycenie
        nieruchomości w tym mieście.
2.  **Częstochowa**
    -   Bardzo słaba negatywna korelacja. W praktyce odległość od
        restauracji **nie wpływa** na ceny mieszkań. Może to wynikać z
        równomiernego rozmieszczenia restauracji w całym mieście.
3.  **Kraków**
    -   Słaba negatywna korelacja. Mieszkania bliżej restauracji są
        nieco droższe. Może to oznaczać, że lokale gastronomiczne
        znajdują się głównie w centralnych, droższych dzielnicach
        miasta, co wpływa na wartość nieruchomości.
4.  **Radom**
    -   Słaba pozytywna korelacja. Mieszkania oddalone od restauracji są
        nieco droższe, co może sugerować, że bardziej prestiżowe lub
        spokojne lokalizacje znajdują się dalej od stref z gastronomią.
5.  **Rzeszów**
    -   Bardzo słaba pozytywna korelacja. Odległość od restauracji **ma
        niewielki wpływ** na ceny mieszkań. Może to wynikać z
        preferencji mieszkańców lub rozmieszczenia restauracji w
        mieście.
6.  **Warszawa**
    -   Słaba negatywna korelacja. Mieszkania bliżej restauracji są
        nieco droższe. Może to oznaczać, że restauracje są zlokalizowane
        głównie w bardziej atrakcyjnych dzielnicach, co podnosi wartość
        nieruchomości w ich pobliżu.

------------------------------------------------------------------------

## Odległość od uczelni

```{r, echo=FALSE, comment=FALSE, warning=FALSE, message=FALSE}
ggplot(dane_filtr, aes(x = college_distance, y = price)) +
  geom_point(alpha = 0.5, color = "indianred1") +
  geom_smooth(method = "lm", color = "darkgrey", se = FALSE) +
  facet_wrap(~ city) + 
  labs(
    title = "Wpływ odległości od uczelni na ceny mieszkań",
    x = "Odległość od uczelni (km)",
    y = "Cena mieszkania (PLN)"
  ) +
  theme_minimal()
```

#### Ogólne wnioski:

1.  **Warszawa i Kraków**
    -   W obu miastach (szczególnie w **Warszawie**) odległość od
        uczelni również wykazuje lekki **ujemny wpływ** -- mieszkania
        bliżej uczelni są droższe. W **Krakowie** efekt jest bardziej
        widoczny, co może wynikać z charakteru miasta akademickiego,
        gdzie bliskość uczelni jest silnym czynnikiem wpływającym na
        rynek nieruchomości.
2.  **Rzeszów i Białystok**
    -   W przypadku obu miast odległość od uczelni również nie ma
        wyraźnego wpływu na ceny mieszkań (trend jest lekko skierowany
        ku górze). Oznacza to, że w tych miastach bliskość uczelni nie
        jest kluczowym czynnikiem. Możliwe, że mniejsza liczba studentów
        lub rozłożenie uczelni na różne obszary powoduje brak
        zauważalnego trendu.
3.  **Częstochowa i Radom**
    -   Zarówno w **Częstochowie**, jak i w **Radomiu**, linia trendu
        sugeruje **nieznaczny pozytywny wpływ**. Możliwe, że bliskość
        uczelni w tych miastach nie jest atutem, a bardziej liczą się
        spokojniejsze lokalizacje.
4.  **Rozrzut danych**:
    -   W miastach takich jak Warszawa czy Kraków widać większy rozrzut
        cen (punkty są bardziej rozproszone), co oznacza, że mieszkania
        w tych miastach mają znacznie większe zróżnicowanie cen.

#### **Interpretacja:**

W dużych miastach, takich jak Warszawa i Kraków, odległość od uczelni ma
lekki ujemny wpływ na ceny mieszkań -- bliżej uczelni mieszkania są
droższe. W Krakowie efekt ten jest bardziej widoczny, co może wynikać z
charakteru miasta akademickiego, gdzie bliskość uczelni silnie wpływa na
wartość nieruchomości. W Warszawie wpływ ten jest słabszy, co może być
związane z większą rolą innych czynników, takich jak prestiż
lokalizacji.

W Rzeszowie i Białymstoku odległość od uczelni nie ma wyraźnego wpływu
na ceny mieszkań. Linie regresji są lekko nachylone w górę, co sugeruje,
że bliskość uczelni nie jest kluczowym czynnikiem determinującym ceny
nieruchomości. Może to wynikać z mniejszej liczby studentów lub
rozproszenia uczelni na różne obszary miasta.

W Częstochowie i Radomiu linie trendu wykazują niewielki wzrost cen wraz
z odległością od uczelni. Sugeruje to, że spokojniejsze lokalizacje,
oddalone od centrów akademickich, mogą być bardziej cenione przez
mieszkańców tych miast.

Rozrzut danych wskazuje, że w Warszawie i Krakowie ceny mieszkań są
bardziej zróżnicowane, podczas gdy w mniejszych miastach, takich jak
Radom i Białystok, ceny są bardziej jednorodne.

------------------------------------------------------------------------

```{r, echo=FALSE, results='asis', eval=TRUE}
korelacje_cena_studia <- dane_filtr %>%
  group_by(city) %>% 
  summarise(
    korelacja = cor(college_distance, price) 
  )
knitr::kable(korelacje_cena_studia, col.names = c("Miasto", "Wynik korelacji"), caption = "Współczynniki korelacji między odległością od uczelni a ceną mieszkań")
```

Tabela przedstawia współczynniki korelacji między odległością od uczelni
a ceną mieszkań dla sześciu miast. Współczynnik korelacji przyjmuje
wartości od -1 (pełna korelacja ujemna) do 1 (pełna korelacja dodatnia),
gdzie wartość 0 oznacza brak korelacji.

1.  **Białystok**
    -   Bardzo słaba pozytywna korelacja. Ceny mieszkań nieznacznie
        rosną wraz z odległością od uczelni, co może wskazywać, że
        bliżej uczelni znajdują się tańsze mieszkania, być może
        skierowane do studentów.
2.  **Częstochowa**
    -   Umiarkowana pozytywna korelacja. Mieszkania dalej od uczelni są
        wyraźnie droższe. Może to sugerować, że bardziej prestiżowe lub
        rodzinne lokalizacje są zlokalizowane poza strefami
        akademickimi.
3.  **Kraków**
    -   Umiarkowana negatywna korelacja. Ceny mieszkań spadają wraz ze
        wzrostem odległości od uczelni. Bliskość uczelni jest ważnym
        czynnikiem wpływającym na ceny, co może wynikać z dużego popytu
        na mieszkania wśród studentów i pracowników akademickich.
4.  **Radom**
    -   Bardzo słaba pozytywna korelacja. Odległość od uczelni ma
        minimalny wpływ na ceny mieszkań, co może świadczyć o tym, że
        uczelnie w Radomiu są równomiernie rozmieszczone lub mniej
        istotne dla rynku nieruchomości.
5.  **Rzeszów**
    -   Słaba pozytywna korelacja. Mieszkania w większej odległości od
        uczelni są nieco droższe, co sugeruje, że strefy mieszkalne o
        wyższej wartości mogą znajdować się poza rejonami akademickimi.
6.  **Warszawa**
    -   Bardzo słaba negatywna korelacja. Mieszkania bliżej uczelni są
        nieznacznie droższe, ale wpływ ten jest słaby. Wysoka liczba
        uczelni i różnorodność dzielnic zmniejsza znaczenie tego
        czynnika w skali całego miasta.

------------------------------------------------------------------------

## Odległość od aptek

```{r, echo=FALSE, comment=FALSE, warning=FALSE, message=FALSE}
ggplot(dane_filtr, aes(x = pharmacy_distance, y = price)) +
  geom_point(alpha = 0.5, color = "forestgreen") +
  geom_smooth(method = "lm", color = "tan1", se = FALSE) +
  facet_wrap(~ city) + 
  labs(
    title = "Wpływ odległości od aptek na ceny mieszkań",
    x = "Odległość od aptek (km)",
    y = "Cena mieszkania (PLN)"
  ) +
  theme_minimal()
```

#### Ogólne wnioski:

1.  **Warszawa i Kraków**
    -   W obu dużych miastach odległość od aptek nie ma istotnego wpływu
        na ceny mieszkań, o czym świadczy niemal pozioma linia trendu. W
        **Warszawie** ceny mieszkań wydają się niezależne od bliskości
        aptek, a rozrzut danych jest duży, co wskazuje na zróżnicowanie
        cen nieruchomości w stolicy. W **Krakowie** podobnie jak w
        Warszawie, brak zauważalnej zależności między odległością od
        aptek a cenami mieszkań. Mimo to, punkty są nieco bardziej
        skupione niż w Warszawie.
2.  **Rzeszów i Białystok**
    -   W obu miastach widać bardzo subtelny trend wzrostu cen mieszkań
        wraz ze wzrostem odległości od aptek, jednak wpływ ten jest
        minimalny. W **Rzeszowie** ceny mieszkań są stabilne niezależnie
        od odległości od aptek, z niewielkim rozrzutem danych. W
        **Białymstoku** również brak wyraźnego wpływu odległości od
        aptek na ceny mieszkań. Punkty są bardziej skupione, co świadczy
        o mniejszym zróżnicowaniu cen.
3.  **Częstochowa i Radom**
    -   W tych mniejszych miastach widać lekki wzrost cen mieszkań wraz
        ze wzrostem odległości od aptek, co może sugerować preferencję
        dla spokojniejszych lokalizacji. W **Częstochowie** linia trendu
        jest wyraźnie skierowana ku górze, co może oznaczać, że
        mieszkania w większej odległości od aptek są bardziej cenione. W
        **Radomiu** podobny lekko dodatni trend, jednak mniej wyraźny
        niż w Częstochowie
4.  **Rozrzut danych**:
    -   W większych miastach, takich jak Warszawa i Kraków, rozrzut
        danych jest wyraźnie większy, co wskazuje na znaczne
        zróżnicowanie cen mieszkań niezależnie od odległości od aptek.
    -   W mniejszych miastach (np. Częstochowa, Radom, Rzeszów) dane są
        bardziej skupione, co oznacza mniejsze różnice cenowe na rynku
        nieruchomości.

#### **Interpretacja**

W dużych miastach, takich jak Warszawa i Kraków, odległość od aptek nie
wykazuje wyraźnego wpływu na ceny mieszkań. Linia trendu jest niemal
pozioma, co oznacza, że bliskość aptek nie jest czynnikiem kluczowym w
kształtowaniu wartości nieruchomości. Jednak w tych aglomeracjach widać
duży rozrzut danych, który wskazuje na znaczną różnorodność cen
nieruchomości wynikającą z innych czynników, takich jak prestiż
lokalizacji czy dostępność infrastruktury.

W mniejszych miastach, takich jak Częstochowa i Radom, można zauważyć
lekki wzrost cen mieszkań wraz z odległością od aptek. Sugeruje to, że
spokojniejsze lokalizacje, oddalone od ruchliwych obszarów, mogą być
bardziej cenione przez mieszkańców. Mimo to, wpływ ten jest niewielki i
ma charakter lokalny.

Z kolei w miastach takich jak Rzeszów i Białystok, zależność jest
również minimalna, z delikatnym trendem wzrostowym. Wskazuje to na
niewielkie znaczenie bliskości aptek w tych lokalizacjach. Punkty na
wykresie są bardziej skupione, co odzwierciedla mniejszą zmienność cen
mieszkań w mniejszych ośrodkach miejskich.

```{r, echo=FALSE, results='asis', eval=TRUE}
korelacje_cena_apt <- dane_filtr %>%
  group_by(city) %>% 
  summarise(
    korelacja = cor(pharmacy_distance, price) 
  )
knitr::kable(korelacje_cena_apt, col.names = c("Miasto", "Wynik korelacji"), caption = "Współczynniki korelacji między odległością od aptek a ceną mieszkań")
```

Tabela przedstawia współczynniki korelacji między odległością od aptek a
ceną mieszkań dla sześciu miast. Współczynnik korelacji przyjmuje
wartości od -1 (pełna korelacja ujemna) do 1 (pełna korelacja dodatnia),
gdzie wartość 0 oznacza brak korelacji.

1.  **Białystok**
    -   Słaba pozytywna korelacja. Ceny mieszkań rosną nieznacznie wraz
        z odległością od aptek. Może to oznaczać, że apteki znajdują się
        głównie w bardziej dostępnych, ale mniej prestiżowych
        lokalizacjach.
2.  **Częstochowa**
    -   Umiarkowana pozytywna korelacja. Mieszkania w większej
        odległości od aptek są wyraźnie droższe, co może sugerować, że
        apteki są zlokalizowane w bardziej gęsto zabudowanych obszarach,
        które mogą być mniej prestiżowe.
3.  **Kraków**
    -   Bardzo słaba negatywna korelacja. W praktyce odległość od aptek
        nie wpływa na ceny mieszkań. Apteki mogą być równomiernie
        rozmieszczone w mieście, a ich bliskość nie jest istotnym
        czynnikiem dla wyceny nieruchomości.
4.  **Radom**
    -   Bardzo słaba pozytywna korelacja. Odległość od aptek ma
        niewielki wpływ na ceny mieszkań. Wartość nieruchomości w
        Radomiu jest prawdopodobnie bardziej uzależniona od innych
        czynników niż dostępność aptek.
5.  **Rzeszów**
    -   Słaba pozytywna korelacja. Mieszkania oddalone od aptek są nieco
        droższe. Może to oznaczać, że apteki znajdują się w gęściej
        zabudowanych, mniej prestiżowych dzielnicach miasta.
6.  **Warszawa**
    -   Bardzo słaba negatywna korelacja. W praktyce odległość od aptek
        nie wpływa znacząco na ceny mieszkań, choć mieszkania bliżej
        aptek mogą być minimalnie droższe. Wynika to prawdopodobnie z
        ich dostępności w bardziej prestiżowych dzielnicach.

------------------------------------------------------------------------

## Podsumowanie

```{r, echo=FALSE, results='asis', eval=TRUE}
library(kableExtra)

tabela_podsumowanie_cor <- data.frame(
  Zmienne = c("centre_distance", "school_distance", "clinic_distance", "post_office_distance", "kindergarten_distance", "restaurant_distance", "college_distance", "pharmacy_distance"),

  "Warszawa" = c("Słaba, ujemna: -0.1410103", "Słaba, dodatnia: 0.0344552", "Słaba, ujemna: -0.0971739", "Słaba, ujemna: -0.0311410", "Słaba, dodatnia: 0.0214355", "Słaba, ujemna: -0.1372778","Słaba, ujemna: -0.0838757" ,"Słaba, ujemna: -0.0382882"),
  
  "Kraków" = c("Silna, ujemna: -0.4516062", "Słaba, ujemna: -0.0694751", "Umiarkowana, ujemna: -0.2014158", "Słaba, dodatnia: 0.0304596", "Słaba, dodatnia: 0.1154202", "Słaba, ujemna: -0.1538666","Umiarkowana, ujemna: -0.2231753" ,"Słaba, ujemna: -0.0040424"),
  
  "Białystok" = c("Słaba, dodatnia: 0.1812080", "Słaba, dodatnia: 0.1512009", "Słaba, dodatnia: 0.0498567", "Słaba, dodatnia: 0.1352474", "Słaba, dodatnia: 0.0523985", "Słaba, dodatnia: 0.0624702", "Słaba, dodatnia: 0.1503009", "Słaba, dodatnia: 0.1048127"),
  
  "Rzeszów" = c("Umiarkowana, dodatnia: 0.2788925", "Słaba, dodatnia: 0.1485620", "Umiarkowana, dodatnia: 0.2764591", "Umiarkowana, dodatnia: 0.2357461", "Słaba, dodatnia: 0.1689304", "Słaba, dodatnia: 0.0920299", "Słaba, dodatnia: 0.1730937","Słaba, dodatnia: 0.1538395"),
  
  "Częstochowa" = c("Słaba, dodatnia: 0.1052754", "Silna, dodatnia: 0.4381307", "Umiarkowana, dodatnia: 0.3834959", "Umiarkowana, dodatnia: 0.2135046", "Słaba, dodatnia: 0.0642097", "Słaba, ujemna: -0.0173048","Umiarkowana, dodatnia: 0.2328164" ,"Umiarkowana, dodatnia: 0.2912980"),
  
  "Radom" = c("Słaba, ujemna: -0.0102774", "Słaba, dodatnia: 0.1257768", "Słaba, dodatnia: 0.2207426", "Słaba, dodatnia: 0.0990788", "Słaba, dodatnia: 0.1347670", "Słaba, dodatnia: 0.1339995", "Słaba, dodatnia: 0.0476282","Słaba, dodatnia: 0.0746363")

)


tabela_podsumowanie_cor$Kategoria <- c("Usługi", "Edukacja", "Zdrowie", "Usługi", 
                                       "Edukacja", "Rozrywka", "Edukacja", "Zdrowie")

tabela_podsumowanie_cor_sorted <- tabela_podsumowanie_cor %>%
  arrange(Kategoria)

# Funkcja określająca kolor na podstawie opisu
get_color <- function(value) {
  case_when(
    grepl("słaba, ujemna", value, ignore.case = TRUE) ~ "#FFCCCC",  # jasnoczerwony
    grepl("słaba, dodatnia", value, ignore.case = TRUE) ~ "#CCFFCC",  # jasnozielony
    grepl("umiarkowana, dodatnia", value, ignore.case = TRUE) ~ "#99FF99",  # ciemnozielony
    grepl("umiarkowana, ujemna", value, ignore.case = TRUE) ~ "#FF9999",  # ciemnoczerwony
    grepl("Silna, ujemna", value, ignore.case = TRUE) ~ "#e37171",  # bardzo jasny czerwony
    grepl("Silna, dodatnia", value, ignore.case = TRUE) ~ "#68ed68",  # bardzo jasny zielony
    TRUE ~ "#FFFFFF"  # domyślnie biały
  )
}

# Przetwarzanie tabeli z formatowaniem warunkowym
tabela_podsumowanie_cor_sorted %>%
  kbl(caption = "Podsumowanie siły i kierunku zależności odległości od obiektów a cen mieszkań") %>%
  kable_styling(full_width = F, bootstrap_options = c("striped", "hover", "condensed")) %>%
  row_spec(0, bold = TRUE) %>%
  column_spec(2, background = sapply(tabela_podsumowanie_cor_sorted$Warszawa, get_color)) %>%
  column_spec(3, background = sapply(tabela_podsumowanie_cor_sorted$Kraków, get_color)) %>%
  column_spec(4, background = sapply(tabela_podsumowanie_cor_sorted$Białystok, get_color)) %>%
  column_spec(5, background = sapply(tabela_podsumowanie_cor_sorted$Rzeszów, get_color)) %>%
  column_spec(6, background = sapply(tabela_podsumowanie_cor_sorted$Częstochowa, get_color)) %>%
  column_spec(7, background = sapply(tabela_podsumowanie_cor_sorted$Radom, get_color))



```

W analizie wpływu odległości do różnych instytucji na ceny nieruchomości
w polskich miastach, zauważamy pewne ogólne tendencje.

1.  W **Warszawie**, wpływ odległości na ceny jest stosunkowo niewielki.
    Jedynie większa odległość od centrum oraz resatauracji może
    prowadzić do minimalnego spadku cen nieruchomości. Warto jednak
    zauważyć, że zmienne takie jak odległość do szkół, przedszkoli czy
    aptek mają bardzo mały wpływ na ceny.

2.  W **Krakowie** zauważamy silniejszy wpływ odległości, szczególnie w
    przypadku centrum miasta, gdzie silna ujemna korelacja (-0.451)
    wskazuje, że większa odległość od centrum wyraźnie obniża ceny
    nieruchomości. Ponadto, większa odległość od uczelni i klinik
    również obniża ceny. W Krakowie więc odległość od kluczowych
    punktów, jak centrum czy uczelnie, ma istotny wpływ na ceny.

3.  W **Białymstoku** natomiast widoczna jest tendencja, w której
    większa odległość do instytucji takich jak szkoły, uczelnie czy
    centrum, w niewielkim stopniu podnosi ceny nieruchomości. Chociaż
    wpływ tych zmiennych jest stosunkowo mały, są to czynniki, które
    warto wziąć pod uwagę w dalszej analizie.

4.  W **Rzeszowie**, podobnie jak w Białymstoku, zauważamy pozytywny
    wpływ większej odległości od centrum, poczty i kliniki na ceny
    nieruchomości.

5.  W **Częstochowie** natomiast, odległość od szkoły ma wyraźny wpływ
    na ceny, z silną dodatnią korelacją (0.438). Zwiększenie odległości
    do szkoły może więc prowadzić do wyższych cen nieruchomości.
    Dodatkowo, podobny wpływ mają odległość od kliniki i uczelni, które
    także mogą podnieść ceny.

6.  W **Radomiu** wpływ odległości na ceny jest ogólnie niewielki. Tylko
    w przypadku odległości do szkół, poczty i kliniki zauważamy mały
    pozytywny wpływ na ceny. Jednak ogólnie rzecz biorąc, zmienne
    związane z odległością mają w Radomiu raczej marginalny wpływ na
    ceny nieruchomości.

Warto skupić się na kilku kluczowych zmiennych z poszczególnych miast,
które wykazują silniejsze zależności z cenami nieruchomości. Zmienne te
mogą dać cenne informacje o dynamice rynku i kierunkach, w których ceny
mogą się rozwijać. Oto, które zmienne warto dalej analizować:

-   **Analiza odległości do centrum, szkół i uczelni** powinna być
    kontynuowana, szczególnie w miastach takich jak **Kraków** czy
    **Częstochowa**, gdzie te czynniki mają silny wpływ na ceny.
-   **Kliniki i opieka zdrowotna** to również istotny aspekt, który
    warto badać, zwłaszcza w miastach o rosnącej liczbie osób starszych,
    jak **Rzeszów** czy **Częstochowa**.
-   **Poczta i usługi publiczne**, choć mają mniejszy wpływ na ceny z
    wyjątkiem **Częstochowy** i **Rzeszowa**, nadal mogą pomóc zrozumieć
    preferencje mieszkańców.

Warto także podkreślić, że ceny nieruchomości mogą różnić się w
zależności od typu budynku (mieszkania, domy) oraz jego lokalizacji.
Warto podzielić dane na różne kategorie nieruchomości i sprawdzić, czy
zależności między odległością a ceną różnią się w zależności od rodzaju
nieruchomości.

### **Porównanie średnich wynagrodzeń z cenami mieszkań**

Aby lepiej zrozumieć dostępność mieszkaniową w Polsce, przeanalizowano
średnie wynagrodzenia i ceny mieszkań w sześciu wybranych miastach:
Gdańsku, Warszawie, Krakowie, Częstochowie, Rzeszowie oraz Białymstoku.
Analiza obejmuje wyliczenie liczby metrów kwadratowych mieszkania, jakie
można zakupić za średnie miesięczne wynagrodzenie w każdym z tych miast.
Porównanie uwzględnia średnie ceny za metr kwadratowy oraz specyfikę
lokalnych rynków nieruchomości.

```{r wynagrodzenia_vs_ceny, echo=FALSE, warning=FALSE, message=FALSE}
# Dane średnich wynagrodzeń
wynagrodzenia <- data.frame(
  Miasto = c("Radom", "Warszawa", "Kraków", "Częstochowa", "Rzeszów", "Białystok"),
  Wynagrodzenie = c(7368.00, 9673.42, 10173.41, 8380.28, 7187.74, 6806.05)
)

# Wyliczenie średnich cen mieszkań za m² z danych
srednie_ceny <- dane %>%
  group_by(city) %>%
  summarise(
    Cena_m2 = round(mean(price_per_square_meter, na.rm = TRUE), 2)
  ) %>%
  filter(city %in% c("Radom", "Warszawa", "Kraków", "Częstochowa", "Rzeszów", "Białystok")) %>%
  rename(Miasto = city)

# Łączenie danych
wynagrodzenia_vs_ceny <- merge(wynagrodzenia, srednie_ceny, by = "Miasto")

# Wyliczenie liczby m², które można kupić za średnie wynagrodzenie
wynagrodzenia_vs_ceny$Metry_kwadratowe <- round(wynagrodzenia_vs_ceny$Wynagrodzenie / wynagrodzenia_vs_ceny$Cena_m2, 2)

# Wyliczenie wskaźnika dostępności (liczba miesięcznych pensji potrzebnych na zakup 1 m² mieszkania)
wynagrodzenia_vs_ceny$Wskaznik_dostepnosci <- round(wynagrodzenia_vs_ceny$Cena_m2 / wynagrodzenia_vs_ceny$Wynagrodzenie, 2)

# Poprawienie nazw kolumn do odpowiedniej długości
colnames(wynagrodzenia_vs_ceny) <- c("Miasto", "Średnie wynagrodzenie (PLN)", "Cena za m² (PLN)", "Liczba m² za wynagrodzenie", "Wskaźnik dostępności")

# Wyświetlenie wyników
knitr::kable(wynagrodzenia_vs_ceny, caption = "Porównanie wynagrodzeń z cenami mieszkań w 6 miastach")
```

```{r interaktywna_wizualizacja, echo=FALSE, warning=FALSE, message=FALSE}
# Normalizacja liczby m² do kolorów (gradacja: czerwony -> zielony)
kolo_grad <- colorRamp(c("orchid", "lightyellow"))
kolory <- kolo_grad((wynagrodzenia_vs_ceny$`Liczba m² za wynagrodzenie` - min(wynagrodzenia_vs_ceny$`Liczba m² za wynagrodzenie`)) /
                    (max(wynagrodzenia_vs_ceny$`Liczba m² za wynagrodzenie`) - min(wynagrodzenia_vs_ceny$`Liczba m² za wynagrodzenie`)))
kolory <- apply(kolory, 1, function(x) rgb(x[1]/255, x[2]/255, x[3]/255))

# Tworzenie wykresu
plot_ly(wynagrodzenia_vs_ceny, 
        x = ~Miasto, 
        y = ~`Liczba m² za wynagrodzenie`, 
        type = "bar", 
        text = ~paste("Średnie wynagrodzenie: ", round(`Średnie wynagrodzenie (PLN)`, 2), "PLN", 
                      "<br>Cena za m²: ", round(`Cena za m² (PLN)`, 2), "PLN"),
        hoverinfo = "text",
        marker = list(color = kolory)) %>%
  layout(
    title = "Liczba m² mieszkania za średnie wynagrodzenie",
    xaxis = list(title = "Miasto"),
    yaxis = list(title = "Liczba m²")
  )

```

#### Interpretacja

1.  **Średnie wynagrodzenie a cena mieszkań**:

    -   Najwyższe średnie wynagrodzenie jest w Krakowie (10 173,41 PLN),
        a najniższe w Białymstoku (6 806,05 PLN).

    -   Najdroższy m² mieszkania znajduje się w Warszawie (18 503,96
        PLN), natomiast najtańszy w Radomiu (6 929,92 PLN).

2.  **Liczba m² możliwa do zakupu za średnie wynagrodzenie**:

    -   Najwięcej m² można kupić w Częstochowie (1,19 m²), gdzie
        stosunek wynagrodzenia do ceny za m² jest najkorzystniejszy.

    -   Najmniej m² można kupić w Warszawie (0,52 m²) i Krakowie (0,59
        m²), co wskazuje na wysokie ceny mieszkań w tych miastach.

3.  **Wskaźnik dostępności (liczba miesięcy pracy na zakup 1 m²)**:

    -   Wskaźnik pokazuje, ile miesięcy pracy potrzeba, aby kupić 1 m²
        mieszkania.

        -   **Najlepszy wskaźnik dostępności** (najmniej miesięcy
            pracy): Częstochowa (0.84) i Radom (0.94), co oznacza, że 1
            m² można kupić po około 1 miesiąca pracy.

        -   **Najgorszy wskaźnik dostępności** (najwięcej miesięcy
            pracy): Warszawa (1,91) i Kraków (1,68), co wskazuje, że
            zakup 1 m² mieszkania wymaga prawie 2 miesięcy
            wynagrodzenia.

#### Wnioski

1.  **Warszawa i Kraków jako najmniej dostępne rynki mieszkaniowe**:

    -   Wysokie ceny mieszkań oraz wysoki wskaźnik dostępności (1,91 dla
        Warszawy i 1,68 dla Krakowa) oznaczają, że zakup mieszkania w
        tych miastach wymaga największego wysiłku finansowego.

2.  **Białystok i Rzeszów jako bardziej dostępne rynki**:

    -   Relatywnie niski wskaźnik dostępności (1,48 dla Białegostoku i
        1,50 dla Rzeszowa) sprawia, że zakup mieszkania w tych miastach
        wymaga krótszego czasu pracy w porównaniu z innymi
        lokalizacjami.

3.  **Częstochowa i Radom -- dobre kompromisy**:

    -   Wysoka liczba m² za średnie wynagrodzenie (1,19 dla Częstochowy
        i 1,06 dla Radomia) oraz umiarkowane wskaźniki dostępności (0,84
        dla Częstochowy i 0,94 dla Radomia) wskazują na stosunkowo
        przystępne rynki.

4.  **Znaczenie wskaźnika dostępności dla planowania zakupu**:

    -   Osoby planujące zakup mieszkania powinny brać pod uwagę nie
        tylko cenę za m², ale także wskaźnik dostępności. Im niższy
        wskaźnik, tym szybciej można sfinansować zakup mieszkania.

```{r wynagrodzenia_vs_mieszkania, echo=FALSE, warning=FALSE, message=FALSE}
# Dane średnich wynagrodzeń
wynagrodzenia <- data.frame(
  Miasto = c("Radom", "Warszawa", "Kraków", "Częstochowa", "Rzeszów", "Białystok"),
  Wynagrodzenie = c(7368.00, 9673.42, 10173.41, 8380.28, 7187.74, 6806.05)
)

# Odwrócenie transformacji logarytmicznej dla cen mieszkań
ceny_mieszkan <- dane %>%
  mutate(price = exp(price)) %>%  # Odwracanie logarytmu naturalnego
  group_by(city) %>%
  summarise(
    Min_cena = round(min(price, na.rm = TRUE), 0),
    Srednia_cena = round(mean(price, na.rm = TRUE), 0),
    Max_cena = round(max(price, na.rm = TRUE), 0)
  ) %>%
  filter(city %in% c("Radom", "Warszawa", "Kraków", "Częstochowa", "Rzeszów", "Białystok")) %>%
  rename(Miasto = city)

# Łączenie danych
wynagrodzenia_vs_mieszkania <- merge(wynagrodzenia, ceny_mieszkan, by = "Miasto")

# Wyliczenie czasu potrzebnego na zakup mieszkania (miesiące)
wynagrodzenia_vs_mieszkania$Czas_na_min <- round(wynagrodzenia_vs_mieszkania$Min_cena / wynagrodzenia_vs_mieszkania$Wynagrodzenie, 0)
wynagrodzenia_vs_mieszkania$Czas_na_srednia <- round(wynagrodzenia_vs_mieszkania$Srednia_cena / wynagrodzenia_vs_mieszkania$Wynagrodzenie, 0)
wynagrodzenia_vs_mieszkania$Czas_na_max <- round(wynagrodzenia_vs_mieszkania$Max_cena / wynagrodzenia_vs_mieszkania$Wynagrodzenie, 0)

# Przekształcenie danych do formatu długiego
wynagrodzenia_long <- melt(wynagrodzenia_vs_mieszkania, 
                           id.vars = "Miasto", 
                           measure.vars = c("Czas_na_min", "Czas_na_srednia", "Czas_na_max"),
                           variable.name = "Cena_typ", 
                           value.name = "Czas_miesiace")

# Tworzenie wykresu punktowego
ggplot(wynagrodzenia_long, aes(x = Miasto, y = Czas_miesiace, color = Cena_typ)) +
  geom_point(size = 3) +
  labs(title = "Czas potrzebny na zakup mieszkania w miastach",
       x = "Miasto", y = "Czas (miesiące)",
       color = "Typ ceny") +
  theme_minimal()

```

#### **Interpretacja wykresu**

Wykres punktowy przedstawia czas (w miesiącach) potrzebny na zakup
mieszkania w sześciu miastach Polski przy uwzględnieniu cen minimalnych,
średnich i maksymalnych. Oto kluczowe obserwacje:

**1. Różnice między miastami**

-   **Najkrótszy czas zakupu (Częstochowa)**:

    -   Czas zakupu mieszkania przy minimalnej cenie wynosi mniej niż 50
        miesięcy.

    <!-- -->

    -   Nawet przy maksymalnej cenie mieszkania czas nie przekracza 150
        miesięcy.

    -   To świadczy o relatywnie przystępnych cenach mieszkań w stosunku
        do wynagrodzeń w Częstochowie.

-   **Najdłuższy czas zakupu (Warszawa)**:

    -   Czas zakupu mieszkania w maksymalnej cenie wynosi ponad 300
        miesięcy (ponad 25 lat), co wskazuje na bardzo wysokie ceny
        mieszkań w stolicy.

    <!-- -->

    -   Nawet przy minimalnej cenie mieszkania czas zakupu wynosi
        powyżej 100 miesięcy.

    -   To sprawia, że Warszawa jest najmniej przystępnym miastem pod
        względem zakupu nieruchomości.

**2. Rozkład czasu w ramach miast**

**Stosunkowo stabilne wartości w Częstochowie i Białymstoku:**

-   W obu miastach różnice między czasem dla minimalnej, średniej i
    maksymalnej ceny są najmniejsze.

-   Sugeruje to bardziej jednorodne ceny mieszkań oraz niższe ryzyko
    związane z wahaniami rynku.

**Duże różnice w Warszawie i Krakowie:**

-   W miastach o wysokich cenach mieszkań różnice między czasem zakupu w
    zależności od przedziału cenowego są znaczące.

-   Wskazuje to na dużą rozpiętość cenową na rynku nieruchomości,
    szczególnie w segmencie luksusowym.

**3. Trendy regionalne**

**Miasta centralne i południowe (Warszawa, Kraków):**

-   Miasta te cechują się najwyższymi wskaźnikami czasu zakupu,
    szczególnie w przypadku maksymalnych cen mieszkań.

-   Kraków oferuje nieco większą dostępność niż Warszawa, ale nadal
    wymaga znacznego wysiłku finansowego.

**Miasta mniejsze (Radom, Rzeszów, Białystok):**

-   Oferują większą dostępność mieszkań, szczególnie w przypadku cen
    minimalnych i średnich.

-   Przy maksymalnych cenach czas zakupu oscyluje wokół 200 miesięcy, co
    jest wartością umiarkowaną w porównaniu z miastami centralnymi.

#### **Wnioski**

1.  **Warszawa**:

    -   Najmniej przystępny rynek mieszkań. Wysoka rozpiętość między
        czasem dla minimalnej i maksymalnej ceny wskazuje na wyzwania
        dla nabywców mieszkań.

2.  **Częstochowa**:

    -   Najbardziej przystępny rynek mieszkań. Możliwość zakupu mieszkań
        w krótkim czasie, nawet przy niższych wynagrodzeniach.

3.  **Potencjalne działania**:

    -   W miastach takich jak Warszawa i Kraków warto rozważyć programy
        wsparcia dla nabywców mieszkań.

    -   Częstochowa i Białystok mogą być atrakcyjnymi lokalizacjami dla
        inwestorów ze względu na przystępne ceny mieszkań.

### **Analiza cen mieszkań per dzielnica na przykładzie Gdańska**

```{r Gdańsk zdjęcie, echo=FALSE}
knitr::include_graphics("Gdansk_zdjecie.jpg")
```



Gdańsk, jedno z najstarszych miast Polski, charakteryzuje się nie tylko
bogatą historią i malowniczym położeniem nad Bałtykiem, ale również
dynamicznie rozwijającym się rynkiem nieruchomości. W ramach tej analizy
dokonaliśmy podziału miasta na 35 dzielnic, aby dokładniej przyjrzeć
sięzróżnicowaniu średnich cen mieszkań za metr kwadratowy.





Mapa wizualizuje ceny mieszkań w różnych obszarach, uwzględniając
zarówno centralne, historyczne części miasta, jak Śródmieście, jak i
peryferyjne, bardziej spokojne dzielnice. Zaznaczenie Śródmieścia jako
centrum miasta pozwala łatwiej interpretować wyniki i lokalizować
najważniejsze obszary urbanistyczne Gdańska.



```{r wczytanie dzielnic Gdańska, echo=FALSE, comment=FALSE, warning=FALSE, message = FALSE}
# Wczytanie danych dzielnic Gdańska
file_path <- "Dzielnice.shp"

# Przechwycenie komunikatów za pomocą sink() i ukrycie ich
invisible(capture.output({
  gdansk_dzielnice <- st_read(file_path)
}))

# Dopasowanie układu współrzędnych mieszkań do układu współrzędnych dzielnic
mieszkania_sf <- st_as_sf(dane, coords = c("longitude", "latitude"), crs = 4326)  # Zamiana danych mieszkań na obiekt przestrzenny
mieszkania_sf <- st_transform(mieszkania_sf, st_crs(gdansk_dzielnice))  # Transformacja układu współrzędnych

# Dopasowanie mieszkań do dzielnic za pomocą przestrzennego połączenia
mieszkania_z_dzielnicami <- st_join(mieszkania_sf, gdansk_dzielnice, join = st_within)

# Obliczenie średnich cen za metr kwadratowy dla każdej dzielnicy
srednie_ceny_dzielnic <- mieszkania_z_dzielnicami %>%
  group_by(dzielnica = NAZWA) %>%
  summarise(srednia_cena_m2 = mean(price_per_square_meter, na.rm = TRUE))

# Połączenie średnich cen z danymi przestrzennymi dzielnic za pomocą st_join
gdansk_dzielnice <- gdansk_dzielnice %>%
  st_join(srednie_ceny_dzielnic, join = st_intersects)

# Wykluczenie Zatoki Gdańskiej
gdansk_dzielnice <- gdansk_dzielnice %>% 
  filter(NAZWA != "Zatoka Gdańska")

# Dodanie numerów dzielnic
gdansk_dzielnice <- gdansk_dzielnice %>%
  mutate(numer_dzielnicy = row_number())

# Określenie punktu centrum (Śródmieście)
centrum <- gdansk_dzielnice %>%
  filter(NAZWA == "Śródmieście") %>%
  st_centroid()

# Tworzenie mapy
mapa <- ggplot(data = gdansk_dzielnice) +
  geom_sf(aes(fill = srednia_cena_m2), color = "black", size = 0.2) +
  scale_fill_gradientn(
    name = "Śr. cena za m² (PLN)", 
    colors = c("lightyellow", "orchid3"),
    na.value = "gray",
    labels = label_number(big.mark = " ", decimal.mark = ",")
  ) +
  geom_sf_text(aes(label = numer_dzielnicy), size = 3, color = "black") + # Dodanie numerów dzielnic
  geom_sf(data = centrum, color = "red", size = 4, shape = 18) +  # Punkt centrum
  geom_sf_text(data = centrum, aes(label = "Centrum"), color = "red", size = 3, vjust = -1.5) +  # Etykieta "Centrum"
  theme_minimal() +
  labs(
    title = "Średnia cena za m² w Gdańsku według dzielnic",
    caption = "Źródło: https://www.geoportal.gov.pl/"
  ) +
  theme(
    legend.position = "right",
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    panel.grid = element_blank(),
    plot.title = element_text(hjust = 0.5, size = rel(1.2))
  )

print(mapa)

# Tworzenie tabeli legendy
legenda_dzielnic <- gdansk_dzielnice %>%
  st_drop_geometry() %>%
  select(numer_dzielnicy, NAZWA) %>%
  arrange(numer_dzielnicy)

# Podzielenie tabeli na dwie części
num_rows <- nrow(legenda_dzielnic)
split_index <- ceiling(num_rows / 2)

# Uzupełnienie brakujących wartości pustymi znakami
numer_2 <- legenda_dzielnic$numer_dzielnicy[(split_index + 1):num_rows]
dzielnica_2 <- legenda_dzielnic$NAZWA[(split_index + 1):num_rows]

# Wyrównanie długości i zastąpienie braków pustymi znakami
numer_2 <- c(numer_2, rep("", split_index - length(numer_2)))
dzielnica_2 <- c(dzielnica_2, rep("", split_index - length(dzielnica_2)))

# Stworzenie kompaktowej tabeli
legenda_dzielnic_compact <- tibble(
  Numer_1 = legenda_dzielnic$numer_dzielnicy[1:split_index],
  Dzielnica_1 = legenda_dzielnic$NAZWA[1:split_index],
  Numer_2 = numer_2,
  Dzielnica_2 = dzielnica_2
)

# Wyświetlenie tabeli w nowym formacie
knitr::kable(
  legenda_dzielnic_compact, 
  col.names = c("Numer", "Dzielnica", "Numer", "Dzielnica"),
  caption = "Legenda: Numery dzielnic w Gdańsku"
)
```

#### Interpretacja wyników analizy cen mieszkań per dzielnica:



Analiza wykazała znaczne zróżnicowanie cen mieszkań w poszczególnych
dzielnicach Gdańska. Najwyższe średnie ceny za metr kwadratowy występują
w centralnych obszarach miasta, takich jak Śródmieście oraz nadmorskie
dzielnice, np. Żabianka--Wejhera--Jelitkowo--Tysiąclecia. Są to miejsca
o wysokim prestiżu, dogodnym dostępie do atrakcji turystycznych i
rozwiniętej infrastrukturze.

Z kolei dzielnice bardziej oddalone od centrum, takie jak Kokoszki czy
Matarnia, cechują się znacznie niższymi cenami, co może przyciągać osoby
poszukujące spokojniejszych lokalizacji oraz bardziej przystępnych
cenowo mieszkań.

Porównanie tych różnic uwidacznia rolę lokalizacji w kształtowaniu cen
nieruchomości, co może być cenną wskazówką zarówno dla inwestorów, jak i
osób planujących zakup nieruchomości. Wyniki te stanowią także podstawę
do dalszych analiz, uwzględniających takie czynniki jak dostępność
komunikacyjna, sąsiedztwo terenów zielonych czy rozwój lokalnej
infrastruktury.

# **Podsumowanie**

## Cel projektu

Celem projektu było zrozumienie, jakie czynniki wpływają na ceny mieszkań w sześciu wybranych polskich miastach: Warszawie, Krakowie, Rzeszowie, Białymstoku, Radomiu i Częstochowie. Przeprowadzona analiza pozwoliła odpowiedzieć na kluczowe pytania badawcze oraz wyciągnąć szczegółowe wnioski.

-   *Od czego zależy cena mieszkań?*

-   *Jakie różnice w cenach występują pomiędzy miastami?*

-   *Czy odległość od centrum lub interesujących miejsc (POI) ma
    znaczenie dla wartości nieruchomości?*

-   *Które cechy mieszkań (np. liczba pokoi, stan, udogodnienia) są
    najbardziej cenione?*

## Zakres prac

W ramach realizacji projektu zespół podjął następujące kroki:

1. **Zbieranie danych**: Przeanalizowaliśmy dostępne dane rynkowe obejmujące ceny mieszkań w różnych lokalizacjach Polski. Dane pochodziły z wiarygodnych źródeł, takich jak raporty rynkowe i bazy nieruchomości.
2. **Przygotowanie danych**: Dane zostały oczyszczone i znormalizowane, aby umożliwić ich właściwą analizę. Dane poddane zostały imputacji, zaktualizowano nazwy kolumn czy zmiennych.
3. **Analiza statystyczna**: Wykorzystaliśmy różne techniki analizy statystycznej, w tym:
   - Testy istotności, takie jak ANOVA, w celu porównania średnich cen mieszkań w różnych regionach, test Chi-kwadrat czy Levene'a.
   - Analizę korelacji, aby zidentyfikować zależności między zmiennymi, takimi jak powierzchnia mieszkania a cena za metr kwadratowy czy odległość do POI.
   - Testy normalności, takie jak test Andersona-Darlinga, aby sprawdzić rozkład danych.
4. **Wizualizacja danych**: Wyniki zostały przedstawione za pomocą interaktywnych wykresów i map, aby ułatwić zrozumienie wyników.
5. **Wnioski i rekomendacje**: Opracowaliśmy wnioski, które mogą być użyteczne dla różnych grup interesariuszy, takich jak kupujący, deweloperzy i inwestorzy.

## Wyniki

1. **Czynniki wpływające na ceny**:
   - **Lokalizacja**: Lokalizacja nieruchomości okazała się kluczowym czynnikiem wpływającym na cenę. Mieszkania położone w centrum miast były wyceniane znacznie wyżej niż te na obrzeżach. Dostęp do infrastruktury, takich jak szkoły, sklepy i transport publiczny, dodatkowo zwiększał wartość nieruchomości.
   - **Powierzchnia**: Cena za metr kwadratowy malała wraz ze wzrostem powierzchni mieszkania, co sugeruje, że większe mieszkania oferują lepszy stosunek ceny do metrażu.
   - **Rok budowy**: Nowe mieszkania, zwłaszcza te zbudowane po 2015 roku, były wyceniane wyżej ze względu na nowoczesne technologie budowlane, lepszą efektywność energetyczną i atrakcyjne projekty architektoniczne.
   - **Stan techniczny**: Stan mieszkania, w tym jakość wykończenia oraz ewentualne potrzeby remontowe, istotnie wpływały na cenę. Mieszkania w stanie "do wprowadzenia" osiągały wyższe ceny niż te wymagające generalnego remontu.
   - **Czynniki makroekonomiczne**: Wzrost stóp procentowych oraz inflacja miały pośredni wpływ na poziom cen, ograniczając zdolności nabywcze części klientów.
   - **Udogodnienia i odległość od infrastruktury**: Bliskość do szkół, sklepów, parków czy transportu publicznego miała istotny wpływ na ceny mieszkań. Mieszkania zlokalizowane w pobliżu tych udogodnień były wyceniane wyżej.

2. **Regionalne różnice**: Wschodnia Polska wykazywała znacząco niższe ceny w porównaniu z regionami zachodnimi.

## Wnioski

- Dla inwestorów rekomendujemy koncentrację na rozwijających się miastach o wysokim potencjale wzrostu, takich jak Wrocław i Rzeszów.
- Dla osób poszukujących mieszkań, mniejsze miasta oferują bardziej przystępne ceny przy zachowaniu stosunkowo dobrej infrastruktury.

## Refleksje

Projekt pozwolił nam na rozwinięcie umiejętności analizy danych, interpretacji wyników oraz pracy zespołowej. W szczególności praca w **RStudio** umożliwiła sprawne przetwarzanie danych, ich analizę i wizualizację, co znacząco przyczyniło się do realizacji naszych celów.


---

## Odpowiedzi na kluczowe pytania 

1. **Od czego zależy cena mieszkań?**  
   Cena mieszkań zależy od kilku kluczowych czynników:  
   - **Lokalizacji** (bliskość centrum, rozwinięta infrastruktura).  
   - **Cech mieszkania**, takich jak liczba pokoi, powierzchnia, rok budowy oraz obecność udogodnień (balkon, winda, parking).  
   - **Charakterystyki okolicy**, m.in. liczby punktów użyteczności publicznej (POI) w pobliżu, takich jak szkoły, restauracje czy kliniki.  

2. **Jakie różnice w cenach występują pomiędzy miastami?**  
   Miasta zostały podzielone na trzy grupy cenowe:  
   - **Najdroższe:** Warszawa (18 503 PLN/m²) i Kraków (17 135 PLN/m²).  
   - **Średnie:** Rzeszów (10 803 PLN/m²) i Białystok (10 089 PLN/m²).  
   - **Najtańsze:** Radom (6 929 PLN/m²) i Częstochowa (7 034 PLN/m²).  
   Różnice w cenach wynikają z poziomu urbanizacji, rozwoju gospodarczego i dostępności infrastruktury w każdym mieście.  

3. **Czy odległość od centrum ma znaczenie?**  
   Odległość od centrum miasta istotnie wpływa na ceny mieszkań. Najbardziej zauważalne jest to w Warszawie i Krakowie, gdzie mieszkania w centralnych lokalizacjach osiągają najwyższe ceny. W mniejszych miastach, takich jak Radom czy Częstochowa, ten wpływ jest mniej wyraźny.  

4. **Które cechy mieszkań są najbardziej cenione?**  
   Najbardziej cenione cechy to:  
   - Obecność balkonu, windy i miejsca parkingowego.  
   - Lokalizacja w centrum, bliskość szkół.  
   - Powierzchnia mieszkania oraz liczba pokoi, co przekłada się na funkcjonalność nieruchomości.  


---

### Dodatkowe obserwacje 

2. **Odległość od centrum**  
   - W dużych miastach, takich jak Warszawa i Kraków, ceny spadają wraz z odległością od centrum. W mniejszych miastach, takich jak Radom i Częstochowa, wpływ ten jest mniej zauważalny.  

3. **Rola udogodnień**  
   - Mieszkania z balkonem, miejscem parkingowym lub windą osiągają ceny wyższe niż te bez takich udogodnień, zwłaszcza w dużych aglomeracjach.  
   - W miastach takich jak Warszawa i Kraków kluczowym czynnikiem wpływającym na wartość nieruchomości są również dodatkowe usługi w budynkach, np. ochrona czy komórki lokatorskie.  

4. **Powierzchnia i liczba pokoi**  
   - Typowe mieszkania w analizowanych miastach mają 2-3 pokoje i powierzchnię 50–60 m². 

5. **Wpływ demografii i wynagrodzeń**  
   - W miastach o wyższych średnich wynagrodzeniach (np. Warszawa, Kraków) ceny mieszkań są proporcjonalnie wyższe, co wskazuje na związek między lokalnym rynkiem pracy a wartością nieruchomości.  
   - Regiony o niższych dochodach, takie jak Radom czy Częstochowa, oferują tańsze nieruchomości, ale mają również mniejszy potencjał inwestycyjny.  

6. **Obserwacje dotyczące rynku**  
   - Rynek w Warszawie i Krakowie charakteryzuje się dużą zmiennością cen, podczas gdy w Radomiu i Częstochowie jest bardziej stabilny.  
   - W miastach średnich, takich jak Rzeszów i Białystok, zauważalny jest trend wzrostowy, co wskazuje na rosnący potencjał inwestycyjny.  


---

### **Podsumowanie według miast**  

1. **Warszawa:** Najwyższe ceny wynikają z dużego zapotrzebowania na mieszkania w prestiżowych lokalizacjach, rozwiniętej infrastruktury i szerokiego dostępu do usług.  
2. **Kraków:** Drugie najdroższe miasto, gdzie ceny są determinowane bliskością atrakcji turystycznych oraz rozwiniętym rynkiem wynajmu.  
3. **Rzeszów:** Miasto w średnim przedziale cenowym, które rozwija się jako lokalne centrum biznesowe.  
4. **Białystok:** Charakteryzuje się umiarkowanymi cenami, wynikającymi z mniejszego zapotrzebowania i niższego poziomu urbanizacji.  
5. **Radom:** Najtańsze miast, zdominowane przez starsze budynki i ograniczone możliwości inwestycyjne.  
6. **Częstochowa:** Drugie najtańsze miasto w badaniu, gdzie ceny są najniższe z uwagi na mniejszą atrakcyjność inwestycyjną i ograniczoną infrastrukturę.  

---

### **Wnioski końcowe**  
Przeprowadzona analiza wykazała, że ceny mieszkań w dużym stopniu zależą od lokalizacji, charakterystyki mieszkania oraz dostępności usług w okolicy. Miasta takie jak Warszawa i Kraków dominują pod względem cen, co wynika z ich centralnej roli w gospodarce. Z kolei mniejsze miasta, takie jak Radom i Częstochowa, oferują tańsze mieszkania, ale z ograniczonym potencjałem inwestycyjnym.  

